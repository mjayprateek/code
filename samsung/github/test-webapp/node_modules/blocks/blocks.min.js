!function(a,b){var c;c=a.__mock__&&a._blocks?a._blocks:b(a),"object"==typeof module&&"object"==typeof module.exports?module.exports=c:a.blocks=c,"function"==typeof define&&define.amd&&define("blocks",[],function(){return c})}("undefined"!=typeof window?window:this,function(a){function b(a,b,d,e){for(var f=e.stack,g=e.processed,h=e.clones,i=e.pending,j=0;j<f.length;j++)if(d[b]===f[j])return void i[j].push(function(c){a[b]=c});for(var k=0;k<g.length;k++)if(d[b]===g[k])return void(a[b]=h[k]);a[b]=c(d[b],!0,e)}function c(a,c,d){if(null==a)return a;d.stack.push(a),d.pending.push([]);var e,f,g,h=m.type(a);if(m.isFunction(a.clone))e=a.clone(c);else switch(h){case"object":case"array":e=a.constructor===Object?{}:"object"==h?new a.constructor:Array(a.length);for(f in a)c?b(e,f,a,d):e[f]=a[f];break;case"date":e=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());break;case"regexp":var i="";a.global&&(i+="g"),a.ignoreCase&&(i+="i"),a.multiline&&(i+="m"),e=new RegExp(a.source,i),e.lastIndex=a.lastIndex}if(d.stack.pop(),e){d.processed.push(a),d.clones.push(e),g=d.pending.pop();for(var j=0;j<g.length;j++)g[j](e||a)}else d.pending.pop();return e||a}function d(a,b,c,e,f){if(f!==!1&&(f=!0),a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof m&&(a=a._wrapped),b instanceof m&&(b=b._wrapped);var h=g.call(a);if(h!=g.call(b))return!1;switch(h){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0===a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var i=c.length;i--;)if(c[i]==a)return e[i]==b;var j=a.constructor,k=b.constructor;if(j!==k&&!(m.isFunction(j)&&j instanceof j&&m.isFunction(k)&&k instanceof k)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),e.push(b);var l=0,n=!0;if("[object Array]"==h){if(l=a.length,n=l==b.length)for(;l--&&(n=f?d(a[l],b[l],c,e,f):a[l]===b[l]););}else{for(var o in a)if(m.has(a,o)&&(l++,!(n=m.has(b,o)&&(f?d(a[o],b[o],c,e,f):a[o]===b[o]))))break;if(n){for(o in b)if(m.has(b,o)&&!l--)break;n=!l}}return c.pop(),e.pop(),n}function e(a,b){var c,d,e=this.__Class__;return m.isString(a)?d=e.prototype[a]:(b=a,d=e),this.__Class__=e.prototype.__Class__,c=d.apply(this,b||[]),this.__Class__=e,c}function f(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}var g=Object.prototype.toString,h=Array.prototype.slice,j=Object.prototype.hasOwnProperty,k={},l={},m=function(a){return l.expressionsCreated?0===arguments.length?l.staticExpression:l.createExpression(a):a};m.version="0.3.5",m.core=l,m.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[1]||{},h=2),"object"==typeof g||m.isFunction(g)||(g={});h<i;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):g[d]=c);return g},m.each=function(a,b,c){if(null!=a){var d=a.length,e=-1,g="number"==typeof d;if(b=f(b,c),g)for(;++e<d&&b(a[e],e,a)!==!1;);else for(e in a)if(b(a[e],e,a)===!1)break}},m.eachRight=function(a,b,c){if(null!=a){var d=a.length,e=a.length,g="number"==typeof d;if(b=f(b,c),g)for(;--e>=0;)b(a[e],e,a);else for(e in a)b(a[e],e,a)}},m.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){m["is"+a]=function(b){return g.call(b)=="[object "+a+"]"}}),m.isArguments(arguments)||(m.isArguments=function(a){return!(!a||!j.call(a,"callee"))}),"function"!=typeof/./&&(m.isFunction=function(a){return!(!a||"function"!=typeof a)}),m.isArray=Array.isArray||function(a){return"[object Array]"==g.call(a)},m.extend(m,{noop:function(){},inherit:function(a,b,c){return(arguments.length<3&&m.isPlainObject(b)||1==arguments.length)&&(c=b,b=a,a=void 0),a?(b.prototype=n(a.prototype),b.prototype.constructor=b,m.extend(b.prototype,c),b.prototype.__Class__=a,b.prototype._super=e):c&&(b.prototype=c,b.prototype.constructor=b),b},type:function(a){return a instanceof Array?"array":"string"==typeof a||a instanceof String?"string":"number"==typeof a||a instanceof Number?"number":a instanceof Date?"date":"[object RegExp]"===g.call(a)?"regexp":null===a?"null":void 0===a?"undefined":m.isFunction(a)?"function":m.isBoolean(a)?"boolean":"object"},is:function(a,b){return arguments.length>1&&m.isFunction(b)?b.prototype.isPrototypeOf(a):m.type(a)==b},has:function(a,b){return!(!a||!j.call(a,b))},hasValue:function(a){return!(null==a||m.isNumber(a)&&isNaN(a))},toString:function(a){var b="";return m.hasValue(a)&&(b=a.toString()),b},unwrap:function(a){return l.expressionsCreated&&l.isExpression(a)?a.value():m.unwrapObservable?m.unwrapObservable(a):a},$unwrap:function(a,b,c){return b=f(b,c),a&&a.jquery?(b&&a.each(function(){b(this)}),a=a[0]):b&&b(a),a},toArray:function(a){if(m.isArguments(a))return h.call(a);if(m.isElements(a)){for(var b=Array(a.length),c=-1,d=a.length;++c<d;)b[c]=a[c];return b}return m.isArray(a)?a:[a]},toUnit:function(a,b){var c=b;return b=b||"px",m.isNaN(parseFloat(a))?a:m.isString(a)&&m.isNaN(parseInt(a.charAt(a.length-1),10))?c?a.replace(/[^0-9]+$/,b):a:a+b},clone:function(a,b){var d=!1;m.core.currentClone||(m.core.currentClone={stack:[],processed:[],clones:[],pending:[]},d=!0);var e=c(a,b,m.core.currentClone);return d&&(m.core.currentClone=null),e},isElements:function(a){var b=!1;if(a&&("undefined"!=typeof HTMLCollection&&(b=a instanceof window.HTMLCollection),"undefined"==typeof NodeList||b||(b=a instanceof NodeList),!b&&m.isString(a.item)))try{a.item(0),b=!0}catch(a){}return b},isElement:function(a){return!(!a||1!==a.nodeType)},isBoolean:function(a){return a===!0||a===!1||"[object Boolean]"==g.call(a)},isObject:function(a){return a===Object(a)},isPlainObject:function(a){var b;if(!a||"object"!=typeof a||"[object Object]"!==g.call(a)||a.nodeType||a.window==a)return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(a){return!1}if(k.ownPropertiesAreLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},isFinite:function(a){return isFinite(a)&&!m.isNaN(parseFloat(a))},isNaN:function(a){return m.isNumber(a)&&a!=+a},isNull:function(a){return null===a},isUndefined:function(a){return void 0===a},nothing:{},access:function(a,b,c){var d,e=0;for(c=arguments.length>2?c:m.nothing,b=b.split("."),d=b[0];d;){if(null==a)return c;a=a[d],d=b[++e]}return a},swap:function(a,b,c){var d=a.length;return b>=0&&c>=0&&b<d&&c<d&&(a[b]=a[c]+(a[c]=a[b],0)),a},move:function(a,b,c){return b!=c&&(b<=c&&c++,a.splice(c,0,a[b]),b>c&&b++,a.splice(b,1)),a},bind:function(a,b){var c,d=function(){},e=h.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,e.concat(h.call(arguments)));d.prototype=a.prototype;var f=new d,g=a.apply(f,e.concat(h.call(arguments)));return Object(g)===g?g:f}},toObject:function(a,b){for(var c,d={},e=arguments.length>1&&b,f=0,g=a.length;f<g;f++)c=a[f],m.isArray(c)?d[c[0]]=c[1]:m.isObject(c)?d[c.key]=c.value:d[c]=!e||b[f];return d},pairs:function(a){var b=[];for(var c in a)b.push({key:c,value:a[c]});return b},flatten:function(a,b){for(var c,d=m.core.flatten,e=[],f=a.length,g=-1;++g<f;)c=a[g],d(b,c,e);return e},equals:function(a,b,c){return a=m.unwrap(a),b=m.unwrap(b),d(a,b,[],[],c)}}),m.at=function(a){return{index:a,prototypeIndentification:"__blocks.at__"}},m.first=function(){return m.first},m.last=function(){return m.last};var n=Object.create||function(a){var b=function(){};return b.prototype=a,new b};for(var o in[k])break;k.ownPropertiesAreLast="0"!=o,l.flatten=function(a,b,c){if(m.isArray(b)||m.isArguments(b))if(a)c.push.apply(c,b);else for(var d=0;d<b.length;d++)l.flatten(a,b[d],c);else c.push(b)},function(){function a(a,b){this._value=a,this._computedValue=void 0,b&&(this._parent=b,this._currentResult=m.isBoolean(b._result)?b._result:b._currentResult,this._lastCondition=b._condition||b._lastCondition,this._hasNot=b._hasNot)}function b(a,b,c,d){c=I.parseCallback(c,d)||c;for(var e,f,g={},h=0,i=b.length,j=m.isFunction(c),k=null!=c;h<i;h++)e=b[h],f=k?j?c(e,h,b):e[c]:e,a(g,f,e,b,c);return g}function c(b,e,f,g,h){var i=O.expressions({isRoot:h,name:b,path:e,descriptorName:f||"a",args:(y[f]||{}).args,methods:y,type:g||0,staticMethods:D}),j=new Function(["blocks","blox","expressions","cache","BaseExpression","LoopDescriptors","generateExpression","descriptors","createExpression","PrepareValues","slice","add","NumberExpression"],i)(m,m,Q,P,a,O,c,R,t,I,E,d,n);return h&&(Q[b+"Expression"]=j),j.prototype.forEach=j.prototype.each,j}function d(a,b){if(b.length>0){var c=x.determineIndex(b[0],a.length),d=E.call(b,x.isPosition(b[0])?1:0),e=0;if(c>=a.length)for(;e<d.length;e++)a[c+e]=d[e];else a.splice.apply(a,[c,0].concat(d))}return a}function e(a,b){return d(a,m.flatten(b,!0))}function f(a,b){this.__Class__(a,b)}function h(a,b){for(var c,d=0;d<b.length;d++)c=new RegExp("\\{"+d+"\\}","gm"),a=a.replace(c,b[d]);return a}function j(a,b){this.__Class__(a,b)}function k(a,b){return function(){return a.apply(this,b.concat(E.call(arguments)))}}function l(a,b,c){return b=b||0,setTimeout(function(){return a.apply(null,c)},b)}function n(a,b){this.__Class__(a,b)}function o(a,b){this.__Class__(a,b)}function p(a,b){this.__Class__(a,b)}function q(a){return function(){var b=m.unwrap(this._value||this.data||this);return m[a]?m.unwrap(m[a].apply(b,[b].concat(m.toArray(arguments)))):(b=m(b),b=b[a].apply(b,m.toArray(arguments)),b.result()||b.value())}}function r(){return{indexOrKey:"indexOrKey",length:"length",result:"result",isCollectionAnArray:"isCollectionAnArray",collection:"collection",expression:"expression",value:"value",resultIndex:0,isArrayCheck:'typeof length == "number"',skip:0,take:null,args:[],variables:[],objectBeforeLoops:[],arrayBeforeLoops:[],objectInLoops:[],arrayInLoops:[],objectAfterLoops:[],arrayAfterLoops:[],conditionsEnd:""}}function s(){var a,b={result:"result",inLoop:!0,items:[]},c=0,d=b.items,e=[],f=0;return{callback:function(g){var h=!0;switch(g.name){case"and":d.push(" && ");break;case"or":d.push(" || ");break;case"not":a===!1&&(b.inLoop=!1),a=void 0,d.splice(d.length-1,0,"!"),f++;break;default:h=!1,void 0!==g.boolResult&&(void 0!==a&&a===!0&&(b.inLoop=!1),a=g.boolResult,f++,d.push(b.result+c),g.inLoop=(g.inLoop||"").replace(/(\s|;)(break\s?;)/g,function(a){var b="";return";"==a[0]&&(b=";"),b})),e.push(m.format("var {0}{1};",b.result,c))}return c++,h},end:function(c){void 0!==a&&a===!0&&(b.inLoop=!1),c.conditionsDeclarations=e.join(""),f>1&&(c.conditions=!0,c[(b.inLoop?"inLoop":"afterLoop")+"Conditions"]=O.conditions(b),b.inLoop&&(b.inLoop=!1,c.afterLoopConditions=O.conditions(b)))}}}function t(a){for(var b,c,d=r(),e=a._isSingle,f=a._type,g=e?["array","object"]:[1==a._type?"array":"object"],h=e?"":0,i=[],j=e?void 0:s(),k=0,l=0,n=!1,o="",p=!0;a._parent;)m.each(g,function(c,f){switch("filter"==a._descriptor.identity&&(d.skip&&(o+=O.skip({index:k})),null!==d.take&&(o+=O.take({index:l})),d.skip=0,d.take=null),b=a._descriptor(h,c,a,i,o),o="",0===f&&d.args.push(b.args||[]),b.name){case"skip":return void(d.skip||(d.skip="skip"+h));case"take":return void(null===d.take&&(d.take="take"+h));case"reverse":return void(d.reverse=!d.reverse)}p=!1,!e&&j.callback(b)||(0===f&&b.reverse&&(d.reverse=!d.reverse),e||(c="array"),void 0!==b.boolResult?d.resultIndex=h||0:h||(n=!0),b.beforeLoop&&d[c+"BeforeLoops"].push(b.beforeLoop),b.inLoop&&d[c+"InLoops"].push(b.inLoop),b.afterLoop&&d[c+"AfterLoops"].push(b.afterLoop))}),"skip"!=b.name&&"take"!=b.name&&"reverse"!=b.name?i.push(a):0==i.length&&(d.resultIndex+=1,"skip"==b.name?k=k||h:l=l||h),h=+h+1,a=a._parent;if(d.isObject=T.prototype.isPrototypeOf(a),e){switch(f){case"array":d.isArrayCheck=!0;break;case"object":d.isArrayCheck=!1}return"object"==typeof module&&"object"==typeof module.exports?(c=new Function(["blocks","collection"].concat(d.args[0]),a._loopDescriptor(d)),function(){return c.apply(this,[m].concat(m.toArray(arguments)))}):new Function(["collection"].concat(d.args[0]),a._loopDescriptor(d))}return j.end(d),p&&(d.arrayBeforeLoops.push(d.result+d.resultIndex+" = [];"),d.arrayInLoops.push(d.result+d.resultIndex+".push("+d.value+");")),n&&(d.resultIndex=0),"object"==typeof module&&"object"==typeof module.exports?(c=new Function(["blocks",d.expression],a._loopDescriptor(d)),function(a){return c(m,a)}):new Function(d.expression,a._loopDescriptor(d))}function u(a){var b={_loopDescriptor:O[a.identity]||O.singleExpression},c={_parent:b,_descriptor:a,_isSingle:!0,_type:a.parent.type};return c}function v(a){var b=Z[a];if(m.isFunction(b)){var c=u(b);if(m[a])return t(c);m[a]=t(c)}}var w=m.at;m.at=function(a){return{index:a,prototypeIndentification:"__blocks.at__"}},m.first=function(){return m.first},m.last=function(){return m.last};var x={isPosition:function(a){return a==m.first||a==m.last||a&&"__blocks.at__"==a.prototypeIndentification},determineIndex:function(a,b){return a==m.first?0:"__blocks.at__"==a.prototypeIndentification?a.index:b}},y={};a.prototype={_prototypeIndentification:"__blocks.expression__",_expression:a,type:function(){return"base"},is:function(a){return this._setResult(m.is(this._value,a)),this},value:function(){return this._value},not:function(){var a=new this._expression(this._value,this);return a._hasNot=!this._hasNot,a},or:function(){var a=new this._expression(this._value,this);return a._condition="or",a},and:function(){var a=new this._expression(this._value,this);return a._condition="and",a},result:function(){return this._not?!this._result:this._result},each:function(){},equals:function(a,b){var c=new this._expression(this._value,this);return c._setResult(m.equals(this._value,a,b)),c},hasValue:function(){return this._resultExpression(m.hasValue(this._value))},toString:function(){return new f(m.toString(this._value))},toArray:function(){return new S(m.toArray(this.value()))},clone:function(a){return m(m.clone(this._value,a))},_setResult:function(a){switch(this._hasNot&&(a=!a),this._lastCondition){case"and":this._result=this._currentResult&&a;break;case"or":this._result=this._currentResult||a;break;default:this._result=a}this._hasNot=!1,this._lastCondition=void 0},_resultExpression:function(a){var b=new this._expression(this._value,this);return b._setResult(a),b}},m.extend(m,{isEmpty:function(a){if(null==a)return!0;if(m.isArray(a)||m.isString(a)||m.isArguments(a))return!a.length;for(var b in a)return!m.has(a,b);return!0}});var z=function(a){return a},A=Object.prototype.hasOwnProperty,B=Math.max,C=Math.ceil;m.extend(m,{range:function(a,b,c){tart=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=B(0,C((b-a)/(c||1))),f=Array(e);++d<e;)f[d]=a,a+=c;return f},groupBy:function(a,c,d){return b(function(a,b,c){A.call(a,b)||(a[b]=[]),a[b].push(c)},a,c,d)},countBy:function(a,c,d){return b(function(a,b){A.call(a,b)||(a[b]=0),a[b]++},a,c,d)},sortBy:function(a,b,c){var d,e,f,g,h,j=b?b.length:0;return m.isPlainObject(b)&&(b=[b],j=1),m.isArray(b)?j>0?a.sort(function(a,c){for(i=0;i<j;i++)if(e=b[i],d=e.dir?e.dir.toLowerCase():"asc","none"!=d&&(g=a[e.field],h=c[e.field],g!==h))return f=g>h?1:-1,"desc"==d?-f:f}):a:(b=I.parseCallback(b,c),b||(b=z),m(a).map(function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){if(g=a.criteria,h=b.criteria,g!==h){if(g>h||void 0===g)return 1;if(g<h||void 0===h)return-1}return a.index-b.index}).map("value").value())}});var D={},E=Array.prototype.slice,F={skip:function(){return{name:"skip",args:["skip"]}},take:function(){return{name:"take",args:["take"]}},and:function(){return{name:"and",args:[]}},or:function(){return{name:"or",args:[]}},not:function(){return{name:"not",args:[]}},reverse:function(){return{name:"reverse",args:[]}}};for(var G in F)F[G].identity=G;var H=m.core,I={parseCallback:function(a,b){if("string"==typeof a){var c=a;return function(a){return a[c]}}if(null!=b){var d=a;a=function(a,c,e){return d.call(b,a,c,e)}}return a},uniquePrepare:function(a,b){return m.isFunction(a)?I.parseCallback(a,b):a},mapPrepare:function(a,b){return I.parseCallback(a,b)},filterPrepare:function(a,b){return m.isFunction(a)||m.isString(a)?I.parseCallback(a,b):I.createFilterCallback(a)},reducePrepare:function(a,b,c){return m.isFunction(a)||m.isString(a)?I.parseCallback(a,c):I.parseCallback(a,c)},createFilterCallback:function(a){return function(b){return I.resolveFilterExpressionValue(!1,b,a)}},resolveFilterExpressionValue:function(a,b,c){if(c.field&&c.operator){var d=c.value;switch(b=b[c.field],c.operator.toLowerCase()){case"eq":a=b===d;break;case"neq":a=b!==d;break;case"lt":a=b<d;break;case"lte":a=b<=d;break;case"gt":a=b>d;break;case"gte":a=b>=d;break;case"startswith":a=m(b).startsWith(d);break;case"endswith":a=m(b).endsWith(d);break;case"contains":a=b.indexOf(d)!==-1}return a}if(c.logic&&c.filters){if(a&&"or"==c.logic)return!0;for(var e=!1,f=c.filters.length,g=0;g<f&&(e=I.resolveFilterExpressionValue(!1,b,c.filters[g]),!e||"or"!=c.logic);g++);return e}for(var h in c)if(b[h]!==c[h])return!1;return!0}};I.reduceRightPrepare=I.reducePrepare;for(var G in I)H[G]=I[G];var J={contains:function(a,b,c,d,e){return{boolResult:!1,args:["searchValue"],beforeLoop:"result"+a+"=false;",inLoop:"if (value===searchValue"+a+"){result"+a+"=true;break ;};"}},each:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:""===a?""+f:"",inLoop:"callback"+a+"(value,indexOrKey,collection);",prepareValues:f}},equals:function(a,b,c,d,e){var f="deepEqual"+a+"=deepEqual"+a+"===false?false:true;";return{boolResult:!0,args:["compareValue","deepEqual"],beforeLoop:(""===a?""+f:"")+"var index"+a+"=0;var resultResolved"+a+"=false;var size"+a+"=0;var key"+a+";result"+a+"=true;if (Object.prototype.toString.call(collection)!==Object.prototype.toString.call(compareValue"+a+")){result"+a+"=false;resultResolved"+a+"=true;};if (!resultResolved"+a+"){var aCtor=collection.constructor;var bCtor=compareValue"+a+'.constructor;if (aCtor!==bCtor&&!(blocks.isFunction(aCtor)&&aCtor instanceof aCtor&&blocks.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor" in collection&&"constructor" in compareValue'+a+")){result"+a+"=false;resultResolved"+a+"=true;}};",inLoop:("array"==b?"if (!resultResolved"+a+"){if (deepEqual"+a+"?!blocks.equals(value,compareValue"+a+"[size"+a+"],true):value!==compareValue"+a+"[size"+a+"]){result"+a+"=false;break;}size"+a+"+=1;};":"")+("object"==b?"if (!resultResolved"+a+"){if (blocks.has(collection,indexOrKey)){if (!blocks.has(compareValue"+a+",indexOrKey)||(deepEqual"+a+"?!blocks.equals(value,compareValue"+a+"[indexOrKey],true):value!==compareValue"+a+"[indexOrKey])){result"+a+"=false;break;}size"+a+"+=1;}};":""),afterLoop:("array"==b?"if (!compareValue"+a+"||size"+a+"!==compareValue"+a+".length){result"+a+"=false;resultResolved"+a+"=true;};":"")+("object"==b?"if (!resultResolved"+a+"&&result"+a+"){for (key"+a+" in compareValue"+a+"){if (blocks.has(compareValue"+a+",key"+a+")&&!size"+a+"--){break ;}}result"+a+"=!size"+a+";};":""),prepareValues:f}},every:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{boolResult:!0,args:["callback","thisArg"],beforeLoop:"result"+a+"=true;"+(""===a?""+f:""),inLoop:"if (callback"+a+"){if (!callback"+a+"(value,indexOrKey,collection)){result"+a+"=false;break ;}}else if (!value){result"+a+"=false;break ;};",prepareValues:f}},filter:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.filterPrepare(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:(""===a?""+f:"")+(""===a||0===d.length?""+("array"==b?"result"+a+"=[];":"")+("object"==b?"result"+a+"={};":""):""),inLoop:"if (!callback"+a+"(value,indexOrKey,collection)){continue ;};"+e+";"+(""===a||0===d.length?""+("array"==b?"result"+a+".push(value);":"")+("object"==b?"result"+a+"[indexOrKey]=value;":""):""),prepareValues:f}},first:function(a,b,c,d,e){var f="if (callback"+a+"){callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");};";return{args:["callback","thisArg"],beforeLoop:"var isNumber"+a+"=blocks.isNumber(callback"+a+");var size"+a+"=0;var count"+a+"=1;var current"+a+";if (isNumber"+a+"){result"+a+"=[];count"+a+"=callback"+a+";callback"+a+"=thisArg"+a+";};"+(""===a?""+f:""),inLoop:"if (callback"+a+"){if (callback"+a+"(value,indexOrKey,collection)){current"+a+"=value;}else {continue ;}}else {current"+a+"=value;};if (isNumber"+a+"){if (size"+a+"++>=count"+a+"){break ;}result"+a+".push(current"+a+");}else {result"+a+"=current"+a+";break ;};",prepareValues:f,everything:!0}},has:function(a,b,c,d,e){return{boolResult:!1,args:["key"],beforeLoop:"result"+a+"=false;",afterLoop:"result"+a+"=blocks.has(collection,key"+a+");"}},invoke:function(a,b,c,d,e){return{args:["method","args"],beforeLoop:"var isFunc"+a+"=blocks.isFunction(method"+a+");"+(""===a||0===d.length?""+("array"==b?"result"+a+"=[];":"")+("object"==b?"result"+a+"={};":""):"")+(""===a?"args"+a+"=Array.prototype.slice.call(arguments,2);":""),inLoop:"value=(isFunc"+a+"?method"+a+":value[method"+a+"]).apply(value,args"+a+"||[]);"+(""===a||0===d.length?""+("array"==b?"result"+a+".push(value);":"")+("object"==b?"result"+a+"[indexOrKey]=value;":""):"")}},isEmpty:function(a,b,c,d,e){return{boolResult:!0,beforeLoop:"result"+a+"=true;",inLoop:"result"+a+"=false;"}},join:function(a,b,c,d,e){return{args:["separator"],beforeLoop:"separator"+a+"=typeof separator"+a+'=="undefined"?",":separator'+a+";result"+a+'="";',inLoop:"result"+a+"+=value+separator"+a+";",afterLoop:"result"+a+"=result"+a+".substring(0,result"+a+".length-separator"+a+".length);"}},map:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:(""===a?""+f:"")+(""===a?""+("array"==b?"result"+a+"=Array(collection.length);":"")+("object"==b?"result"+a+"=[];":""):"")+(""!==a&&0===d.length?"result"+a+"=[];":""),inLoop:"value=callback"+a+"(value,indexOrKey,collection);"+(""===a?""+("array"==b?"result"+a+"[indexOrKey]=value;":"")+("object"==b?"result"+a+".push(value);":""):"")+(""!==a&&0===d.length?"result"+a+".push(value);":""),prepareValues:f}},max:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:"var max"+a+"=-Infinity;result"+a+"=max"+a+";"+(""===a?""+f:""),inLoop:"max"+a+"=callback"+a+"?callback"+a+"(value,indexOrKey,collection):value;result"+a+"=max"+a+">result"+a+"?max"+a+":result"+a+";",prepareValues:f,type:"NumberExpression"}},min:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:"var min"+a+"=Infinity;result"+a+"=min"+a+";"+(""===a?""+f:""),inLoop:"min"+a+"=callback"+a+"?callback"+a+"(value,indexOrKey,collection):value;result"+a+"=min"+a+"<result"+a+"?min"+a+":result"+a+";",prepareValues:f,type:"NumberExpression"}},reduce:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.reducePrepare(callback"+a+",memo"+a+",thisArg"+a+");";return{args:["callback","memo","thisArg"],beforeLoop:"var hasMemo"+a+"=memo"+a+"!=null;result"+a+"=memo"+a+";"+(""===a?""+f:""),inLoop:"if (hasMemo"+a+"){result"+a+"=callback"+a+"(result"+a+",value,indexOrKey,collection);}else {result"+a+"=collection[indexOrKey];hasMemo"+a+"=true;};",prepareValues:f,everything:!0}},size:function(a,b,c,d,e){return{beforeLoop:(""===a?""+("array"==b?"return collection.length;":""):"")+"result"+a+"=0;",inLoop:"result"+a+"++;",type:"NumberExpression"}},some:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{boolResult:!1,args:["callback","thisArg"],beforeLoop:"result"+a+"=false;"+(""===a?""+f:""),inLoop:"if (callback"+a+"){if (callback"+a+"(value,indexOrKey,collection)){result"+a+"=true;break ;}}else if (value){result"+a+"=true;break ;};",prepareValues:f}},type:"collection"};for(var G in J)J[G].identity=G,J[G].parent=J;var K={at:function(a,b,c,d,e){return{args:["position","count"],beforeLoop:"var isArray"+a+"=blocks.isNumber(count"+a+");var size"+a+"=0;indexOrKey=position"+a+"-1;if (isArray"+a+"){result"+a+"=[];};",inLoop:"if (isArray"+a+"){if (size"+a+"++>=count"+a+"){break ;}result"+a+".push(value);}else {result=value;break ;};"}},flatten:function(a,b,c,d,e){return{args:["shallow"],beforeLoop:"var flatten"+a+"=blocks.core.flatten;result"+a+"=[];",inLoop:"flatten"+a+"(shallow"+a+",value,result"+a+");"}},indexOf:function(a,b,c,d,e){return{args:["searchValue","fromIndex"],beforeLoop:"result"+a+"=-1;if (blocks.isNumber(fromIndex"+a+")){indexOrKey=fromIndex"+a+";};",inLoop:"if (value===searchValue"+a+"){result"+a+"=indexOrKey;break ;};",type:"NumberExpression"}},last:function(a,b,c,d,e){var f="if (callback"+a+"){callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");};";return{reverse:!0,args:["callback","thisArg"],beforeLoop:"var isNumber"+a+"=blocks.isNumber(callback"+a+");var size"+a+"=0;var count"+a+"=1;var current"+a+";if (isNumber"+a+"){result"+a+"=[];count"+a+"=callback"+a+";callback"+a+"=thisArg"+a+";};"+(""===a?""+f:""),inLoop:"if (callback"+a+"){if (callback"+a+"(value,indexOrKey,collection)){current"+a+"=value;}else {continue ;}}else {current"+a+"=value;};if (isNumber"+a+"){if (size"+a+"++>=count"+a+"){break ;}result"+a+".unshift(current"+a+");}else {result"+a+"=current"+a+";break ;};",prepareValues:f,everything:!0}},lastIndexOf:function(a,b,c,d,e){return{reverse:!0,args:["searchValue","fromIndex"],beforeLoop:"result"+a+"=-1;if (blocks.isNumber(fromIndex"+a+")){indexOrKey=fromIndex"+a+";};",inLoop:"if (value===searchValue"+a+"){result"+a+"=indexOrKey;break ;};",type:"NumberExpression"}},range:function(a,b,c,d,e){return{args:["start","end","step"],beforeLoop:"length=Math.max(Math.ceil((end"+a+"-start"+a+")/step"+a+"),0);result"+a+"=Array(length);",inLoop:"value=start"+a+";start"+a+"+=step"+a+";"+(""===a||0===d.length?"result"+a+"[indexOrKey]=value;":"")}},reduceRight:function(a,b,c,d,e){return{reverse:!0,args:["callback","memo","thisArg"],beforeLoop:"var hasMemo"+a+"=memo"+a+"!=null;result"+a+"=memo"+a+";"+(""===a?"callback"+a+"=blocks.core.reducePrepare(callback"+a+",memo"+a+",thisArg"+a+");":""),inLoop:"if (hasMemo"+a+"){result"+a+"=callback"+a+"(result"+a+",value,indexOrKey,collection);}else {result"+a+"=collection[indexOrKey];hasMemo"+a+"=true;};",everything:!0}},unique:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.uniquePrepare(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:"var seen"+a+"=[];var isFirst"+a+"=true;var isSorted"+a+"=blocks.isBoolean(callback"+a+")&&callback"+a+";var hasCallback"+a+"=blocks.isFunction(callback"+a+");var map"+a+";result"+a+"=[];"+(""===a?""+f:""),inLoop:"map"+a+"=hasCallback"+a+"?callback"+a+"(value,indexOrKey,collection):value;if (isSorted"+a+"?isFirst"+a+"||seen"+a+"[seen"+a+".length-1]!==map"+a+":!blocks.contains(seen"+a+",map"+a+")){isFirst"+a+"=false;seen"+a+".push(map"+a+");}else {continue ;};"+(""===a||0===d.length?"result"+a+".push(value);":""),prepareValues:f}},type:"array"};for(var G in K)K[G].identity=G,K[G].parent=K;var L={get:function(a,b,c,d,e){var f=(""===a?"keys"+a+"=blocks.flatten(Array.prototype.slice.call(arguments,1));":"")+(""!==a?"keys"+a+"=blocks.flatten(Array.prototype.slice.call(arguments,0));":"");return{args:["keys"],beforeLoop:(""===a?""+f:"")+"var singleKey"+a+"=keys"+a+".length<2;keys"+a+"=blocks.toObject(keys"+a+");result"+a+"={};",inLoop:"if (keys"+a+".hasOwnProperty(indexOrKey)){if (singleKey"+a+"){result"+a+"=value;}else {result"+a+"[indexOrKey]=value;}};",prepareValues:f}},invert:function(a,b,c,d,e){return{beforeLoop:"var temp"+a+";result"+a+"={};",inLoop:"temp"+a+"=value;value=indexOrKey;indexOrKey=temp"+a+";"+(""===a||0===d.length?"result"+a+"[indexOrKey]=value;":"")}},keys:function(a,b,c,d,e){return{beforeLoop:"result"+a+"=[];",inLoop:"value=indexOrKey;"+(""===a||0===d.length?"result"+a+".push(value);":"")}},pairs:function(a,b,c,d,e){return{beforeLoop:"result"+a+"=[];",inLoop:"result"+a+".push({key:indexOrKey,value:value});"}},values:function(a,b,c,d,e){return{beforeLoop:"result"+a+"=[];",inLoop:"result"+a+".push(value);"}},type:"object"};for(var G in L)L[G].identity=G,L[G].parent=L;var M,N,O={chainExpression:function(a){var b,c,d,e,f,g,h,i,j,k,l="";return l+="var "+a.indexOrKey+" = -1, "+a.collection+", "+a.length+", "+a.value+", "+(a.conditions?"":" "+a.result+a.resultIndex+",")+" "+a.result+(a.conditions?" = false":"")+"; "+a.conditionsDeclarations+" ",k=-1,m.each(a.args,function(n,o){c=n,k+=1,j=o,i=0==o,h=o==a.args.length-1,l+=" ",g=-1,m.each(c,function(h,i){b=h,g+=1,f=i,e=0==i,d=i==c.length-1,l+=" var "+b+k+" = "+a.expression+"._"+b+"; "}),l+=" "+a.expression+" = "+a.expression+"._parent; "}),l+=" ",m.eachRight(a.variables,function(n,o){c=n,k=a.variables.length,k+=-1,j=o,i=0==o,h=o==a.variables.length-1,l+=" ",g=-1,m.each(c,function(a,h){b=a,g+=1,f=h,e=0==h,d=h==c.length-1,l+=" var "+f+g+" = "+b+"; "}),l+=" "}),l+=" "+a.collection+" = "+a.expression+"._value; "+a.indexOrKey+" += "+a.skip+"; "+(a.take?" "+a.length+" = Math.min("+a.collection+".length, "+a.skip+" + "+a.take+"); ":"")+" "+(a.take?"":" "+a.length+" = "+a.collection+".length; ")+" "+(a.reverse?" "+a.indexOrKey+" = "+a.collection+".length - "+a.skip+"; ":"")+" ",m.eachRight(a.arrayBeforeLoops,function(b,d){c=b,k=a.arrayBeforeLoops.length,k+=-1,j=d,i=0==d,h=d==a.arrayBeforeLoops.length-1,l+=" "+c+" "}),l+=" "+(a.isObject?" for ("+a.indexOrKey+" in "+a.collection+") { ":"")+" "+(a.isObject?"":" "+(a.reverse?" while (--"+a.indexOrKey+" >= "+(a.take?a.take:"")+(a.take?"":"0")+") { ":"")+" "+(a.reverse?"":" while (++"+a.indexOrKey+" < "+a.length+") { ")+" ")+" "+a.value+" = "+a.collection+"["+a.indexOrKey+"]; ",m.eachRight(a.arrayInLoops,function(b,d){c=b,k=a.arrayInLoops.length,k+=-1,j=d,i=0==d,h=d==a.arrayInLoops.length-1,l+=" "+c+" "}),l+=" "+(a.inLoopConditions?" "+a.inLoopConditions+" ":"")+" } ",m.eachRight(a.arrayAfterLoops,function(b,d){c=b,k=a.arrayAfterLoops.length,k+=-1,j=d,i=0==d,h=d==a.arrayAfterLoops.length-1,l+=" "+c+" "}),l+=" "+(a.afterLoopConditions?" "+a.afterLoopConditions+" ":"")+" "+(a.conditions?"":" "+a.result+" = "+a.result+a.resultIndex+"; ")+" return "+a.result+"; "},conditions:function(a){var b,c,d,e,f,g="";return g+="if (",f=-1,m.each(a.items,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.items.length-1,g+=b}),g+=") { "+a.result+" = true; "+(a.inLoop?" break; ":"")+" } "},expressions:function(a){var b,c,d,e,f,g,h,i,j,k,l="";return l+="function "+a.name+"Expression( ",k=-1,m.each(a.args,function(b,d){c=b,k+=1,j=d,i=0==d,h=d==a.args.length-1,l+=" "+c+", "}),l+=" parent ) { this._parent = parent; this._descriptor = descriptors."+a.descriptorName+"; ",k=-1,m.each(a.args,function(b,d){c=b,k+=1,j=d,i=0==d,h=d==a.args.length-1,l+=" this._"+c+" = "+c+"; "}),l+=" } "+(a.isRoot?" function "+a.name+"Expression(value) { this._value = value; this._loopDescriptor = LoopDescriptors.chainExpression; } ":"")+" blocks.inherit(BaseExpression, "+a.name+"Expression, { _type: "+a.type+', _name: "'+a.name+'", ',k=-1,m.each(a.methods,function(n,o){c=n,k+=1,j=o,i=0==o,h=o==a.methods.length-1,l+=" "+c.name+": function ( ",g=-1,m.each(c.args,function(a,h){b=a,g+=1,f=h,e=0==h,d=h==c.args.length-1,l+=" "+b+", "}),l+=" a ) { var type = expressions."+a.path+c.name+"; if (!type) { type = (expressions."+a.path+c.name+' = generateExpression("'+a.name+c.name+'", "'+a.path+c.name+'", "'+c.name+'", '+a.type+")); } "+c.prepareValues+" expression = new type(",g=-1,m.each(c.args,function(a,h){b=a,g+=1,f=h,e=0==h,d=h==c.args.length-1,l+=" "+b+", "}),l+=" this); "+(c.type?" if (this._hasConditions()) { this.result(); this._setLastCondition(); return new "+c.type+"(expression.value(), this); } return new "+c.type+"(expression.value()); ":"")+" "+(c.everything?" if (this._hasConditions()) { this.result(); this._setLastCondition(); } return blocks(expression.value(), this); ":"")+" "+(c.everything?"":" return expression; ")+" }, ";
}),l+=" ",k=-1,m.each(a.staticMethods,function(b,d){c=b,k+=1,j=d,i=0==d,h=d==a.staticMethods.length-1,l+=" "+j+" : "+c+", "}),l+=" reverse: function () { var type = expressions."+a.path+"reverse; if (!type) { type = (expressions."+a.path+'reverse = generateExpression("'+a.path+'reverse", "'+a.path+'reverse", "reverse", '+a.type+")); } var expression = new type(this); return expression; }, each: function (callback, thisArg) { var type = expressions."+a.path+"each; if (!type) { type = (expressions."+a.path+'each = generateExpression("'+a.path+'each", "'+a.path+'each", "each", '+a.type+")); } callback = PrepareValues.parseCallback(callback, thisArg); var expression = new type(callback, thisArg, this); expression._loop(); return expression; }, value: function () { if (this._parent && this._computedValue === undefined) { this._execute(true); this._computedValue = blocks.isBoolean(this._result) ? this._parent._value : this._result; } return this._computedValue === undefined ? this._value : this._computedValue; }, result: function () { if (this._result === true || this._result === false) { return this._result; } if (this._parent) { this._execute(); } return this._result; }, _loop: function () { var func = cache."+a.path+" || (cache."+a.path+" = createExpression(this)); func(this); }, _execute: function (skipConditions) { var func = cache."+a.path+" || (cache."+a.path+' = createExpression(this, skipConditions)); if (func) { this._setResult(func(this)); } else { this._result = this._findValue(); } }, _hasConditions: function () { var name = this._name; return name.indexOf("and") != -1 || name.indexOf("or") != -1; }, _setLastCondition: function () { var name = this._name; var andIndex = name.lastIndexOf("and"); var orIndex = name.lastIndexOf("or"); this._lastCondition = andIndex > orIndex ? "and" : "or"; }, _findValue: function () { var parent = this._parent; while (parent) { if (parent._value) { return parent._value; } parent = parent._parent; } } }); return '+a.name+"Expression; "},singleExpression:function(a){var b,c,d,e,f,g="";return g+="var "+a.length+" = "+a.collection+".length, "+a.indexOrKey+" = "+(a.reverse?"":"-1")+(a.reverse?a.length:"")+", "+a.isCollectionAnArray+" = "+a.isArrayCheck+", "+a.result+", "+a.value+"; ",f=-1,m.each(a.variables,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.variables.length-1,g+=" "}),g+=" if ("+a.isCollectionAnArray+") { ",f=-1,m.each(a.arrayBeforeLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.arrayBeforeLoops.length-1,g+=" "+b+" "}),g+=" "+(a.reverse?" while (--"+a.indexOrKey+" >= 0) { ":"")+" "+(a.reverse?"":" while (++"+a.indexOrKey+" < "+a.length+") { ")+" "+a.value+" = "+a.collection+"["+a.indexOrKey+"]; ",f=-1,m.each(a.arrayInLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.arrayInLoops.length-1,g+=" "+b+" "}),g+=" } ",f=-1,m.each(a.arrayAfterLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.arrayAfterLoops.length-1,g+=" "+b+" "}),g+=" } else { ",f=-1,m.each(a.objectBeforeLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.objectBeforeLoops.length-1,g+=" "+b+" "}),g+=" for ("+a.indexOrKey+" in collection) { "+a.value+" = "+a.collection+"["+a.indexOrKey+"]; ",f=-1,m.each(a.objectInLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.objectInLoops.length-1,g+=" "+b+" "}),g+=" } ",f=-1,m.each(a.objectAfterLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.objectAfterLoops.length-1,g+=" "+b+" "}),g+=" } return "+a.result+"; "},skip:function(a){var b="";return b+="if (skip"+a.index+"-- > 0) { continue; }"},take:function(a){var b="";return b+="if (take"+a.index+"-- <= 0) { break; }"},type:"loop"},P={},Q={},R=m.extend({},J,K,L,F);for(var G in R)M=R[G],m.isFunction(M)&&(N=M(" ","","",[]),y[G]={name:G,args:N.args,prepareValues:N.prepareValues||"",type:N.type,everything:N.everything});m.extend(D,{toObject:function(a){return new expressions.RootObjectExpression(blox.toObject(this.value(),a))},sortBy:function(a,b){return new expressions.RootArrayExpression(blox.sortBy(this.value(),a,b))},groupBy:function(a,b){return new expressions.RootObjectExpression(blox.groupBy(this.value(),a,b))},countBy:function(a,b){return new expressions.RootObjectExpression(blox.countBy(this.value(),a,b))},shuffle:function(){return new expressions.RootArrayExpression(blox.shuffle(this.value()))},set:function(a,b){return new expressions.RootObjectExpression(blox.set.call(void 0,this.value,a,b))},at:function(a,b){return new expressions.RootArrayExpression(blox.at(this._value,a,b))},concat:function(){var a=this.value();return new expressions.RootArrayExpression(a.concat.apply(a,arguments))},push:function(){var a=this.value();return a.push.apply(a,arguments),new expressions.RootArrayExpression(a)},pop:function(){var a=this.value();return a.pop(),new expressions.RootArrayExpression(a)},shift:function(){var a=this.value();return a.shift(),new expressions.RootArrayExpression(a)},slice:function(a,b){return new expressions.RootArrayExpression(this.value().slice(a,b))},sort:function(a){return new expressions.RootArrayExpression(this.value().sort(a))},splice:function(a,b){var c=this.value();return arguments.length>2?c.splice.apply(c,[a,b].concat(E.call(arguments,2))):c.splice(a,b),new expressions.RootArrayExpression(c)},unshift:function(){var a=this.value();return a.unshift.apply(a,arguments),new expressions.RootArrayExpression(a)}}),m.extend(D,{add:function(){return d(this.value(),arguments),this},remove:function(a,b){return m.remove(this.value(),a,b),this},removeAt:function(a,b){return m.removeAt(this.value(),a,b),this},removeAll:function(a,b){return 0===arguments.length?m.removeAll(this.value()):m.removeAll(this.value(),a,b),this},addMany:function(){return e(this.value(),arguments),this},swap:function(a,b){return m.swap(this.value(),a,b),this},move:function(a,b){return m.move(this.value(),a,b),this}});var S=c("RootArray","arr","",1,!0);m.extend(S.prototype,{reverse:function(){return new S(this._value.reverse())}}),m.extend(m,{add:function(a){return d(a,E.call(arguments,1))},addMany:function(a){return e(a,E.call(arguments,1))},remove:function(a,b,c){return x.isPosition(b)?m.removeAt(a,x.determineIndex(b,this._value.length),c):m.removeAll(a,b,c,!0)},removeAt:function(a,b,c){return m.isNumber(c)||(c=1),a.splice(b,c),a},removeAll:function(a,b,c,d){var e,f=0,g=m.isFunction(b);if(1==arguments.length)a.splice(0,a.length);else for(;f<a.length&&(e=a[f],!(e===b||g&&b.call(c,e,f,a))||(a.splice(f--,1),!d));f++);return a},shuffle:function(a){for(var b,c=[],d=0,e=a.length;d<e;d++)b=m.random(d),c[d]=c[b],c[b]=a[d];return c}});var T=c("RootObject","obj","",2,!0);m.set=function(a,b,c){var d;if(m.isString(b))a[b]=c;else for(d in b)a[d]=b;return a};var U=/^\s+|\s+$/gm,V=/^(\s|\u00A0)+/,W=/(\s|\u00A0)+$/;f.prototype.constructor=a,m.inherit(a,f,{_expression:f,type:function(){return"string"},substring:function(a,b){return new f(this._value.substring(a,b))},isEmpty:function(){return this._resultExpression(0==this._value.length)},size:function(){return new n(m.size(this._value))},contains:function(a){return this._resultExpression(this._value.indexOf(a)!=-1)},startsWith:function(a){return this._resultExpression(m.startsWith(this._value,a))},endsWith:function(a){return this._resultExpression(m.endsWith(this._value,a))},trim:function(a){return new f(m.trim(this._value,a))},trimStart:function(a){return new f(m.trimStart(this._value,a))},trimEnd:function(a){return new f(m.trimEnd(this._value,a))},repeat:function(a){return new f(m.repeat(this._value,a))},reverse:function(){return new f(m.reverse(this._value))},wrap:function(a){return new f(m.wrap(this._value,a))},format:function(){return new f(h(this._value,E.call(arguments,0)))},matches:function(a,b){return new f(m.matches(this._value,a,b))},toUnit:function(a){return new f(m.toUnit(this._value,a))},clone:function(){return new f(this._value.toString())}}),m.extend(m,{startsWith:function(a,b){return m.isString(a)||(a=a.toString()),b=b.toString(),0==a.indexOf(b)},endsWith:function(a,b){return m.isString(a)||(a=a.toString()),b=b.toString(),a.lastIndexOf(b)==a.length-b.length},trim:function(a,b){return(a||"").toString().replace("string"==typeof b?new RegExp("^("+b+")+|("+b+")+$","g"):U,"")},trimStart:function(a,b){return(a||"").toString().replace("string"==typeof b?new RegExp("^("+b+")+"):V,"")},trimEnd:function(a,b){return(a||"").toString().replace("string"==typeof b?new RegExp("("+b+")+$"):W,"")},repeat:function(a,b){var c="",d=0;if(b<0||"number"!=typeof b)return a;for(b=Math.floor(b);d<b;d++)c+=a;return c},reverse:function(a){return m.isArray(a)?a.reverse():("string"!=typeof a&&(a=a.toString()),a.split("").reverse().join(""))},wrap:function(a,b){return m.isFunction(a)?function(){var c=[a];return push.apply(c,arguments),b.apply(this,c)}:b+a+m.reverse(b)},format:function(a){return h(a,E.call(arguments,1))},matches:function(a,b,c){c=m.isNumber(c)?c:Number.MAX_VALUE,m.isRegExp(b)||(b=new RegExp(b.toString(),"g"));var d,e,f=[];for(b.lastIndex=0,d=b.exec(a);c>0&&d&&(e=m.isArray(d)?d[0].length:d.length,f.push({result:d,input:d.input,startIndex:d.index,endIndex:d.index+e,length:e}),b.global);)d=b.exec(a),c--;return f}}),m.inherit(a,j,{bind:function(){return new j(m.bind.apply(this,[this._value].concat(E.call(arguments))))},partial:function(){return new j(k(this._value,E.call(arguments,0)))},memoize:function(a){return new j(m.memoize(this._value,a))},delay:function(a){return new j(l(this._value,a,E.call(arguments,1)))},throttle:function(a,b){return new j(m.throttle(this._value,a,b))},debounce:function(a,b){return new j(m.debound(this._value,a,b))},once:function(){return new j(m.once(this._value))},wrap:function(a){return new j(m.wrap(this._value,a))}}),m.extend(m,{partial:function(a){var b=E.call(arguments,1);return k(a,b)},memoize:function(a,b){var c={};return b||(b=z),function(){var d=b.apply(this,arguments);return c.hasOwnProperty(d)?c[d]:c[d]=a.apply(this,arguments)}},delay:function(a,b){return l(a,b,E.call(arguments,2))},throttle:function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=b.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=a-(j-h);return d=this,e=arguments,k<=0?(clearTimeout(g),g=null,h=j,f=b.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},debounce:function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;j<b?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},once:function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}}),m.random=function(a,b){return 0==arguments.length?Math.random():(null==b&&(b=a,a=0),a+Math.floor(0|Math.random()*(b-a+1)))},m.inherit(a,n,{_expression:n,type:function(){return"number"},toUnit:function(a){return a=a||"px",new f(this._value+a,this)},random:function(a,b){return new n(m.random(a,b),this)},biggerThan:function(a){var b=new n(this._value,this);return b._setResult(this._value>a),b},lessThan:function(){var a=new n(this._value,this);return a._setResult(this._value<value),a}}),m.inherit(a,o,{_expression:o,type:function(){return"date"},addWeeks:function(a){return m.addWeeks(this._value,a),this},compare:function(a){return new o(m.compare(this._value,a))},equalsDate:function(a){return this._setResult(m.equalsDate(this._value,a)),this},equalsTime:function(a){return this._setResult(m.equalsTime(this._value,a)),this},clearTime:function(){return new o(m.clearTime(this._value))}}),m.extend(m,{addWeeks:function(a,b){return a.setDate(a.getDate()+7*b),a},compare:function(a,b){var c=a-b;return c=0===c?c:c<0?-1:1},equalsDate:function(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()},equalsTime:function(a,b){return a.getHours()===b.getHours()&&a.getMinutes()===b.getMinutes()&&a.getSeconds()===b.getSeconds()&&a.getMilliseconds()===b.getMilliseconds()},clearTime:function(a){return a.setHours(0,0,0,0),a}}),m.each([["Years","FullYear"],["Months","Month"],["Days","Date"],"Hours","Minutes","Seconds","Milliseconds"],function(a){var b=a,c=a;m.isArray(a)&&(b=a[0],c=a[1]),b="add"+b,m[b]=function(a,b){return a["set"+c](a["get"+c]()+b),a},o.prototype[b]=function(a){return new o(m[b](this._value,a))}}),m.inherit(a,p,{equals:function(){},matches:function(a,b){return new p(m.matches(this._value,a,b))},reset:function(){},clone:function(){return new p(m.clone(this._value))}});var H=m.core;H.expressionsCreated=!0,H.trigger&&H.trigger("expressionsCreated"),H.createExpression=function(b){var c;return b instanceof Array||b&&b.jquery?new S(b):"string"==typeof b||b instanceof String?new f(b):"number"==typeof b||b instanceof Number?new n(b):b instanceof Date?new o(b):"[object RegExp]"===(c=g.call(b))?new p(b):null==b?new a(b):"__blocks.expression__"==b._prototypeIndentification?b:"[object Function]"==c?new j(b):new T(b)},H.isExpression=function(a){return a&&"__blocks.expression__"==a._prototypeIndentification},H.staticExpression={range:function(a,b,c){c=c||1,1==arguments.length&&(b=a,a=0);var d=new S([]);return d.range(a,b,c)},repeat:function(){}},H.isArrayExpression=function(a){return ChildArrayExpression.prototype.isPrototypeOf(a)},H.isObjectExpression=function(a){return ChildObjectExpression.prototype.isPrototypeOf(a)};var X={array:S,object:T},Y=m.toObject(["value","not","and","or","type","is","result"]);m.core.applyExpressions=function(a,b,c){if(X[a]){var d,e=X[a].prototype;for(d in e)b[d]||Y[d]||!m.isFunction(e[d])||c&&!c[d]||(b[d]=q(d))}};var Z=m.extend({},J,K,L);for(var G in Z)v(G);m.forEach=m.each;var $=m.at,w=v("at");m.at=function(a,b,c){return m.isNumber(a)?$(a):w(a,b,c)};var _=m.first,aa=v("first");m.first=function(a,b,c){return 0==arguments.length?_:aa(a,b,c)};var ba=m.last,ca=v("last");m.last=function(a,b,c){return 0==arguments.length?ba:ca(a,b,c)};var da=m.contains;m.contains=function(a,b){return m.isString(a)?a.indexOf(b)!=-1:da(a,b)}}(),function(){var b=function(){function a(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}return a}(),c=function(){var a=function(){function b(b){return function(c,d){return arguments.length>1?a.on(this,b,c,d):a.on(this,b,c),this}}var c={on:function(b,c,d){return arguments.length>2?a.on(this,b,c,d):a.on(this,b,c),this},once:function(b,c,d){a.once(this,b,c,d)},off:function(b,c){a.off(this,b,c)},trigger:function(b){a.trigger(this,b,m.toArray(arguments).slice(1,100))}};return c._trigger=c.trigger,{register:function(a,d){d=m.isArray(d)?d:[d];for(var e=0;e<d.length;e++){var f=d[e];c[f]?a[f]=c[f]:a[f]=b(f)}},on:function(a,b,c,d){b=m.toArray(b).join(" ").split(" ");var e,f=0,g=b.length;if(c)for(a._events||(a._events={});f<g;f++)e=b[f],a._events[e]||(a._events[e]=[]),a._events[e].push({callback:c,thisArg:d})},once:function(b,c,d,e){a.on(b,c,d,e),a.on(b,c,function(){a.off(b,c,d)})},off:function(a,b,c){m.isFunction(b)&&(c=b,b=void 0),void 0!==b||void 0!==c?m.each(a._events,function(d,e){void 0!==b&&void 0===c?a._events[b]=[]:m.each(d,function(b,d){if(b.callback==c)return a._events[e].splice(d,1),!1})}):a._events=void 0},trigger:function(a,b){var c,d,e,f=!0;return a&&a._events&&(c=a._events[b],c&&c.length>0&&(e=Array.prototype.slice.call(arguments,2),m.each(c,function(b){b&&(d=a,void 0!==b.thisArg&&(d=b.thisArg),b.callback.apply(d,e)===!1&&(f=!1))}))),f},has:function(a,b){return!!m.access(a,"_events."+b+".length")}}}();return a}();!function(){!function(){function a(){if("complete"===document.readyState)setTimeout(e);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",d,!1),window.addEventListener("load",d,!1);else{document.attachEvent("onreadystatechange",d),window.attachEvent("onload",d);var a=!1;try{a=null==window.frameElement&&document.documentElement}catch(a){}a&&a.doScroll&&!function b(){if(!m.isDomReady){try{a.doScroll("left")}catch(a){return setTimeout(b,50)}e()}}()}}function d(){(document.addEventListener||"load"==event.type||"complete"==document.readyState)&&e()}function e(){m.isDomReady||(m.isDomReady=!0,c.trigger(m.core,"domReady"),c.off(m.core,"domReady"))}m.isDomReady=!1,m.domReady=function(d,e){"undefined"==typeof document||"undefined"==typeof window||window.__mock__&&document.__mock__||(d=b(d,e),m.isDomReady||"complete"==document.readyState||window.jQuery&&window.jQuery.isReady?(m.isDomReady=!0,d()):(c.on(m.core,"domReady",d),a()))}}()}();var d=(Array.prototype.slice,/^\s+|\s+$/gm),e=function(){function a(a){var b={};return m.each(a,function(a){b[a]=!0}),b}return a}(),f="class",g=m.queries={},h=function(){function a(){return!1}function b(){return!0}function c(c){this.originalEvent=c,this.type=c.type,this.isDefaultPrevented=c.defaultPrevented||void 0===c.defaultPrevented&&c.returnValue===!1?b:a,this.timeStamp=c.timeStamp||+new Date}var d=/^(?:mouse|pointer|contextmenu)|click/,e=/^key/;return c.PropertiesToCopy={all:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),mouse:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),keyboard:"char charCode key keyCode".split(" ")},c.CopyProperties=function(a,b,d){m.each(c.PropertiesToCopy[d],function(c){b[c]=a[c]})},c.prototype={preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=b,a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=b,a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=b,a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},c.fix=function(a){var b=a.type,f=new c(a);return c.CopyProperties(a,f,"all"),f.target||(f.target=a.srcElement||document),3===f.target.nodeType&&(f.target=f.target.parentNode),f.metaKey=!!f.metaKey,d.test(b)?c.fixMouse(a,f):e.test(b)&&null==f.which&&(c.CopyProperties(a,f,"keyboard"),f.which=null!=a.charCode?a.charCode:a.keyCode),f},c.fixMouse=function(a,b){var d,e,f,g=a.button,h=a.fromElement;c.CopyProperties(a,b,"mouse"),null==b.pageX&&null!=a.clientX&&(e=b.target.ownerDocument||document,f=e.documentElement,d=e.body,b.pageX=a.clientX+(f&&f.scrollLeft||d&&d.scrollLeft||0)-(f&&f.clientLeft||d&&d.clientLeft||0),b.pageY=a.clientY+(f&&f.scrollTop||d&&d.scrollTop||0)-(f&&f.clientTop||d&&d.clientTop||0)),!b.relatedTarget&&h&&(b.relatedTarget=h===b.target?a.toElement:h),b.which||void 0===g||(b.which=1&g?1:2&g?3:4&g?2:0)},c}(),i=function(){function a(a,b,c){a.addEventListener&&"propertychange"!=b?a.addEventListener(b,function(a){c.call(this,h.fix(a))},!1):a.attachEvent&&a.attachEvent("on"+b,function(a){c.call(this,h.fix(a))})}return a}(),j=function(){function a(a,b){return a&&"string"==typeof a&&null!=b?(a=" "+a+" ",a.indexOf(" "+b+" ")):-1}return a}(),k=Object.prototype.hasOwnProperty,l=function(){function a(a){return b[a]}var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},c=function(){var a=[];for(var c in b)a.push(c);return new RegExp("("+a.join("|")+")","g")}(),d={forRegEx:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},forHTML:function(b){return m.isString(b)?b.replace(c,a):b},forHTMLAttributes:function(a){return m.isString(a)?a.replace(/"/g,"&quot;"):a}};return d}(),n="__blocks.VirtualElement__",o="data-id",p="data-query",q=function(){function a(a){var b=document.createDocumentFragment(),c=document.createElement("div"),d=1,e="<table>",f="</table>",g="<tbody>",h="</tbody>",i="<tr>",j="</tr>";for(a=a.toString(),a.indexOf("<option")!=-1&&a.indexOf("<select")==-1?(a="<select>"+a+"</select>",d=2):a.indexOf("<table")==-1&&(a.match(/<(tbody|thead|tfoot)/)?(d=2,a=e+a+f):a.indexOf("<tr")!=-1?(d=3,a=e+g+a+h+f):a.match(/<(td|th)/)&&(d=4,a=e+g+i+a+j+h+f)),c.innerHTML="A<div>"+a+"</div>";d--;)c=c.lastChild;for(;c.firstChild;)b.appendChild(c.firstChild);return b}return a}(),r=function(){function a(a){if(a)return parseFloat(a[1])}var b={};return"undefined"!=typeof document&&m.extend(b,{IE:document&&function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:void 0}(),Opera:window&&window.navigator&&window.opera&&window.opera.version&&parseInt(window.opera.version(),10)||void 0,Safari:window&&window.navigator&&a(window.navigator.userAgent.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),Firefox:window&&window.navigator&&a(window.navigator.userAgent.match(/Firefox\/([^ ]*)/))}),b}(),s=function(){var a=function(){function b(a){var b=a?y.Is(a)?a._state?a._state.attributes[o]:a._attributes[o]:1==a.nodeType?a.getAttribute(o):8==a.nodeType?/\s+(\d+):[^\/]/.exec(a.nodeValue):null:null;return m.isArray(b)?b[1]:b}function c(a,b){y.Is(a)?a.attr(o,b):1==a.nodeType&&a.setAttribute(o,b)}var d={},e=1;return{id:function(a){return b(a)},collectGarbage:function(){m.each(d,function(b){b&&b.dom&&!document.body.contains(b.dom)&&a.clear(b.id,!0)})},createIfNotExists:function(a){var f,g,h=a&&a.__identity__==n;return f=h?d[a._getAttr(o)]:d[a&&b(a)],f||(g=e++,a&&(h&&a._each?(a._haveAttributes=!0,a._state?a._state.attributes[o]=g:a._attributes[o]=g):c(a,g)),f=a?d[g]={id:g,virtual:h?a:null,animating:0,observables:{},preprocess:h}:d[g]={id:g,observables:{}}),f},byId:function(a){return d[a]},data:function(a,c,e){var f=d[b(a)||a];if(f)return 1==arguments.length?f:(arguments.length>2&&(f[c]=e),f[c])},clear:function(a,c){var e=b(a)||a,f=d[e];!f||f.haveData&&!c||(m.each(f.observables,function(a){for(var b=0;b<a._elements.length;b++)a._elements[b].elementId==f.id&&(a._elements.splice(b,1),b--);if(a._expressions){for(b=0;b<a._expressions.length;b++)a._expressions[b].elementId==f.id&&(a._expressions.splice(b,1),b--);a._expressionKeys[f.id]=null}}),d[e]=void 0,y.Is(a)?a.removeAttr(o):1==a.nodeType&&a.removeAttribute(o))}}}();return a}(),t=function(){function a(a,c,d){b[c]?b[c](a,d,function(b,c){i(a,b,c)}):i(a,c,d)}var b={input:function(a,b,d){function e(a){clearTimeout(g),b(a)}function f(){g||(g=setTimeout(e,4))}var g;r.IE<10?(d("propertychange",function(a){"value"===a.originalEvent.propertyName&&e(a)}),8==r.IE&&(d("keyup",e),d("keydown",e)),r.IE>=8&&(c(a,e),d("dragend",f))):(d("input",e),r.Safari<7&&"textarea"==a.tagName.toLowerCase()?(d("keydown",f),d("paste",f),d("cut",f)):r.Opera<11?d("keydown",f):r.Firefox<4&&(d("DOMAutoComplete",e),d("dragdrop",e),d("drop",e)))}},c=function(){function a(a){var b=this.activeElement,c=b&&s.data(b,"selectionchange");c&&c(a)}var b=!1;return function(c,d){b||(i(c.ownerDocument,"selectionchange",a),b=!0),s.createIfNotExists(c).selectionChange=d}}();return a}(),u=function(){var a=m.dom={valueTagNames:{input:!0,textarea:!0,select:!0},valueTypes:{file:!0,hidden:!0,password:!0,text:!0,color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,time:!0,url:!0,week:!0},props:{for:!0,class:!0,value:!0,checked:!0,tabindex:!0,className:!0,htmlFor:!0},propFix:{for:"htmlFor",class:"className",tabindex:"tabIndex"},attrFix:{className:"class",htmlFor:"for"},addClass:function(a,b){a&&z("add",a,b)},removeClass:function(a,b){a&&z("remove",a,b)},html:function(b,c){if(b)if(c=c.toString(),8==b.nodeType)a.comment.html(b,c);else if(r.IE<10){for(;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(q(c))}else b.innerHTML=c},css:function(a,b,c){a&&b&&("display"==b?A.setVisibility(a,"none"!=c):a.style[b]=c)},on:function(a,b,c){a&&t(a,b,c)},off:function(){},removeAttr:function(b,c){b&&c&&a.attr(b,c,null)},attr:function(b,c,d){var f=a.props[c];if(c=a.propFix[c.toLowerCase()]||c,(!m.core.skipExecution||m.core.skipExecution.element!==b||m.core.skipExecution.attributeName!=c)&&b)return 8==b.nodeType?void a.comment.attr(b,c,d):("checked"==c&&(d=("checked"==d||"string"!=typeof d||"radio"!=b.getAttribute("type")||d==b.value||null==b.defaultValue||""===b.defaultValue)&&(m.isArray(d)?d.indexOf(b.value)!==-1:!!d)),1===arguments.length?f?b[c]:b.getAttribute(c):void(null!=d?"value"==c&&"select"==b.tagName.toLowerCase()?(d=e(m.toArray(d)),m.each(b.children,function(a){a.selected=!!d[a.value]})):f?b[c]=d:b.setAttribute(c,d):f?"value"==c&&"select"==b.tagName.toLowerCase()?b.selectedIndex=-1:b[c]&&(b[c]=""):b.removeAttribute(c)))},comment:{html:function(a,b){for(var c,d=a,e=d.parentNode,f=d.nextSibling,g=0;f&&(8!=f.nodeType||f.nodeValue.indexOf("/blocks")==-1);)g++,c=f.nextSibling,e.removeChild(f),f=c;return e.insertBefore(q(b),d.nextSibling),g},attr:function(a,b,c){if(a&&b==o&&c){var e=a,f=a._endElement;return e.nodeValue=" "+c+":"+e.nodeValue.replace(d,"")+" ",f.nodeValue=" "+c+":"+f.nodeValue.replace(d,"")+" ",this}return this}}};return m.dom}(),v={},w=function(){var a=function(){var a=[];return{startObserving:function(){a.push([])},stopObserving:function(){return a.pop()},currentObservables:function(){return a[a.length-1]},registerObservable:function(b){var c=a[a.length-1],d=!1;c&&(m.each(c,function(a){if(a===b)return d=!0,!1}),d||c.push(b))}}}();return a}(),x=function(){function a(){var b=this.element;this.element=null,this.clone=null;var c=m.clone(this,!0);return c.clone=this.clone=a,this.element=b,c}var b={Html:0,ValueOnly:2,Raw:3,NodeWise:4,Create:function(b,c,d){for(var e,f,g,h=-1,i=0,j=[];b.length>++h;)e=b.charAt(h),"{"==e&&"{"==b.charAt(h+1)?f=h+2:"}"==e&&"}"==b.charAt(h+1)&&(f&&(g=b.substring(f,h),c||(g=g.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")),e=b.substring(i,f-2),e&&j.push({value:e}),j.push({expression:g,attributeName:c}),i=h+2),f=0);return e=b.substring(i),e&&j.push({value:e}),j.text=b,j.attributeName=c,j.element=d,j.isExpression=!0,j.nodeLength=0,j.clone=a,g?j:null},GetValue:function(a,c,d,e){var f,g,h,i=e==b.NodeWise,j=i||e==b.Raw?[]:"",k=d.length,l=-1;if(e=e||b.Html,!a)return d.text;if(e!==b.ValueOnly&&(d.nodeLength=0),1==k)i?(g=d.nodeLength,h=b.Execute(a,c,d[0],d,e),d.nodeLength-g==2&&(j[d.nodeLength-2]=null),j[d.nodeLength-1]=h):j=b.Execute(a,c,d[0],d,e);else for(;++l<k;)g=d.nodeLength,f=d[l],f.value?(e!==b.ValueOnly&&0===d.nodeLength&&d.nodeLength++,h=f.value):(h=b.Execute(a,c,f,d,e),i&&d.nodeLength-g==2&&(j[d.nodeLength-2]=null)),i?j[d.nodeLength-1]=(j[d.nodeLength-1]||"")+h:e==b.Raw?j.push(h):j+=h;return d.lastResult=j,j},Execute:function(a,c,d,e,f){var g,h,i,j,k,n,o=d.expression,p=d.attributeName;return n=v[o]=v[o]||new Function("c","with(c){with($this){ return "+o+"}}"),w.startObserving(),k=n(a),g=m.isObservable(k),j=g?k():k,j=null==j?"":j.toString(),j=p?l.forHTMLAttributes(j):l.forHTML(j),i=w.stopObserving(),f==b.Raw?{observables:i,result:j,value:k}:(f!=b.ValueOnly&&f!=b.NodeWise&&(g||i.length)?(p||(c=s.createIfNotExists()),c&&(c.haveData=!0,h={length:j.length,attr:p,context:a,elementId:c.id,expression:o,entire:e},m.each(i,function(a){a._expressionKeys[c.id+(p||"expression")+"["+o+"]"]||(a._expressionKeys[c.id+(p||"expression")+"["+o+"]"]=!0,a._expressions.push(h)),c.observables[a.__id__+(p||"expression")+"["+o+"]"]=a})),p||(e.nodeLength+=2,j="<!-- "+c.id+":blocks -->"+j)):p||f===b.ValueOnly||(f==b.NodeWise&&g?e.nodeLength+=2:0===e.nodeLength&&e.nodeLength++),j)}};return b}(),y=function(){function a(b){return a.prototype.isPrototypeOf(this)?(this.__identity__=n,this._tagName=b?b.toString().toLowerCase():null,this._attributes={},this._attributeExpressions=[],this._parent=null,this._children=[],this._isSelfClosing=!1,this._haveAttributes=!0,this._innerHTML=null,this._renderMode=a.RenderMode.All,this._haveStyle=!1,this._style={},this._states=null,this._state=null,void(m.isElement(b)&&(this._el=b))):new a(b)}function b(a,b){var d,e,f=' style="',g=!1;for(d in a)e=a[d],b&&k.call(b.style,d)||(e||0===e)&&(g=!0,d=d.replace(/[A-Z]/g,c),f+=d,f+=":",f+=e,f+=";");if(b)for(d in b.style)e=b.style[d],(e||0===e)&&(g=!0,d=d.replace(/[A-Z]/g,c),f+=d,f+=":",f+=e,f+=";");return f+='"',g?f:""}function c(a){return"-"+a.toLowerCase()}return m.VirtualElement=m.inherit(a,{tagName:function(a){return a?(this._tagName=a,this):this._tagName},html:function(a){return arguments.length>0?(a=null==a?"":a,this._state?this._state.html!==a&&(this._state.html=a,u.html(this._el,a)):(this._innerHTML=a,u.html(this._el,a)),this._children=[],this):this._innerHTML||""},text:function(a){return arguments.length>0?(null!=a&&(a=l.forHTML(a),this.html(a)),this):this.html()},parent:function(){return this._parent},children:function(a){return"number"==typeof a?this._children[a]:this._children},attr:function(a,b){var c,d=this;if("string"==typeof a){var f=this._tagName,g=this._attributes.type,h=b,i=s.data(this),j=this._getAttr("value");if(a=m.unwrapObservable(a),a=u.attrFix[a]||a,b=m.unwrapObservable(b),m.isObservable(h)&&"value"==a&&u.valueTagNames[f]&&(!g||u.valueTypes[g])?(i.subscribe="select"==f?"change":"input",i.valueObservable=h):!m.isObservable(h)||"checked"!=a||"checkbox"!=g&&"radio"!=g||(i.subscribe="click",i.valueObservable=h),1==arguments.length)return c=this._getAttr(a),void 0===c?null:c;"checked"!=a||null==b||this._fake?"disabled"==a&&(b=b?"disabled":null):b="radio"!=this._attributes.type||"string"!=typeof b||j==b||null==j||m.isArray(b)?m.isArray(b)?b.indexOf(j)!==-1?"checked":null:b?"checked":null:null,"textarea"!=f||"value"!=a||this._el?"value"==a&&"select"==f?(this._values=e(m.toArray(b)),u.attr(this._el,a,b)):(this._haveAttributes=!0,this._state?this._state.attributes[a]!==b&&(this._state.attributes[a]=b,u.attr(this._el,a,b)):(this._attributes[a]=b,u.attr(this._el,a,b))):this.html(b)}else m.isPlainObject(a)&&m.each(a,function(a,b){d.attr(b,a)});return this},removeAttr:function(a){return this._attributes[a]=null,u.removeAttr(this._el,a),this},css:function(b,c){var d=this;if("string"==typeof b){if(b=m.unwrap(b),c=m.unwrap(c),!b)return;if(b=b.toString().replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()}),1===arguments.length)return c=this._getCss(b),void 0===c?null:c;"display"==b&&(c="none"==c||!c&&""!==c?"none":""),this._haveStyle=!0,a.CssNumbers[b]||(c=m.toUnit(c)),this._state?this._state.style[b]!==c&&(this._state.style[b]=c,u.css(this._el,b,c)):(this._style[b]=c,u.css(this._el,b,c))}else m.isPlainObject(b)&&m.each(b,function(a,b){d.css(b,a)});return this},addChild:function(a,b){var c,d=this._template||this._children;return a&&(a._parent=this,this._childrenEach||this._each?a._each=!0:this._el&&(c=q(a.render(m.domQuery(this))),a._el=c.childNodes[0],"number"==typeof b?this._el.insertBefore(c,this._el.childNodes[b]):this._el.appendChild(c)),"number"==typeof b?d.splice(b,0,a):d.push(a)),this},addClass:function(a){return z("add",this,a),u.addClass(this._el,a),this},removeClass:function(a){return z("remove",this,a),u.removeClass(this._el,a),this},toggleClass:function(a,b){b===!1?this.removeClass(a):this.addClass(a)},hasClass:function(a){return j(this._attributes[f],a)!=-1},renderBeginTag:function(){var a;return a="<"+this._tagName,this._haveAttributes&&(a+=this._renderAttributes()),this._haveStyle&&(a+=b(this._style,this._state)),a+=this._isSelfClosing?" />":">"},renderEndTag:function(){return this._isSelfClosing?"":"</"+this._tagName+">"},render:function(b,c){var d="",e="",f=this._el;return void 0!==c&&(this._state={attributes:{},style:{},html:null,expressions:{},template:m.clone(this._template||this._children)},this._states||(this._states={}),this._states[c]=this._state),this._el=void 0,this._execute(b),this._el=f,this._renderMode!=a.RenderMode.None&&(this._renderMode!=a.RenderMode.ElementOnly&&(e=this._state&&null!==this._state.html?this._state.html:null!=this._innerHTML?this._innerHTML:this.renderChildren(b,c)),d+=this.renderBeginTag(),d+=e,d+=this.renderEndTag()),this._state=null,d},renderChildren:function(b,c){for(var d,e,f="",g=this._state&&this._state.template||this._template||this._children,h=g.length,i=-1;++i<h;)d=g[i],"string"==typeof d?f+=d:a.Is(d)?(d._each=d._each||this._each,f+=d.render(b,c)):b?(e=x.GetValue(b._context,null,d),this._state&&(this._state.expressions[i]=e),f+=e):f+=!this._each&&d.lastResult?d.lastResult:x.GetValue(null,null,d);return f},sync:function(b,c,d){
c&&(this._state=this._states[c],this._el=d,this._each=!1,this._sync=!0),this._execute(b),this.renderBeginTag(),this._innerHTML||this._childrenEach||this._renderMode==a.RenderMode.None||this.syncChildren(b,c),this.renderEndTag(),c&&(this._state=null,this._el=void 0,this._each=!0,this._sync=!1)},syncChildren:function(b,c,d){for(var e,f,g,h,i,j,k=this._state&&this._state.template||this._template||this._children,l=k.length,n=this._state,o=8==this._el.nodeType?this._el:this._el.childNodes[d||0],p=-1;++p<l;)if(i=k[p],i.isExpression){if(b&&(h=x.GetValue(b._context,null,i,n?x.NodeWise:x.Html),!n||n&&n.expressions[p]!==h))if(n)j=n.expressions[p],n.expressions[p]=h,o?m.each(h,function(a,b){return null==a||8==o.nodeType||m.isArray(j)&&j[b]==a?void(o=o.nextSibling):(o.nodeValue=a,void(o=o.nextSibling))}):this._el.textContent=h.join();else for(g=q(h),f=c?i.nodeLength:1,this._el.insertBefore(g,o);f-- >0;)e=o,o=o.nextSibling,this._el.removeChild(e)}else"string"!=typeof i&&i._renderMode!=a.RenderMode.None?(i._each=i._each||this._each,i.sync(b,c,o),o=o.nextSibling):o=o.nextSibling},updateChildren:function(b,c,d,e){for(var f=this._state&&this._state.template||this._template,g=f[0],h=1===f.length&&a.Is(g),i=e.childNodes,j=d.getSyncIndex(),k=this._length(),l=this._state&&this._state.headers||this._headers,n=l?l.length:0,o=-1;++o<c;)d.dataIndex(m.observable.getIndex(b,o)),d.pushContext(b[o]),h?g.sync(d,j+o,i[o+n]):this.syncChildren(d,j+o,o*k+n),d.popContext();d.popContext()},clone:function(){var b=this._el,c=this._parent;this._parent=null,this._el=null,this.clone=null;var d=m.clone(this,!0);return d.clone=this.clone=a.prototype.clone,d._parent=this._parent=c,this._el=b,d},_length:function(){for(var b=this._template,c=-1,d=0;++c<b.length;)b[c]._renderMode!==a.RenderMode.None&&(d+=b[c].isExpression&&b[c].nodeLength?b[c].nodeLength:1);return d},_getAttr:function(a){var b=this._state;return b&&void 0!==b.attributes[a]?b.attributes[a]:this._attributes[a]},_getCss:function(a){var b=this._state;return b&&void 0!==b.style[a]?b.style[a]:this._style[a]},_execute:function(b){if(b&&(this._each&&(this._el=void 0),this._renderMode!=a.RenderMode.None)){var c,d=this._attributes[o];d&&!b._serverData||(s.createIfNotExists(this),b.applyContextToElement(this),d=this._attributes[o],c=s.byId(d)),this._attributeExpressions.length&&this._executeAttributeExpressions(b._context),b.executeQuery(this,this._attributes[p]),c&&!c.haveData&&s.clear(this)}},_renderAttributes:function(){var a,b,c=this._attributes,d=this._state,e="";"option"==this._tagName&&this._parent._values&&(d&&"undefined"!=typeof d.attributes.value?d.attributes.selected=this._parent._values[d.attributes.value]?"selected":null:c.selected=this._parent._values[c.value]?"selected":null);for(a in c)b=c[a],d&&k.call(d.attributes,a)||(""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+l.forHTMLAttributes(b)+'"'));if(d)for(a in d.attributes)b=d.attributes[a],""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+l.forHTMLAttributes(b)+'"');return e},_createAttributeExpressions:function(a){var b,c=this._attributeExpressions,d=this._attributes[o],e=this._each;m.each(this._attributes,function(f,g){f&&(b=!e&&a&&a[d+g]?x.Create(a[d+g],g):x.Create(f,g),b&&c.push(b))})},_setChildren:function(a){this._children=a,(this._template||this._each)&&(this._template=m.clone(a,!0)),this._state&&(this._state.template=m.clone(a,!0))},_executeAttributeExpressions:function(a){for(var b,c,d,e=!this._el,f=this._state&&this._state.attributes,g=s.byId(f?f[o]:this._attributes[o]),h=this._attributeExpressions,i=0;i<h.length;i++)c=h[i],d=x.GetValue(a,g,c),b=c.attributeName,(f&&f[b]!==d||!f)&&(e&&!this._state?this._attributes[b]=d:e||u.attr(this._el,b,d),this._state&&(this._state.attributes[b]=d))}}),a.Is=function(a){return a&&a.__identity__==n},a.RenderMode={All:0,ElementOnly:2,None:4},a.CssNumbers={columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},a}(),z=function(){function a(a,c,e){if(null!=e){e=m.isArray(e)?e:e.toString().split(" ");var g,h,i,k=0;if(y.Is(c))g=c._getAttr(f);else{if(c.classList)return void(b?c.classList[a].apply(c.classList,e):m.each(e,function(b){c.classList[a](b)}));g=c.className}for(g=g||"";k<e.length;k++)h=e[k],i=j(g,h),"add"==a?i<0&&(""!==g&&(h=" "+h),g+=h):i!=-1&&(g=(g.substring(0,i)+" "+g.substring(i+h.length+1,g.length)).replace(d,""));y.Is(c)?c._state?c._state.attributes[f]=g:c._attributes[f]=g:c.className=g}}var b=!0;if("undefined"!=typeof document){var c=document.createElement("div");c.classList&&(c.classList.add("a","b"),b="a b"==c.className)}return a}(),A=function(){function a(a,b){var c=s.data(a);if(c&&c.animating>0){for(var d,e=a.childNodes,f=0,g=0;b!=g;){if(!e[f])return Number.POSITIVE_INFINITY;d=e[f].className,f++,j(d,"b-hide")==-1&&g++}if(!e[f])return Number.POSITIVE_INFINITY;for(d=e[f].className;j(d,"b-hide")!=-1;){if(f++,!e[f])return Number.POSITIVE_INFINITY;d=e[f].className}return f}return b}function b(a,b){var d=!1,e=s.createIfNotExists(b),f=s.createIfNotExists(b.parentNode),g=e.animateCallback,h="remove"==a?"hide":"add"==a?"show":a,i="remove"==a?function(){s.clear(b,!0),b.parentNode&&b.parentNode.removeChild(b)}:"hide"==a?function(){b.style.display="none"}:m.noop,j=function(){e.animating-=1,f.animating-=1,e.animating||i()};if(1!=b.nodeType)return void i();if("show"==a&&(b.style.display=""),e.preprocess)return void i();if(g){d=!0,e.animating+=1,f.animating+=1;var k=m.context(b),l=k.$view||k.$root;g.call(l,b,j,h)}return d||c(h,b,i,j)}function c(a,b,c,e){function f(){z("remove",b,"b-"+a),z("remove",b,"b-"+a+"-end"),e(),b.removeEventListener("transitionend",f,!1),b.removeEventListener(g,f,!1)}if("undefined"==typeof window||void 0===window.ontransitionend)return void c();z("add",b,"b-"+a);var g,h=window.getComputedStyle(b),i="";void 0===window.onanimationend&&void 0!==window.onwebkitanimationend?(i="-webkit-",g="webkitAnimationEnd"):g="animationend";var j=parseFloat(h["transition-duration"])||0,k=parseFloat(h["transition-delay"])||0,l=parseFloat(h[i+"animation-duration"])||0,m=parseFloat(h[i+"animation-delay"])||0;return j<=0&&k<=0&&l<=0&&m<=0||!d(b,a)?(z("remove",b,"b-"+a),void c()):(s.createIfNotExists(b).animating+=1,s.createIfNotExists(b.parentNode).animating+=1,setTimeout(function(){z("add",b,"b-"+a+"-end"),b.addEventListener("transitionend",f,!1),b.addEventListener(g,f,!1)},1),!0)}function d(a,b){var c,d,e,g=f[a.className+a.getAttribute("style")+a.tagName],h=!1;return g||g===!1?g:(z("remove",a,"b-"+b),d=m.extend({},window.getComputedStyle(a)),z("add",a,"b-"+b),z("add",a,"b-"+b+"-end"),e=window.getComputedStyle(a),c=e.transitionProperty.split(","),m.each(c,function(a){if(a=a.trim().replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()}),"all"==a){for(var b in e)e[b]!=d[b]&&(h=!0);return!1}if(e[a]!=d[a])return h=!0,!1}),z("remove",a,"b-"+b+"-end"),f[a.className+a.getAttribute("style")+a.tagName]=h,h)}var e={insert:function(c,d,e){d=a(c,d);var f,g,h=c.childNodes[d];m.each(e,function(a){if(f=11==a.nodeType?a.childNodes.length:0,g=a.childNodes?a.childNodes[0]:void 0,h?c.insertBefore(a,h):c.appendChild(a),f)for(;f;)b("add",g),g=g.nextSibling,f--;else b("add",a)})},remove:function(c,d,e){var f,g=0;for(d=a(c,d);g<e;g++)f=c.childNodes[d],f&&b("remove",f)&&d++},setVisibility:function(a,b){b?e.show(a):e.hide(a)},show:function(a){b("show",a)},hide:function(a){b("hide",a)}},f={};return e}(),B=function(){function a(b){return a.prototype.isPrototypeOf(this)?(this.__Class__(),void(8==b.nodeType?(this._commentText=b.nodeValue,this._el=b):this._commentText=b)):new a(b)}return m.VirtualComment=m.inherit(y,a,{renderBeginTag:function(){var a=this._getAttr(o),b="<!-- ";return a&&(b+=a+":"),b+=l.forHTML(this._commentText.replace(d,""))+" -->"},renderEndTag:function(){var a=this._getAttr(o),b="<!-- ";return a&&(b+=a+":"),b+="/blocks -->"},_executeAttributeExpressions:m.noop}),a.Is=function(b){return a.prototype.isPrototypeOf(b)},a}(),C=function(){var b=null;if(a.document&&a.document.body){var c=document.body.getAttribute("data-blocks-server-data");c&&(document.body.removeAttribute("data-blocks-server-data"),b=JSON.parse(c.replace("&quot;",'"')))}return b}(),D=function(){function a(e,f){for(var g,h,i,j,k,l,n,o,q,s=[];e;){if(l=e.nodeType,1==l){h=e.tagName.toLowerCase(),g=new y(e),g._tagName=h,g._parent=f,f&&(g._each=f._each||f._childrenEach),g._haveAttributes=!1,j=e.attributes,i={};for(var t=0;t<j.length;t++)k=j[t],"style"!==k.nodeName&&(k.specified||r.IE<8&&"value"==k.nodeName&&k.nodeValue)&&(i[k.nodeName.toLowerCase()]=r.IE<11?k.nodeValue:k.value,g._haveAttributes=!0);g._attributes=i,g._createAttributeExpressions(C),e.style.cssText&&(g._haveStyle=!0,g._style=b(e.style.cssText)),c(g),"script"==h||"style"==h||"code"==h||g.hasClass("bl-skip")?g._innerHTML=e.innerHTML:g._children=a(e.childNodes[0],g),s.push(g)}else if(3==l)q=e.data,s.push(x.Create(q,null,e)||q);else if(8==l)if(n=e.nodeValue,o=n.replace(d,""),0===o.indexOf("blocks"))g=new B(e),g._parent=f,g._attributes[p]=o.substring(6),q=a(e.nextSibling,g),g._children=q.elements,g._el._endElement=q.htmlElement,e=q.htmlElement||e,s.push(g);else{if(B.Is(f)&&0===o.indexOf("/blocks"))return{elements:s,htmlElement:e};if(B.Is(f))s.push("<!--"+n+"-->");else if(C){var u=parseInt(/[0-9]+/.exec(o),10);!m.isNaN(u)&&C[u]&&s.push(x.Create(C[u]))}else 0!==o.indexOf("/blocks")&&s.push("<!--"+n+"-->")}e=e.nextSibling}return s}function b(a){for(var b,c,e,f=a.split(";"),g={},h=0;h<f.length;h++)c=f[h],c&&(b=c.indexOf(":"),b!=-1&&(e=[c.substring(0,b),c.substring(b+1)],g[e[0].toLowerCase().replace(d,"")]=e[1].replace(d,"")));return g}function c(a){var b,c=a._tagName;return void 0!==e[c]?void(a._isSelfClosing=e[c]):(b=document.createElement("div"),b.appendChild(document.createElement(c)),void(e[c]=a._isSelfClosing=b.innerHTML.indexOf("</")===-1))}var e={};return a}(),E=function(){function a(a){return function(b){return 0===arguments.length?this[a]:(this[a]=b,this)}}return a}(),F=function(){function a(a,b){var c,e,f=0,g=0,h=0,i=0,j=!1,k=!1,l=0,m=[];a=a||"";for(var n=0;n<a.length;n++)f=a.charAt(n),j||k||("["==f?i++:"]"==f?i--:"{"==f?h++:"}"==f&&h--),0===h&&0===i&&("'"==f?j=!j:'"'==f&&(k=!k),j||k||("("==f?(0===g&&(e=a.substring(l,n).replace(d,""),l=n+1),g++):")"==f?(g--,0===g&&(c=a.substring(l,n).replace(d,""),c.length&&m.push(c),e&&(e=e.replace(/^("|')+|("|')+$/g,""),b(e,m)),m=[],e=void 0)):","==f&&1==g?(c=a.substring(l,n).replace(d,""),c.length&&m.push(c),l=n+1):"."==f&&0===g&&(l=n+1)))}return a}(),G=function(){function a(a){this._options=a||{}}function b(b,c){var d=a.QueryCache[b]=[];return F(b,function(a,b){var c=m.queries[a],e={name:a,params:b,query:a+"("+b.join(",")+")"};c&&("attr"==a||"val"==a?d.unshift(e):d.push(e))}),d}a.QueryCache={},a.prototype={options:function(){return this._options},dataIndex:E("_dataIndex"),context:E("_context"),popContext:function(){this._context&&(this._context=this._context.$parentContext)},applyContextToElement:function(a){var b=s.createIfNotExists(a);b.domQuery=this,b.context=this._context,(this._hasChanged||a._each&&!a._parent._each)&&(a._parent&&!a._each&&(b=s.createIfNotExists(a._parent),b.childrenContext=this._context),this._hasChanged=!1,b.haveData=!0)},pushContext:function(a){var b,c=this._context,d=c?c.$parents.slice(0):[];return this._hasChanged=!0,c&&d.unshift(c.$this),b={$this:a,$root:c?c.$root:a,$parent:c?c.$this:null,$parents:c?d:[],$index:this._dataIndex||null,$parentContext:c||null,__props__:m.clone(c&&c.__props__)},b.$context=b,this._context=b,this.applyProperties(),b},getSyncIndex:function(){for(var a=this._context,b="";a&&a.$index;)b=a.$index.__value__+"_"+b,a=a.$parentContext;return b},contextBubble:function(a,b){var c=this._context;this._context=a,b(),this._context=c},addProperty:function(a,b){var c=this._context;c.__props__=c.__props__||{},c.__props__[a]=b,this.applyProperties()},applyProperties:function(){var a,b=this._context.__props__;for(a in b)this._context[a]=b[a]},executeElementQuery:function(a){var b=y.Is(a)?a._attributes[p]:1==a.nodeType?a.getAttribute(p):a.nodeValue.substring(a.nodeValue.indexOf("blocks")+6).replace(d,"");b&&this.executeQuery(a,b)},executeQuery:function(c,d){var e=a.QueryCache[d]||b(d,c);this.executeMethods(c,e)},executeMethods:function(a,b){for(var c,d,e,f,g,h,i,j=s.data(a),k=0,l=0;l<b.length;l++)if(h=this._context,c=m.queries[b[l].name],f=b[l].params,d=c.passDomQuery?[this]:[],!y.Is(a)||c.call||c.preprocess||!c.update&&!c.ready){w.startObserving();for(var n=0;n<f.length;n++)if(g=f[n],i=v[g]=v[g]||new Function("c","with(c){with($this){ return "+g+"}}"),e={},e.rawValue=i(h),e.value=m.unwrapObservable(e.rawValue),c.passDetailValues?(e.parameterName=g,e.isObservable=m.isObservable(e.rawValue),e.containsObservable=w.currentObservables().length>k,k=w.currentObservables().length,d.push(e)):c.passRawValues?d.push(e.rawValue):d.push(e.value),c===m.queries.if||c===m.queries.ifnot){if(!e.value&&c===m.queries.if||e.value&&c===m.queries.ifnot){if(!f[2])break;this.executeQuery(a,f[2]);break}this.executeQuery(a,f[1]);break}if(y.Is(a)){if(B.Is(a)&&!c.supportsComments)continue;if(c.call)c.call===!0?a[b[l].name].apply(a,d):(d.unshift(c.prefix||b[l].name),a[c.call].apply(a,d));else if(c.preprocess&&c.preprocess.apply(a,d)===!1){this.subscribeObservables(b[l],j,h);break}}else if(c.call){var o=s.data(a).virtual;o._each&&(o=y("div"),o._el=a,o._fake=!0),c.call===!0?o[b[l].name].apply(o,d):(d.unshift(c.prefix||b[l].name),o[c.call].apply(o,d))}else j&&j.preprocess&&c.ready?c.ready.apply(a,d):c.update&&c.update.apply(a,d);this.subscribeObservables(b[l],j,h)}else j.haveData=!0,j.execute||(j.execute=[],j.executeHash={}),j.executeHash[b[l].query]||(j.execute.push(b[l]),j.executeHash[b[l].query]=!0)},subscribeObservables:function(a,b,c){var d=w.stopObserving();b&&(b.haveData=!0,m.each(d,function(d){b.observables[d.__id__+a.query]||(b.observables[d.__id__+a.query]=d,d._elements.push({elementId:b.id,element:b.dom||b.virtual._el,cache:[a],context:c}))}))},createElementObservableDependencies:function(a){for(var b,d,e,f=0;f<a.length;f++)if(b=a[f],e=(b.tagName||"").toLowerCase(),1===b.nodeType||8==b.nodeType){if(d=s.data(b)){if(this._context=d.context||this._context,d.dom=b,d.execute&&this.executeMethods(b,d.execute),d.subscribe){var g=d.updateOn||d.subscribe;t(b,g,c[g])}d.preprocess=!1,this._context=d.childrenContext||this._context}"script"!=e&&"code"!=e&&(" "+b.className+" ").indexOf("bl-skip")==-1&&this.createElementObservableDependencies(b.childNodes)}},createFragment:function(a){var b=q(a);return this.createElementObservableDependencies(b.childNodes),b},cloneContext:function(a){var b=m.clone(a);return b.$context=b,b}};var c={change:function(a){var b=a.target||a.srcElement;c.getSetValue(b,s.data(b).valueObservable)},click:function(a){c.change(a)},input:function(a){var b=a.target||a.srcElement;c.getSetValue(b,s.data(b).valueObservable)},keydown:function(a){var b=a.target||a.srcElement,d=b.value,e=s.data(b);e&&setTimeout(function(){d!=b.value&&c.getSetValue(b,s.data(b).valueObservable)})},getSetValue:function(a,b){var c=a.tagName.toLowerCase(),d=a.getAttribute("type");if(!m.isArray(b())||"checkbox"!=d&&"radio"!=d)if("checkbox"==d)b(a.checked);else if("select"==c&&null!==a.getAttribute("multiple")){var e=[],f=a.selectedOptions;f?m.each(f,function(a){e.push(a.getAttribute("value"))}):m.each(a.options,function(a){a.selected&&e.push(a.getAttribute("value"))}),b(e)}else m.core.skipExecution={element:a,attributeName:"value"},b(a.value),m.core.skipExecution=void 0;else{var g=b();a.checked?g.indexOf(a.value)==-1&&b.add(a.value):g.indexOf(a.value)!==-1&&b.splice(g.indexOf(a.value),1)}}};return a}();!function(){m.extend(g,{if:{},ifnot:{},template:{passDomQuery:!0,passDetailValues:!0,preprocess:function(a,b,c){var d,e=a._serverData,f=b.parameterName;if(b=b.rawValue,c&&(c=c.rawValue),b=m.$unwrap(b),m.isElement(b)?d=b.innerHTML:(d=document.getElementById(m.isString(b)?b:f),d=d?d.innerHTML:b),d&&(c&&m.queries.with.preprocess.call(this,a,c,"$template"),!e||!e.templates||!e.templates[s.id(this)]))if(this._el)this.html(d),this._each||(this._children=D(this._el.childNodes[0],this),this._innerHTML=null);else{var g=document.createElement("div");g.innerHTML=d;var h=D(g.childNodes[0],this);this._setChildren(h),this._innerHTML=null}}},define:{passDomQuery:!0,preprocess:function(a,b,c){if(this._renderMode!=y.RenderMode.None){var d=a.context(),e=a.cloneContext(d),f=this.renderEndTag;s.data(this).context=e,a.context(e),a.addProperty(b,c),this.renderEndTag=function(){return a.context(d),f.call(this)}}}},with:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){if(this._renderMode!=y.RenderMode.None){var d=this.renderEndTag;a.pushContext(b),c&&a.addProperty(c,b),this.renderEndTag=function(){return a.popContext(),d.call(this)}}}},each:{passDomQuery:!0,passRawValues:!0,supportsComments:!0,_getStaticHtml:function(a,b){var c,e,f,g=b._state&&b._state.template||b._template||b._children,h=b._state&&b._state.headers||b._headers,i=b._state&&b._state.footer||b._footers,j=-1,k="",l="";if(h)for(c=Math.max(h.length,i.length);++j<c;)h[j]&&(k+=h[j].render(a)),i[j]&&(l+=i[j].render(a));else for(b._state?(h=b._state.headers=[],i=b._state.footers=[]):(h=b._headers=[],i=b._footers=[]);++j<g.length;)f=g[j],f.isExpression||("string"!=typeof f?(f._each=!0,e=f._attributes["data-role"],"header"==e?(k+=f.render(a),h.push(f),g.splice(j--,1)):"footer"==e&&(l+=f.render(a),i.push(f),g.splice(j--,1))):""===f.replace(d,"").replace(/(\r\n|\n|\r)/gm,"")&&g.splice(j--,1));return{header:k,headersCount:h.length,footer:l,footersCount:i.length}},preprocess:function(a,b){var c,d,e,f,h=a.getSyncIndex(),i=this,j=0;if(i._sync)return void i.updateChildren(b,b.length,a,this._el);if(i._template=i._template||i._children,i._childrenEach=!0,a._serverData&&(d=a._serverData[s.id(this)],a._serverData[s.id(this)]=void 0,d)){var k=document.createElement("div");k.innerHTML=d,i._template=i._children=D(k.childNodes[0],i),i._state&&(i._state.template=m.clone(i._template,!0))}if(e=g.each._getStaticHtml(a,i),f=e.header,m.isObservable(b)&&(d=s.data(i),d.eachData={id:b.__id__,element:i,startOffset:e.headersCount,endOffset:e.footersCount}),c=m.unwrapObservable(b),m.isArray(c))for(j=0;j<c.length;j++)a.dataIndex(m.observable.getIndex(b,j)),a.pushContext(c[j]),f+=this.renderChildren(a,h+j),a.popContext(),a.dataIndex(void 0);else if(m.isObject(c))for(var l in c)a.dataIndex(m.observable.getIndex(b,j)),a.pushContext(c[l]),f+=i.renderChildren(a),a.popContext(),a.dataIndex(void 0),j++;this.html(f+e.footer)}},options:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){c=c||{};var d,e="$this",f=x.Create("{{"+(c.text||e)+"}}"),g=x.Create("{{"+(c.value||e)+"}}","value"),h=m.isString(c.caption)&&new y("option"),i=new y("option"),j=this._state&&this._state.template||this._template||this._children,k=0;if(this._sync)return void m.queries.each.preprocess.call(this,a,b);for(;k<j.length;k++)d=j[k],(!d._attributes||d._attributes&&!d._attributes["data-role"])&&j.splice(k--,1);i._attributeExpressions.push(g),i._children.push(f),i._parent=this,j.push(i),h&&(h._attributes["data-role"]="header",h._innerHTML=c.caption,h._parent=this,j.push(h)),m.queries.each.preprocess.call(this,a,b)},update:function(a,b){var c,d,e=s.data(this),f=b(),g=e.virtual._state,h=g&&g.headers||e.virtual._headers,i=e.valueObservable,j=(g&&g.template[0]||e.virtual._template[0])._attributeExpressions[0],k=m.isObservable(i)?i._getValue():this.value;if(m.isArray(f))for(var l=0;l<f.length;l++)if(a.dataIndex(m.observable.getIndex(b,l)),a.pushContext(f[l]),c=x.GetValue(a._context,null,j,x.ValueOnly),a.popContext(),0===l&&(d=c),c===k)return;h&&h[0]&&(d=h[0]._attributes.value||h[0]._innerHTML),m.isObservable(i)?i(d):u.attr(this,"value",d)}},render:{passDetailValues:!0,preprocess:function(a){if(!this._each&&!this._sync)throw new Error("render() is supported only() in each context");this._renderMode=a.value?y.RenderMode.All:y.RenderMode.None,a.containsObservable&&this._renderMode==y.RenderMode.None&&(this._renderMode=y.RenderMode.ElementOnly,this.css("display","none"),s.data(this,"renderCache",this))},update:function(a){var b=s.data(this);b.renderCache&&a.value&&(this.innerHTML=b.renderCache.renderChildren(m.domQuery(this)),m.domQuery(this).createElementObservableDependencies(this.childNodes),b.renderCache=null),this.style.display=a.value?"":"none"}},updateOn:{preprocess:function(a){s.data(this).updateOn=a}},animate:{preprocess:function(a){s.data(this).animateCallback=a}},setClass:{preprocess:function(a,b){arguments.length>1?this.toggleClass(a,!!b):this.addClass(a)},update:function(a,b){var c=s.data(this).virtual;c._each&&(c=y(),c._el=this),arguments.length>1?c.toggleClass(a,b):c.addClass(a)}},html:{call:!0},text:{call:!0},visible:{call:"css",prefix:"display"},attr:{passRawValues:!0,call:!0},val:{passRawValues:!0,call:"attr",prefix:"value"},checked:{passRawValues:!0,call:"attr"},disabled:{passRawValues:!0,call:"attr"},css:{call:!0},width:{call:"css"},height:{call:"css"},focused:{preprocess:m.noop,update:function(a){a&&this.focus()}},on:{ready:function(a,b){if(a&&b){var c,d=m.toArray(arguments).slice(2),e=this,f=m.context(this);b=m.toArray(b);var g=function(a){var e=m.clone(d);e.splice(0,0,a),f=m.context(this)||f,c=f.$template||f.$view||f.$root,m.each(b,function(a){a.apply(c,e)})};a=m.isArray(a)?a:a.toString().split(" "),m.each(a,function(a){i(e,a,g)})}}}}),m.each(["click","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","select","change","submit","reset","focus","blur","keydown","keypress","keyup"],function(a){m.queries[a]={passRawValues:!0,ready:function(){var b=m.toArray(arguments);b.splice(0,0,a),m.queries.on.ready.apply(this,b)}}})}();var H="__blocks.observable__",I=function(){function a(a){this.observable=a,this.chunkLengths={},this.dispose()}return a.prototype={dispose:function(){this.childNodesCount=void 0,this.startIndex=0,this.observableLength=void 0,this.startOffset=0,this.endOffset=0},setStartIndex:function(a){this.startIndex=a+this.startOffset},setChildNodesCount:function(a){void 0===this.childNodesCount&&(this.observableLength=this.observable._getValue().length),this.childNodesCount=a-(this.startOffset+this.endOffset)},chunkLength:function(a){var b,c=this.chunkLengths,d=s.id(a),e=c[d]||(this.childNodesCount||a.childNodes.length)/(this.observableLength||this.observable._getValue().length);return b=m.isNaN(e)||e===1/0?0:Math.round(e),c[d]=b,b},getAt:function(a,b){for(var c=this.chunkLength(a),d=a.childNodes,e=[],f=0;f<c;f++)e[f]=d[b*c+f+this.startIndex];return e},insertAt:function(a,b,c){A.insert(a,this.chunkLength(a)*b+this.startIndex,m.isArray(c)?c:[c])},remove:function(a,b){var c=this;this.each(function(d){for(var e=0;e<b;e++)c._removeAt(d,a)}),s.collectGarbage(),this.dispose(),this.observable._indexes.splice(a,b)},add:function(a,b){var c=this,d=this.observable;m.each(a,function(a,c){d._indexes.splice(b+c,0,m.observable(b+c))}),this.each(function(e,f){var g,h=m.domQuery(e),i=m.context(e),j="";if(h.contextBubble(i,function(){g=h.getSyncIndex();for(var c=0;c<a.length;c++)h.dataIndex(m.observable.getIndex(d,c+b,!0)),h.pushContext(a[c]),j+=f.renderChildren(h,g+(c+b)),h.popContext(),h.dataIndex(void 0)}),0===e.childNodes.length)u.html(e,j),h.createElementObservableDependencies(e.childNodes);else{var k=h.createFragment(j);c.insertAt(e,b,k)}}),this.dispose()},each:function(a){for(var b=0,c=this.observable._elements;b<c.length;b++){var d=c[b];d.element||(d.element=s.data(d.elementId).dom),this.setup(d.element,a)}},setup:function(a,b){if(a){var c,d,e,f,g=s.data(a).eachData;if(g&&g.id==this.observable.__id__)if(c=g.element,this.startOffset=g.startOffset,this.endOffset=g.endOffset,1==a.nodeType)this.setStartIndex(0),this.setChildNodesCount(a.childNodes.length),b(a,c,a);else{for(d=s.id(a),f=a.parentNode.firstChild,e=0;f!=a;)f=f.nextSibling,e++;for(this.setStartIndex(e+1);f&&(8!=f.nodeType||1!=f.nodeValue.indexOf(d+":/blocks"));)f=f.nextSibling,e++;this.setChildNodesCount(e-this.startIndex),b(a.parentNode,c,a)}}},_removeAt:function(a,b){var c=this.chunkLength(a);A.remove(a,c*b+this.startIndex,c)}},a}();!function(){function a(a){a._dependencyType&&(a._getDependency=m.bind(b,a),a.on("get",a._getDependency))}function b(){var a=this,b=a.__value__,d=1==a._dependencyType?b:b.get;c.off(a,"get",a._getDependency),a._getDependency=void 0,w.startObserving(),d.call(a.__context__),m.each(w.stopObserving(),function(b){var c=b._dependencies=b._dependencies||[],d=!1;m.each(c,function(b){if(a===b)return d=!0,!1}),d||c.push(a)})}function d(a){var b=a.__context__;return 1==a._dependencyType?a.__value__.call(b):2==a._dependencyType?a.__value__.get.call(b):a.__value__}var e=1;m.observable=function(b,f){var g=function(a){0===arguments.length&&c.trigger(g,"get",g);var b=d(g),e=g.update;return g._executed||(g._firstExecution(b),g._executed=!0),0===arguments.length?(w.registerObservable(g),b):(m.equals(a,b,!1)||c.trigger(g,"changing",a,b)===!1||(g.update=m.noop,g._dependencyType?2==g._dependencyType&&g.__value__.set.call(g.__context__,a):m.isArray(b)&&(m.isArray(a)||!a)&&g.reset?g.reset(a):m.isArray(b)||g.reset||(g.__value__=a),g.update=e,g.update(),c.trigger(g,"change",a,b)),g)};return b=m.unwrap(b),m.extend(g,m.observable.fn.base),g.__id__=e++,g.__value__=b,g.__context__=f||m.__viewInInitialize__||g,g._expressionKeys={},g._expressions=[],g._elementKeys={},g._elements=[],g._executed=!1,g._getValue=function(){return d(g)},m.isArray(b)?m.extend(g,m.observable.fn.array):m.isFunction(b)?g._dependencyType=1:b&&!b.__Class__&&m.isFunction(b.get)&&m.isFunction(b.set)&&(g._dependencyType=2),g._dependencyType&&m.extend(g,m.observable.fn.dependency),g._initialize(),a(g),g};var f={};m.extend(m.observable,{getIndex:function(a,b,c){if(!m.isObservable(a))return f[b]||(f[b]=m.observable(b)),f[b];var d,e=a._indexes;return e?e.length==a.__value__.length||c?d=e[b]:(d=m.observable(b),e.splice(b,0,d)):d=m.observable(b),d},fn:{base:{__identity__:H,_firstExecution:m.noop,_initialize:m.noop,update:function(){var b,c,d,e,f,g,h,i=this._elements;w.startObserving(),m.eachRight(this._expressions,function(a){e=a.element,d=a.context,e||(b=s.data(a.elementId),e=a.element=b.dom);try{h=v[a.expression](d),g=m.unwrap(h)}catch(a){g=""}g=null==g?"":g.toString(),f=a.length-g.length,a.length=g.length,e?(m.isObservable(h)&&h._expressions.indexOf(a)==-1&&h._expressions.push(a),a.attr?u.attr(e,a.attr,x.GetValue(d,null,a.entire)):e.nextSibling?(e=e.nextSibling,e.nodeValue=g+e.nodeValue.substring(a.length+f)):e.parentNode.appendChild(document.createTextNode(g))):(e=b.virtual,a.attr&&e.attr(a.attr,x.GetValue(d,null,a.entire)))});for(var j=0;j<i.length;j++)g=i[j],e=g.element,!e&&s.data(g.elementId)&&(e=g.element=s.data(g.elementId).dom,e||(e=s.data(g.elementId).virtual)),y.Is(e)||document.body.contains(e)?(c=m.domQuery(e),c.contextBubble(g.context,function(){c.executeMethods(e,g.cache)})):(i.splice(j,1),j-=1);return this._dependencies&&m.each(this._dependencies,function(b){a(b),b.update()}),this._indexes&&m.each(this._indexes,function(a,b){a(b)}),w.stopObserving(),this},on:function(a,b,d){return c.on(this,a,b,d||this.__context__),this},once:function(a,b,d){return c.once(this,a,b,d||this.__context__),this},off:function(a,b){return c.off(this,a,b),this},extend:function(a){var b,c=m.observable[a];return 0===arguments.length?(m.core.expressionsCreated&&m.core.applyExpressions(m.type(this()),this),this):c?(b=c.apply(this,m.toArray(arguments).slice(1)),m.isObservable(b)?b:this):void 0},clone:function(a){var b=this.__value__;return m.observable(a?m.clone(b):b,this.__context__)},toString:function(){var a=d(this);return w.registerObservable(this),null!=a&&m.isFunction(a.toString)?a.toString():String(a)},toJSON:function(){return this()}},array:{_initialize:function(){this._indexes=[],this._chunkManager=new I(this)},reset:function(a){if(0===arguments.length)return this.removeAll(),this;if(a=m.unwrap(a),m.isArray(a)||!a){var b=this.__value__,d=this._chunkManager,e=Math.max(a.length-b.length,0),f=Math.max(b.length-a.length,0),g=a.length-e;return c.trigger(this,"removing",{type:"removing",items:b,index:0}),c.trigger(this,"adding",{type:"adding",items:a,index:0}),d.each(function(b,c){var d=m.domQuery(b);d.contextBubble(m.context(b),function(){c.updateChildren(a,g,d,b)})}),e>0?d.add(a.slice(b.length),b.length):f>0&&d.remove(a.length,f),this.__value__=a,this.update(),c.trigger(this,"remove",{type:"remove",items:b,index:0}),c.trigger(this,"add",{type:"add",items:a,index:0}),this}},add:function(a,b){return this.splice(m.isNumber(b)?b:this.__value__.length,0,a),this},addMany:function(a,b){return this.splice.apply(this,[m.isNumber(b)?b:this.__value__.length,0].concat(m.toArray(a))),this},swap:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;m.swap(d,a,b);for(var g=0;g<e.length;g++)c=e[g].element,a>b?(f.insertAt(c,a,f.getAt(c,b)),f.insertAt(c,b,f.getAt(c,a))):(f.insertAt(c,b,f.getAt(c,a)),f.insertAt(c,a,f.getAt(c,b)));return this},move:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;m.move(d,a,b),b>a&&b++;for(var g=0;g<e.length;g++)c=e[g].element,f.insertAt(c,b,f.getAt(c,a));return this},remove:function(a,b){return this.removeAll(a,b,!0)},removeAt:function(a,b){return m.isNumber(b)||(b=1),this.splice(a,b),this},removeAll:function(a,b,d){var e,f,g=this.__value__,h=this._chunkManager;if(0===arguments.length)(c.has(this,"removing")||c.has(this,"remove"))&&(e=m.clone(g)),c.trigger(this,"removing",{type:"removing",items:e,index:0}),h.remove(0,g.length),this._indexes=[],e=g.splice(0,g.length),c.trigger(this,"remove",{type:"remove",items:e,index:0});else{var i,j=m.isFunction(a);for(f=0;f<g.length&&(i=g[f],!(i===a||j&&a.call(b,i,f,g))||(this.splice(f,1),f-=1,!d));f++);}return this.update(),this},concat:function(){var a=this();return a.concat.apply(a,m.toArray(arguments))},slice:function(a,b){return arguments.length>1?this().slice(a,b):this().slice(a)},join:function(a){return arguments.length>0?this().join(a):this().join()},pop:function(){var a=this,b=a();return a.splice(b.length-1,1)[0]},push:function(){return this.addMany(m.toArray(arguments)),this.__value__.length},reverse:function(){var a=this().reverse(),b=this._chunkManager;return this._indexes.reverse(),b.each(function(c){for(var d=1;d<a.length;d++)b.insertAt(c,0,b.getAt(c,d))}),this.update(),a},shift:function(){return this.splice(0,1)[0]},sort:function(a){for(var b,c,d=this.__value__,e=d.length,f=arguments.length>0,g=this._chunkManager,h=this._indexes,i=0;i<e;i++){var j=[d[i],i];g.each(function(a){j.push(g.getAt(a,i))}),d[i]=j}for(d.sort(function(b,c){return b=b[0],c=c[0],f?a.call(this,b,c):b<c?-1:b>c?1:0}),h.length>0&&(this._indexes=[]),i=0;i<e;i++)c=d[i],h.length>0&&this._indexes.push(h[c[1]]),b=2,g.each(function(a){g.insertAt(a,e,c[b]),b++}),d[i]=c[0];return this.update(),d},splice:function(a,b){var d,e=this.__value__,f=this._chunkManager,g=[],h=arguments;return a=a<0?e.length-a:a,b&&a<e.length&&a>=0&&(b=Math.min(e.length-a,b),g=e.slice(a,a+b),c.trigger(this,"removing",{type:"removing",items:g,index:a}),f.remove(a,b),g=e.splice(a,b),c.trigger(this,"remove",{type:"remove",items:g,index:a})),h.length>2&&(d=m.toArray(h),d.splice(0,2),c.trigger(this,"adding",{type:"adding",index:a,items:d}),f.add(d,a),e.splice.apply(e,[a,0].concat(d)),c.trigger(this,"add",{type:"add",index:a,items:d})),this.update(),g},unshift:function(){return this.addMany(m.toArray(arguments),0),this.__value__.length}},dependency:{_firstExecution:function(a){m.isArray(a)&&(this._indexes=[],this._chunkManager=new I(this),this._length=a.length)},update:function(){var a=this._getValue(),b=this._length,c=this._chunkManager,d=Math.max(a.length-b,0),e=Math.max(b-a.length,0),f=a.length-d;m.observable.fn.base.update.apply(this),m.isArray(a)&&(c.each(function(b,c){var d=m.domQuery(b);d.contextBubble(m.context(b),function(){c.updateChildren(a,f,d,b)})}),d>0?c.add(a.slice(b),b):e>0&&c.remove(b,e),this._length=a.length)}}}})}();var J=function(){function a(){return!0}var b={NOOP:0,ADD:1,REMOVE:2,EXISTS:3
},d={waiting:{},operations:{FILTER:1,STEP:2,SKIP:3,TAKE:4,SORT:5},initExpressionExtender:function(a){var b=a.clone();return b.view=m.observable([]),b.view._connections={},b.view._observed=[],b.view._updateObservable=m.bind(d.updateObservable,b),b._operations=a._operations?m.clone(a._operations):[],b._getter=m.bind(d.getter,b),b.view._initialized=!1,b.view.on("get",b._getter),b.on("add",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),d.executeOperations(b))}),b.on("remove",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),d.executeOperations(b))}),b},getter:function(){c.off(this.view,"get",this._getter),this._getter=void 0,this.view._initialized=!0,d.executeOperationsPure(this)},updateObservable:function(){d.executeOperations(this)},executeOperationsPure:function(a){var b=[],e=a.view._observed,f=a.view._updateObservable;m.each(e,function(a){c.off(a,"change",f)}),e=a.view._observed=[],w.startObserving(),m.each(a._operations,function(c){if(c.type==d.operations.STEP){var e=a.view;a.view=m.observable([]),a.view._connections={},b.length&&d.executeOperationsChunk(a,b),c.step.call(a.__context__),a.view=e}else b.push(c)}),b.length&&d.executeOperationsChunk(a,b),m.each(w.stopObserving(),function(a){e.push(a),a.on("change",f)})},executeOperations:function(a){var b=a.__id__,c=d.waiting;c[b]||(c[b]=!0,setTimeout(function(){d.executeOperationsPure(a),c[b]=!1},0))},executeOperationsChunk:function(c,e){function f(a){return n?k[l[a]]:k[a]}var g,h=b.NOOP,i=c._getValue(),j=c.view,k=j._connections,l={},n=!1,o={},p=0,q=j.update,r=0,s=i.length;j.update=m.noop,m.each(e,function(b){switch(b.type){case d.operations.SKIP:r=b.skip,m.isFunction(r)&&(r=r.call(c.__context__)),r=m.unwrap(r);break;case d.operations.TAKE:s=b.take,m.isFunction(s)&&(s=s.call(c.__context__)),s=m.unwrap(s);break;case d.operations.SORT:i=m.isString(b.sort)?m.clone(i).sort(function(a,c){return a=m.unwrap(a[b.sort]),c=m.unwrap(c[b.sort]),a>c?1:a<c?-1:0}):m.isFunction(b.sort)?m.clone(i).sort(b.sort.bind(c.__context__)):m.clone(i).sort(),1==e.length&&e.push({type:d.operations.FILTER,filter:a}),n=!0}}),n&&m.each(c._getValue(),function(a,b){m.each(i,function(c,d){if(c==a)return l[d]=b,!1})}),m.each(i,function(a,q){var t;if(s<=0){for(;j().length-p>0;)j.removeAt(j().length-1),j._connections={};return!1}switch(m.each(e,function(e){var g=e.filter;switch(e.type=e.type||g&&d.operations.FILTER,e.type){case d.operations.FILTER:if(!g.call(c.__context__,a,q,i))return h=b.NOOP,void 0!==f(q)&&(h=b.REMOVE),!1;h=b.EXISTS,void 0===f(q)&&(h=b.ADD);break;case d.operations.SKIP:if(h=b.EXISTS,r-=1,r>=0)return h=void 0!==f(q)?b.REMOVE:b.NOOP,!1;r<0&&void 0===f(q)&&(h=b.ADD);break;case d.operations.TAKE:if(s<=0)return h=void 0===f(q)?b.NOOP:b.REMOVE,!1;s-=1,h=b.EXISTS,void 0===f(q)&&(h=b.ADD)}}),t=f(q),g=n?l[q]:q,h){case b.ADD:o[g]=p,j.splice(p,0,a),m.each(k,function(a,b){a>=p&&(k[b]=++a)}),p++;break;case b.REMOVE:j.removeAt(t),m.each(k,function(a,b){a>t&&(k[b]=--a)});break;case b.EXISTS:o[g]=p,t!=p&&(j.move(t,p),m.each(k,function(a,b){(n?b!=l[q]:b!=q)&&(k[b]=a>t?--a:++a)})),p++}}),j._connections=o,j.update=q,j.update()}};return d}();!function(){m.observable.filter=function(a){var b=J.initExpressionExtender(this),c=a;return m.isFunction(c)&&!m.isObservable(c)||(c=function(b){var c=m.unwrap(a),d=String(c).toLowerCase();return b=String(m.unwrap(b)).toLowerCase(),!c||b.indexOf(d)!=-1}),b._operations.push({type:J.operations.FILTER,filter:c}),b},m.observable.step=function(a){var b=J.initExpressionExtender(this);return b._operations.push({type:J.operations.STEP,step:a}),b},m.observable.skip=function(a){var b=J.initExpressionExtender(this);return b._operations.push({type:J.operations.SKIP,skip:a}),b},m.observable.take=function(a){var b=J.initExpressionExtender(this);return b._operations.push({type:J.operations.TAKE,take:a}),b},m.observable.sort=function(a){var b=J.initExpressionExtender(this);return b._operations.push({type:J.operations.SORT,sort:a}),b}}(),function(){m.query=function(a,b){m.domReady(function(){m.$unwrap(b,function(b){m.isElement(b)||(b=document.body);var c=new G,d=D(b)[0];c.pushContext(a),c._serverData=C,C?d.render(c):d.sync(c),c.createElementObservableDependencies([b])})})},m.executeQuery=function(a,b){var c=y.Is(a)?"preprocess":"update",d=Array.prototype.slice.call(arguments,2),e=m.queries[b];e.passDomQuery&&d.unshift(m.domQuery(a)),e[c].apply(a,d)},m.context=function(a,b){if(a=m.$unwrap(a)){var c=s.data(a);if(c){if(b&&c.childrenContext)return c.childrenContext;if(c.context)return c.context}return m.context(y.Is(a)?a._parent:a.parentNode,!0)}return null},m.dataItem=function(a){var b=m.context(a);return b?b.$this:null},m.isObservable=function(a){return!!a&&a.__identity__===H},m.unwrapObservable=function(a){return a&&a.__identity__===H?a():a},m.domQuery=function(a){if(a=m.$unwrap(a)){var b=s.data(a,"domQuery");return b?b:m.domQuery(y.Is(a)?a._parent:a.parentNode)}return null},m.executeExpression=function(a,b,c){c=c||{};var d,e=x.Create(m.unwrapObservable(a)),f=!1,g=[];return b=m.unwrapObservable(b),m.isObject(b)?b.$this||(f=!0,b.$this=b):b={$this:b},d=x.GetValue(b,null,e,c.raw?x.Raw:x.ValueOnly),f&&(b.$this=void 0),c.raw&&m.each(m.toArray(d),function(a,b){g[b]=m.isObject(a)?a:{observables:[],result:a,value:a}}),c.raw?g:d}}(),function(){m.extend(m.queries,{view:{passDomQuery:!0,preprocess:function(a,b){b.isActive()?(this.css("display",""),b._html&&m.queries.template.preprocess.call(this,a,b._html,b)):this.css("display","none"),g.with.preprocess.call(this,a,b,"$view")},update:function(a,b){b.isActive()?(b._html&&(g.with.preprocess.call(this,a,b,"$view"),this.innerHTML=b._html,b._children=b._html=void 0,m.each(D(this.childNodes[0]),function(b){y.Is(b)?b.sync(a):b&&b.isExpression&&b.element&&(b.element.nodeValue=x.GetValue(a._context,null,b))}),a.createElementObservableDependencies(this.childNodes)),A.show(this)):A.hide(this)}},navigateTo:{update:function(a,b){function c(c){c=c||window.event,c.preventDefault(),c.returnValue=!1,m.isString(a)?window.location.href=a:a.navigateTo(a,b)}i(this,"click",c)}},trigger:{}})}();var K=function(){var a={required:{priority:9,validate:function(a,b){if(a!==b.defaultValue&&""!==a&&a!==!1&&void 0!==a&&null!==a)return!0}},minlength:{priority:19,validate:function(a,b,c){return void 0!==a&&null!==a&&a.length>=parseInt(c,10)}},maxlength:{priority:29,validate:function(a,b,c){return void 0===a||null===a||a.length<=parseInt(c,10)}},min:{priority:39,validate:function(a,b,c){return void 0!==a&&null!==a&&a>=c}},max:{priority:49,validate:function(a,b,c){return void 0!==a&&null!==a&&a<=c}},email:{priority:59,validate:function(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)}},url:{priority:69,validate:function(a){return/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(a)}},date:{priority:79,validate:function(a){return!!a&&!/Invalid|NaN/.test(new Date(a.toString()).toString())}},creditcard:{priority:89,validate:function(a){if(m.isString(a)&&0===a.length)return!1;if(m.isNumber(a)&&(a=a.toString()),/[^0-9 \-]+/.test(a))return!1;var b=0,c=0,d=!1;a=a.replace(/\D/g,"");for(var e=a.length-1;e>=0;e--){var f=a.charAt(e);c=parseInt(f,10),d&&(c*=2)>9&&(c-=9),b+=c,d=!d}return b%10===0}},regexp:{priority:99,validate:function(a,b,c){return!!m.isRegExp(c)&&(void 0!==a&&null!==a&&c.test(a))}},number:{priority:109,validate:function(a){return!!m.isNumber(a)||(!m.isString(a)||0!==a.length)&&/^(-?|\+?)(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)}},digits:{priority:119,validate:function(a){return/^\d+$/.test(a)}},letters:{priority:129,validate:function(a){return!!a&&/^[a-zA-Z]+$/.test(a)}},equals:{priority:139,validate:function(a,b,c){return m.equals(a,m.unwrap(c))}}};return a}();!function(){function a(a,b,c){var d=a.errorMessage,e=a.errorMessages;d(c?"":b.errorMessage||e()[0]||""),a.valid(c)}m.observable.validation=function(b){var d,e,f=this,g=b.maxErrors,h=this.errorMessages=m.observable([]),i=this._validators=[];this.errorMessage=m.observable("");for(d in b)e=b[d],K[d]?i.push({option:e,validate:K[d].validate,priority:K[d].priority}):"validate"!=d&&"asyncValidate"!=d||i.push({option:"",validate:e.validate?e.validate:e,priority:e.priority||Number.POSITIVE_INFINITY,isAsync:"asyncValidate"==d});i.sort(function(a,b){return a.priority>b.priority?1:-1}),this.valid=m.observable(!0),this.validate=function(){var d,j,k,l=f.__value__,n=!0,o=0,p=0;for(h.removeAll();p<i.length&&!(o>=g);p++){if(j=i[p],j.isAsync)return j.validate(l,function(c){a(f,b,!!c)}),!0;d=j.option,e=j.option,m.isPlainObject(d)&&(e=d.value),m.isFunction(e)&&(e=e.call(f.__context__)),k=j.validate(l,b,e),m.isString(k)&&(k=[k]),!m.isArray(k)&&k||(h.addMany(m.isArray(k)?k:d&&d.message?[d.message]:e&&m.isString(e)?[e]:[]),n=!1,o++)}return a(this,b,n),this.valid(n),c.trigger(this,"validate"),n},b.validateOnChange&&this.on("change",function(){this.validate()}),b.validateInitially&&this.validate()}}();var L=function(){function a(b){return a.Is(b)?b:a.Is(this)?(this._routeString=b,this._wildcard={},this._optional={},this._validate={},void(this._transform={})):new a(b)}function b(){this._currentRoute={},this._routes={},this._baseUrl=""}return m.route=function(b){return a(b)},a.Is=function(b){return a.prototype.isPrototypeOf(b)},a.Has=function(a){return null!=a._routeString},a.Combine=function(b,c){if(!a.Has(c))return b;if(!a.Has(b))return c;var d=a(b+c);return m.extend(d._wildcard,b._wildcard,c._wildcard),m.extend(d._optional,b._optional,c._optional),m.extend(d._validate,b._validate,c._validate),d},a.prototype={wildcard:function(){var a=this._wildcard,b=m.flatten(m.toArray(arguments));return m.each(b,function(b){a[b]=!0}),this},optional:function(a,b){return this._addMetadata("optional",a,b),this},validate:function(a,b){return this._addMetadata("validate",a,b),this},transform:function(a,b){return this._addMetadata("_transform",a,b),this},toString:function(){return this._routeString?this._routeString.toString():""},trailingSlash:function(){return this},_transfromParam:function(a,b){var c=this._transform[a];return""===b&&m.has(this._optional,a)&&(b=this._optional[a]),c?c(b):b},_validateParam:function(a,b){var c=this._validate[a];return!c||c(b)},_addMetadata:function(a,b,c){var d=this["_"+a];m.isPlainObject(b)?m.each(b,function(a,b){d[b]=a}):m.isString(b)&&(d[b]=c)}},m.core.Router=b,b.GenerateRoute=function(a,c){var d=new b,e=d.registerRoute(a),f=d.routeTo(e,c);return 0===a.indexOf("/")&&0!==f.indexOf("/")?"/"+f:f},b.prototype={registerRoute:function(b,c){b=a(b),c=a(c?this._routes[a(c).toString()].route:void 0);var d=a.Combine(c,b),e=d._routeString=d._routeString.replace(/^\//,""),f=this._generateRouteStringData(e);return this._routes[e]={route:d,data:f,regExCollection:this._generateRouteRegEx(d,f),parent:a.Has(c)?this._routes[c.toString()]:void 0},e},routeTo:function(a,b){var c,d=this._routes[a],e=d.route,f="";return b=b||{},m.each(d.data,function(a){c=a.param,c?e._validateParam(b[c])&&(f+=m.has(b,c)?b[c]:e._optional[c]):f+=a.string}),this._baseUrl&&(f=this._baseUrl+f),f},routeFrom:function(a){var b,c=this._getUrlParams,d=[];return a=decodeURI(a),this._baseUrl&&a.startsWith(this._baseUrl)&&(a=a.substr(this._baseUrl.length,a.length)),m.each(this._routes,function(e){m.each(e.regExCollection,function(f){if(f.regEx.test(a)){for(b=f.regEx.exec(a);e;)d.unshift({id:e.route._routeString,params:c(e,f.params,b)}),e=e.parent;return!1}})}),d.length?d:null},_getUrlParams:function(a,b,c){var d,e,f=a.route,g={};return m.each(b,function(a,b){d=c[b+1],f._validateParam(a,d)&&(g[a]=f._transfromParam(a,d))}),m.each(a.data,function(a){e=a.param,e&&!g[e]&&m.has(f._optional,e)&&void 0!==f._optional[e]&&(g[e]=f._optional[e])}),g},_generateRouteRegEx:function(a,b){var c,d,e,f,g,h=[],i=this._sliceLastFromRegExString,j=this._getOptionalParametersCombinations(a,b);return m.each(j,function(j){e="^",f=[],m.each(b,function(b){if(g=b.param){if(d=!0,m.has(a._optional,g)&&j[g]||(c=!1),j[g])return;f.push(g),e+=a._wildcard[g]?m.has(a._optional,g)?"(.*?)":"(.+?)":m.has(a._optional,g)?"([^/]*?)":"([^/]+?)"}else"/"==b.string&&(d&&c&&(e=i(e)),d=!1,c=!0),e+=l.forRegEx(b.string)}),d&&c&&(e=i(e)),h.push({regEx:new RegExp(e+"$","i"),params:f})}),h},_sliceLastFromRegExString:function(a){for(var b,c=0;c<a.length&&(b=a.length-c-1,"/"!=a.charAt(b)||"]"==a.charAt(b+1));c++);return a.substring(0,b-1)},_getOptionalParametersCombinations:function(a,b){var c,d,e,f=this._getOptionalParameters(a,b),g=Math.pow(2,f.length),h=f.length,i=[{}];for(d=0;d<g;d++){for(c={},c.__lowestIndex__=h,c.__length__=0,e=0;e<h;e++)d&Math.pow(2,e)&&(e<c.__lowestIndex__&&(c.__lowestIndex__=e),c[f[e]]=!0,c.__length__+=1);c.__length__&&i.push(c)}return i.sort(function(a,b){var c=a.__length__-b.__length__;return c?c:b.__lowestIndex__-a.__lowestIndex__}),i},_getOptionalParameters:function(a,b){var c=[];return m.each(b,function(b){a._optional&&b.param&&m.has(a._optional,b.param)&&c.push(b.param)}),c},_generateRouteStringData:function(a){var b=this._pushStringData,c=[],d=0;return a.replace(/{{[^}]+}}/g,function(e,f){b(c,a.substring(d,f)),d=f+e.length,c.push({param:e.substring(2,e.length-2)})}),d!=a.length&&b(c,a.substring(d)),c},_pushStringData:function(a,b){var c=b.split("/");m.each(c,function(b,d){b&&a.push({string:b}),d!=c.length-1&&a.push({string:"/"})})},_setBaseUrl:function(a){m.isString(a)&&(a.endsWith("/")||(a+="/"),a.startsWith("/")&&(a=a.substr(1,a.length)),this._baseUrl=a)}},b}(),M=function(){var a=function(){var a=Date.now();return function(){return"blocks_"+m.version+"_"+a++}}();return a}(),N=function(){function a(b){this.options=m.extend({},a.Defaults,b),this.execute()}return a.Execute=function(b){return new a(b)},a.Defaults={type:"GET",url:"",processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",jsonp:"callback",jsonpCallback:function(){return M()}},a.Accepts={"*":"*/".concat("*"),text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},a.Meta={statusFix:{0:200,1223:204}},a.prototype={execute:function(){var a=this.options;if("GET"==a.type&&a.data&&this.appendDataToUrl(a.data),C&&C.requests&&C.requests[a.url])this.callSuccess(C.requests[a.url]);else try{"jsonp"==a.dataType?this.scriptRequest():this.xhrRequest()}catch(a){}},xhrRequest:function(){var b=this.options,c=this.createXHR();c.onabort=m.bind(this.xhrError,this),c.ontimeout=m.bind(this.xhrError,this),c.onload=m.bind(this.xhrLoad,this),c.onerror=m.bind(this.xhrError,this),c.open(b.type.toUpperCase(),b.url,b.async,b.username,b.password),c.setRequestHeader("Content-Type",b.contentType),c.setRequestHeader("Accept",a.Accepts[b.dataType||"*"]),c.send(b.data||null)},createXHR:function(){var a=XMLHttpRequest||window.ActiveXObject;try{return new a("Microsoft.XMLHTTP")}catch(a){}},xhrLoad:function(b){var c=b.target,d=a.Meta.statusFix[c.status]||c.status,e=d>=200&&d<300||304===d;e?this.callSuccess(c.responseText):this.callError(c.statusText)},xhrError:function(){this.callError()},scriptRequest:function(){var a=this,b=this.options,c=document.createElement("script"),d={},e=m.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback;d[b.jsonp]=e,this.appendDataToUrl(d),window[e]=function(b){window[e]=null,a.scriptLoad(b)},c.onerror=this.scriptError,c.async=b.async,c.src=b.url,document.head.appendChild(c)},scriptLoad:function(a){this.callSuccess(a)},scriptError:function(){this.callError()},appendDataToUrl:function(a){var b=this,c=this.options,d=/\?/.test(c.url);m.isPlainObject(a)?m.each(a,function(a,e){c.url+=b.append(d,e,a.toString())}):m.isArray(a)?m.each(a,function(a,c){b.appendDataToUrl(c)}):c.url+=b.append(d,a.toString(),"")},append:function(a,b,c){var d=a?"&":"?";return d+=b,c&&(d+="="+c),d},callSuccess:function(a){var b=this.options.success,c="success";b&&b(a,c,null),this.callComplete(c)},callError:function(a){var b=this.options.error,c="error";b&&b(null,c,a),this.callComplete(c)},callComplete:function(a){var b=this.options.complete;b&&b(null,a)}},a}(),O=function(){function a(a){if(window){var b=window.jQuery||window.$;b&&b.ajax?b.ajax(a):N.Execute(a)}}return a}(),P=function(){function a(a){a=a||{};var b=a.data,c=a.baseUrl;a=this.options=(a.data=void 0)||m.extend(!0,{},this.options,a),c&&(a.read.url=c+a.read.url,a.create.url=c+a.create.url,a.destroy.url=c+a.destroy.url,a.update.url=c+a.update.url),this.data=m.observable(m.unwrap(b)||[]).extend().on("add remove",m.bind(this._onArrayChange,this)),this.hasChanges=m.observable(!1),this._aggregates=null,this._changes=[],this._changesMeta={},this._subscribeToEvents()}var b="create",d="update",e="destroy",f="GET",g="application/json; charset=utf-8",h=["change","sync","error","requestStart","requestEnd"];return m.DataSource=a,a.ArrayMode=1,a.ObjectMode=2,a.prototype={options:{baseUrl:"",idAttr:"",mode:a.ArrayMode,read:{url:"",type:f,contentType:g},update:{url:"",type:"POST",contentType:g},create:{url:"",type:"POST",contentType:g},destroy:{url:"",type:"POST",contentType:g}},read:function(b,c){var d=this;return c=arguments[arguments.length-1],m.isFunction(b)&&(b={}),b=b||{},d._ajax("read",b,function(e){m.isString(e)&&(e=JSON.parse(e)),d.options.mode==a.ArrayMode&&(m.isArray(e)||(m.isArray(e.value)?e=e.value:m.isObject(e)&&m.each(e,function(a){if(m.isArray(a))return e=a,!1}))),m.isArray(e)||(e=[e]),b&&b.__updateData__===!1||d._updateData(e),c&&m.isFunction(c)&&c(e)}),d},update:function(){if(0!==arguments.length){var a;arguments.length>1&&m.type(arguments[0])!=m.type(arguments[1])?(a=[arguments[1]],a[0][this.options.idAttr]=arguments[0]):a=m.flatten(arguments),a.length>0&&(this._changes.push({type:d,items:a}),this._onChangePush())}},hasChanges:function(){return this._changes.length>0},clearChanges:function(){return this._changes.splice(0,this._changes.length),this._changesMeta={},this.hasChanges(!1),this},sync:function(a){var b,c=this,d=this._changes,e=d.length;return m.each(d,function(d){m.each(d.items,function(f){b=f,f.__id__&&delete f.__id__,c._ajax(d.type,{data:b},function(){e--,e||(m.isFunction(a)&&a(),c._trigger("sync"))})})}),this.clearChanges()},_ajax:function(a,b,c){var d,e=this;b=m.extend({},this.options[a],b),d=b.type.toUpperCase(),b.url=L.GenerateRoute(b.url,b.data),this._trigger("requestStart",{}),O({type:b.type,url:b.url,data:d==f?null:JSON.stringify(b.data),contentType:b.contentType,dataType:b.dataType,jsonp:b.jsonp,success:function(a,b,d){e._trigger("requestEnd",{}),a&&c(a,b,d)},error:function(){e._trigger("requestEnd",{}),e._trigger("error")}})},_updateData:function(a){this.data.removeAll(),this.data.addMany(a),this.clearChanges(),this._trigger("change")},_onArrayChange:function(a){var b=a.type;"remove"==b?this._remove(a.items):"removeAt"==b?this._remove(this.data.slice(a.index,a.index+a.count)):"add"==b&&this._add(a.items)},_onChangePush:function(){var a,c=this._changesMeta,f=this._changes,g=f[f.length-1],h=this.options.idAttr,i=g.type;m.each(g.items,function(g){switch(i){case b:g.__id__=M(),c[g.__id__]=g;break;case d:a=c[g[h]],a&&(f.splice(a.index,1),a.item=g,a.index=f.length-1),c[g[h]]={index:f.length-1,item:g};break;case e:a=c[g?g.__id__:void 0],a&&(f.splice(a.index,1),f.pop(),c[g.__id__]=void 0)}}),f.length>0&&this.options.autoSync?this.sync():this.hasChanges(f.length>0)},_add:function(a){this._changes.push({type:b,items:a}),this._onChangePush()},_remove:function(a){this._changes.push({type:e,items:a}),this._onChangePush()},_subscribeToEvents:function(){var a=this,b=this.options;m.each(h,function(c){b[c]&&a.on(c,b[c])})}},c.register(a.prototype,["on","_trigger","change","error","requestStart","requestEnd"]),m.core.applyExpressions("array",m.DataSource.prototype,m.toObject(["size","at","isEmpty","each"])),a}(),Q=function(){function a(a){this._options=a||{}}return a.Is=function(b){return a.prototype.isPrototypeOf(b)},a.Inflate=function(b){var c,d,e={};for(c in b)d=b[c],a.Is(d)&&(d=d._options,d.propertyName=c,e[d.field||c]=d);return e},a.Create=function(a,b,c){var d;return arguments.length<3&&(c=a.value||a.defaultValue),b=a.thisArg?a.thisArg:b,d=m.observable(c,b).extend("validation",a).on("changing",a.changing,b).on("change",a.change,b),a.extenders&&m.each(a.extenders,function(a){d=d.extend.apply(d,a)}),d},a.prototype.extend=function(){var a=this._options;return a.extenders=a.extenders||[],a.extenders.push(m.toArray(arguments)),this},a}(),R=function(){function a(b,c,d,e){var f=this;d=m.clone(d,!0),this._application=b,this._prototype=c,this._collection=e,this._initialDataItem=m.clone(d,!0),m.each(a.prototype,function(a,b){m.isFunction(a)&&0!==b.indexOf("_")&&(f[b]=m.bind(a,f))}),S(c,this),this.valid=m.observable(!0),this.isLoading=m.observable(!1),this.validationErrors=m.observable([]),this._isNew=!1,this._dataItem=d||{},this._properties=Q.Inflate(this),this.options.baseUrl||(this.options.baseUrl=b.options.baseUrl),this.options.mode=P.ObjectMode,this._dataSource=new P(this.options),this._dataSource.on("change",this._onDataSourceChange,this),this._dataSource.requestStart(function(){f.isLoading(!0)}),this._dataSource.requestEnd(function(){f.isLoading(!1)}),this._dataSource.on("sync",this._onDataSourceSync),this.hasChanges=this._dataSource.hasChanges,this._ensurePropertiesCreated(d),this.init()}return a.prototype={options:{},init:m.noop,collection:function(){return this._collection||null},validate:function(){var a,b,c=this._properties,d=!0;for(b in c)a=this[b],m.isObservable(a)&&m.isFunction(a.validate)&&!a.validate()&&(d=!1);return this.valid(d),this._updateValidationErrors(),d},dataItem:function(){var a,b,c=this._properties,d={};for(a in c)b=c[a],"__id__"!=a&&m.isFunction(this[b.propertyName])&&(d[b.field||b.propertyName]=this[b.propertyName]());return this.isNew()&&delete d[this.options.idAttr],d},reset:function(a){return this._ensurePropertiesCreated(a),this},isNew:function(){var a=this.options.idAttr,b=m.unwrap(this[a]),c=this._properties[a];return!!(!b&&0!==b||c&&b===c.defaultValue)},read:function(a,b){return m.isFunction(a)&&(b=a,a=void 0),this._dataSource.read({data:a},b),this},destroy:function(a){return a=a!==!1,a&&this._collection&&this._collection.remove(this),this._dataSource._remove([this.dataItem()]),this},sync:function(a){return this.isNew()&&this._dataSource.data.add(this.dataItem()),this._dataSource.sync(a),this},clone:function(){var a=this,b={};return m.each(this._prototype,function(c,d){b[d]=m.clone(a[d],!0)}),new this.constructor(b)},_setPropertyValue:function(a,b){var c=a.propertyName;m.isFunction(this[c])?(this[c](b),this._dataSource.update(this.dataItem())):a.isObservable?this[c]=this._createObservable(a,b):this[c]=function(){return b}},_ensurePropertiesCreated:function(b){var c,d,e,f=this._properties;if(b){a.prototype.isPrototypeOf(b)&&(b=b.dataItem());for(d in b)c=f[d],c?this._setPropertyValue(c,b[d]):m.isObservable(this[d])?this[d](b[d]):this[d]=b[d]}for(d in f)c=f[d],m.has(b,c.propertyName)||(e=c.field||c.propertyName,this._setPropertyValue(c,c.value||(m.has(b,e)?b[e]:c.defaultValue)))},_createObservable:function(a,b){var c=this,d=this._properties,e=Q.Create(a,this,b);return e.on("change",function(){c.isNew()||c._dataSource.update(c.dataItem())}).on("validate",function(){var a,b=!0;for(a in d)if(m.isFunction(c[a].valid)&&!c[a].valid()){b=!1;break}c._updateValidationErrors(),c.valid(b)}),this._collection||e.extend(),e},_onDataSourceChange:function(){var a=m.unwrapObservable(this._dataSource.data())[0];this._ensurePropertiesCreated(a)},_updateValidationErrors:function(){var a,b,c=this._properties,d=[];for(b in c)a=this[b],a.errorMessages&&d.push.apply(d,a.errorMessages());this.validationErrors.reset(d)}},m.core.expressionsCreated&&m.core.applyExpressions("object",a.prototype),a}(),S=function(){function a(a,b){var c,d;for(c in a)d=a[c],Q.Is(d)||(m.isObservable(d)?(b[c]=d.clone(!0),b[c].__context__=b):m.isFunction(d)?b[c]=m.bind(d,b):R.prototype.isPrototypeOf(d)?b[c]=d.clone(!0):m.isObject(d)&&!m.isPlainObject(d)?b[c]=m.clone(d,!0):b[c]=m.clone(d,!0))}return a}(),T=function(){function a(a){this._options=m.extend({root:"/"},a),this._tryFixOrigin(),this._initial=!0,this._location=window.location,this._history=window.history,this._root=("/"+this._options.root+"/").replace(d,"/"),this._interval=50,this._fragment=this._getFragment(),this._wants=this._options.history===!0?h:this._options.history,this._use=this._wants==j&&this._history&&this._history.pushState?j:h,this._hostRegEx=new RegExp(l.forRegEx(this._location.host))}var b=/^[#\/]|\s+$/g,d=/^\/+|\/+$/g,e=/msie [\w.]+/,f=/\/$/,g=/[?#].*$/,h="hash",j="pushState";return a.prototype={start:function(){var a=this._fragment,b=document.documentMode,c=e.exec(navigator.userAgent.toLowerCase())&&(!b||b<=7);this._use==h&&c&&(this._createIFrame(),this.navigate(a)),this._initEvents(c),this._tryAdaptMechanism(a)||this._loadUrl()},navigate:function(a,b){b&&b!==!0||(b={trigger:!!b});var c=this._root+(a=this._getFragment(a||"")),d=this._use,e=this._iframe,f=this._location;if(a=a.replace(g,""),this._fragment===a)return!1;if(this._fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._wants==j&&d==j)this._history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(d!=h)return f.assign(c),!0;this._updateHash(f,a,b.replace),e&&a!==this.getFragment(this._getHash(e))&&(b.replace||e.document.open().close(),this._updateHash(e.location,a,b.replace))}return this._loadUrl(a)},_initEvents:function(a){var b=this._use,c=m.bind(this._onUrlChanged,this);this._wants==j&&i(document,"click",m.bind(this._onDocumentClick,this)),b==j?i(window,"popstate",c):b==h&&!a&&"onhashchange"in window?i(window,"hashchange",c):b==h&&(this._checkUrlInterval=setInterval(c,this._interval))},_loadUrl:function(a){var b=this._initial;return this._initial=!1,this._fragment=a=this._getFragment(a),c.trigger(this,"urlChange",{url:a,initial:b})},_getHash:function(a){var b=(a?a.location:this._location).href.match(/#(.*)$/);return b?b[1]:""},_getFragment:function(a){if(null==a)if(this._use==j){var c=this._root.replace(f,"");a=this._location.pathname,a.indexOf(c)||(a=a.slice(c.length))}else a=this._getHash();return a.replace(this._location.origin,"").replace(b,"")},_onUrlChanged:function(){var a=this._getFragment();return a===this._fragment&&this._iframe&&(a=this._getFragment(this._getHash(this._iframe))),a!==this._fragment&&(this._iframe&&this.navigate(a),void this._loadUrl())},_onDocumentClick:function(a){for(var b=a.target;b;){if(b&&b.tagName&&"a"==b.tagName.toLowerCase()){var c,d=b.getAttribute("download");""===d||d||!this._hostRegEx.test(b.href)||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||2===a.which||this.navigate(b.href)&&(c=document.getElementById(window.location.hash.replace(/^#/,"")),c&&c.scrollIntoView&&c.scrollIntoView(),a.preventDefault());break}b=b.parentNode}},_tryAdaptMechanism:function(a){var c=this._root,d=this._use,e=this._location,f=e.pathname.replace(/[^\/]$/,"$&/")===c;if(this._fragment=a,this._wants==j){if(d!=j&&!f)return a=this._fragment=this._getFragment(null,!0),e.replace(c+e.search+"#"+a),!0;d==j&&f&&e.hash&&(this._fragment=this._getHash().replace(b,""),this._history.replaceState({},document.title,c+a+e.search))}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b},_createIFrame:function(){var a=document.createElement("iframe");a.style.display="none",a.src="javascript:0",a.tabIndex=-1,document.body.appendChild(a),this._iframe=a.contentWindow},_tryFixOrigin:function(){var a=window.location;a.origin||(a.origin=a.protocol+"//"+a.hostname+(a.port?":"+a.port:""))}},c.register(a.prototype,["on"]),a}(),U=function(){function a(a,c,d,e){return b(a,c,d,e)}function b(a,b,c,d){var e,f=m.observable([]).extend(),g=Q.Inflate(b);for(e in g)f[e]=g[e];return f._baseUpdate=f.update,m.each(m.observable.fn.collection,function(a,b){m.isFunction(a)&&0!==b.indexOf("_")&&m.isFunction(f[b])&&(f[b]=m.bind(f[b],f))}),m.extend(f,m.observable.fn.collection,b),S(b,f),f._Model=a,f._prototype=b,c&&(f._application=c,f._view=m.__viewInInitialize__,b.options.baseUrl||(b.options.baseUrl=c.options.baseUrl)),f._dataSource=new P(b.options),f._dataSource.on("change",f._onDataSourceChange,f),f.hasChanges=f._dataSource.hasChanges,a&&(f.on("adding",f._onAdding,f),f.on("remove add",f._onChange,f)),m.isArray(d)&&f.reset(d),b.init&&b.init.call(f),f}return m.observable.remote=function(a){return b(null,{options:a},null,this.__value__)},m.observable.fn.collection={read:function(a,b){var c=this;return m.isFunction(a)&&(b=a,a=void 0),this._dataSource.read({data:a},b?function(){b.call(c.__context__)}:m.noop),this},clearChanges:function(){return this._dataSource.clearChanges(),this},sync:function(a){return this._dataSource.sync(a),this},update:function(a,b){return 0===arguments.length?this._baseUpdate.call(this):this._dataSource.update(a,b),this},sortBy:function(a,b){if("string"==typeof a){var c=a;a=function(a){return a[c]()}}return m.sortBy(this.__value__,a,b),this},clone:function(a){return b(this._Model,this._prototype,this._application,a?m.clone(this.__value__):this.__value__)},_onAdding:function(a){var b=this,c=this._Model,d=a.items;m.each(d,function(a,e){R.prototype.isPrototypeOf(a)&&(a=a.dataItem()),d[e]=new c(a,b)})},_onChange:function(a){var b,c=a.type,d=a.items,e=[],f=0;if(!this._internalChanging){for(;f<d.length;f++)b=d[f],b&&("remove"==c||"add"==c&&b.isNew())&&e.push(b.dataItem());"remove"==c?this._dataSource.data.removeAt(a.index,a.items.length):"add"==c&&this._dataSource.data.addMany(e)}},_onDataSourceChange:function(){this._internalChanging=!0,this.reset(this._dataSource.data()),this._internalChanging=!1,this.clearChanges(),this._view&&this._view.trigger("ready")}},a}(),V=function(){function a(a,b){var c,d;b||(b=a);for(c in b)d=b[c],m.isObservable(d)?a[c].__context__=a:m.isFunction(d)&&(a[c]=m.bind(d,a))}return a}(),W=function(){function a(a,b){var c=this;V(this),this._views=[],this._application=a,this._parentView=b||null,this._initCalled=!1,this._html=void 0,this.loading=m.observable(!1),this.isActive=m.observable(!m.has(this.options,"route")),this.isActive.on("changing",function(a,b){c._tryInitialize(b)}),(this.options.preload||this.isActive())&&this._load()}return a.prototype={init:m.noop,ready:m.noop,routed:m.noop,loading:m.observable(!1),parentView:function(){return this._parentView},route:function(){return this._application._history.navigate(m.toArray(arguments).join("/")),this},navigateTo:function(a,b){this._application.navigateTo(a,b)},_tryInitialize:function(a){!this._initialized&&a&&(this.options.url&&!this._html?(this._callInit(),this._load()):(this._initialized=!0,this._callInit(),this.isActive()&&this.isActive.update()))},_routed:function(a,b){this._tryInitialize(!0),this.routed(a,b),m.each(this._views,function(c){c.options.route||c._routed(a,b)}),this.isActive(!0)},_callInit:function(){if(!this._initCalled){var a,b;m.__viewInInitialize__=this;for(a in this)b=this[a],m.isObservable(b)&&(b.__context__=this);this.init(),m.__viewInInitialize__=void 0,this._initCalled=!0}},_load:function(){var a=this.options.url,b=this._application._serverData;b&&b.views&&b.views[a]&&(a=this.options.url=void 0,this._tryInitialize(!0)),a&&!this.loading()&&(this.loading(!0),O({isView:!0,url:a,success:m.bind(this._loaded,this),
error:m.bind(this._error,this)}))},_loaded:function(a){this._html=a,this._tryInitialize(!0),this.loading(!1)},_error:function(){this.loading(!1)},clone:function(){return this}},c.register(a.prototype,["on","off","trigger"]),a}();(function(){function a(a){this._router=new L(this),this._modelPrototypes={},this._collectionPrototypes={},this._viewPrototypes={},this._views={},this._currentRoutedView=void 0,this._started=!1,this.options=m.extend({},this.options,a),this._serverData=null,this._setDefaults(),this._prepare()}var b;return m.Application=function(c){return b=b||new a(c)},m.core.deleteApplication=function(){b=void 0},a.prototype={options:{history:!0},Property:function(a){return m.isString(a)?function(){return this[a]()}:(a=m.extend({},this.Property.Defaults(),a),a=new Q(a))},Model:function(a){var b=this,c=function(d,e){return R.prototype.isPrototypeOf(this)?void this._super([b,a,d,e]):new c(d,e)};return a=m.clone(a,!0)||{},a.options=a.options||{},m.inherit(R,c,a)},Collection:function(a,b){var c=this,d=function(e){return U.prototype.isPrototypeOf(this)?this._super([a,b,c,e]):new d(e)};return a?R.prototype.isPrototypeOf(a.prototype)||(b=a,a=this.Model({})):a=this.Model({}),b=b||{},b.options=b.options||{},m.inherit(U,d,b)},View:function(a,b,c){return 1==arguments.length?this._views[a]:void(this._started||(m.isString(b)?(this._viewPrototypes[b]=this._createView(c),c.options.parentView=a):this._viewPrototypes[a]=this._createView(b)))},extend:function(a){return m.extend(this,a),V(this,a),this},navigateTo:function(a,b){return!!a.options.route&&(this._history.navigate(this._router.routeTo(a.options.routeName,b)),!0)},start:function(a){this._started||(this._started=!0,this._serverData=C,this._serverData&&this._serverData.baseUrl&&this._router._setBaseUrl(this._serverData.baseUrl),this._createViews(),m.domReady(m.bind(this._ready,this,a)))},_prepare:function(){m.domReady(function(){setTimeout(m.bind(function(){this.start()},this))},this)},_startHistory:function(){this._history=new T(this.options),this._history.on("urlChange",m.bind(this._urlChange,this)).start()},_ready:function(a){this._startHistory(),m.query(this,a),this._viewsReady(this._views)},_viewsReady:function(a){var b=this._callReady;m.each(a,function(a){a.ready!==m.noop&&(a.isActive()?b(a):a.isActive.once("change",function(){b(a)}))})},_callReady:function(a){a.loading()?a.loading.once("change",function(){a.ready()}):a.ready()},_urlChange:function(a){var b=this,c=this._currentView,d=this._router.routeFrom(a.url)||[],e=!1;return m.each(d,function(d){if(m.each(b._views,function(f){if(f.options.routeName==d.id)return!c&&(f.options.initialPreload||a.initial&&b._serverData&&"pushState"==b.options.history)&&(f.options.url=void 0),c&&c!=f&&c.isActive(!1),f._routed(d.params,a),b._currentView=f,e=!0,!1}),e)return!1}),!e&&c&&c.isActive(!1),e},_createView:function(a){return a.options=m.extend({},this.View.Defaults(),a.options),m.inherit(W,function(a,b){this._super([a,b])},a)},_createViews:function(){for(var a,b,c,d,e=m.pairs(this._viewPrototypes),f=this._views,g=[],h=0;0!==e.length;)for(;h<e.length;h++){if(a=e[h],b=a.value,c=b.prototype.options.parentView){if(!this._viewPrototypes[c])throw e.splice(h,1),h--,new Error("View with "+c+"does not exist");f[c]&&(d=new b(this,f[c]),f[c][a.key]=d,f[c]._views.push(d),d.parentView().isActive()||d.isActive(!1),e.splice(h,1),h--)}else d=new b(this),this[a.key]=d,e.splice(h,1),h--,c=void 0;d&&(m.has(d.options,"route")&&(d.options.routeName=this._router.registerRoute(d.options.route,this._getParentRouteName(d))),f[a.key]=d,g.push(d))}for(h=0;h<g.length;h++)g[h]._tryInitialize(g[h].isActive());this._viewPrototypes=void 0},_getParentRouteName:function(a){for(;a;){if(a.options.routeName)return a.options.routeName;a=a.parentView()}},_setDefaults:function(){this.Model.Defaults=m.observable({options:{}}).extend(),this.Collection.Defaults=m.observable({options:{}}).extend(),this.Property.Defaults=m.observable({isObservable:!0,maxErrors:1}).extend(),this.View.Defaults=m.observable({options:{}}).extend()},clone:function(){return this}},a})()}();var p=a.blocks;return m.noConflict=function(b){return a.blocks===m&&(a.blocks=p),b&&a.blocks===m&&(a.blocks=p),m},m});
//# sourceMappingURL=blocks.min.js.map