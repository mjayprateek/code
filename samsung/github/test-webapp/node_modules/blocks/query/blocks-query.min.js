!function(a,b){var c;c=a.__mock__&&a._blocks?a._blocks:b(a),"object"==typeof module&&"object"==typeof module.exports?module.exports=c:a.blocks=c,"function"==typeof define&&define.amd&&define("blocks",[],function(){return c})}("undefined"!=typeof window?window:this,function(a){function b(a,b,d,e){for(var f=e.stack,g=e.processed,h=e.clones,i=e.pending,j=0;j<f.length;j++)if(d[b]===f[j])return void i[j].push(function(c){a[b]=c});for(var k=0;k<g.length;k++)if(d[b]===g[k])return void(a[b]=h[k]);a[b]=c(d[b],!0,e)}function c(a,c,d){if(null==a)return a;d.stack.push(a),d.pending.push([]);var e,f,g,h=l.type(a);if(l.isFunction(a.clone))e=a.clone(c);else switch(h){case"object":case"array":e=a.constructor===Object?{}:"object"==h?new a.constructor:Array(a.length);for(f in a)c?b(e,f,a,d):e[f]=a[f];break;case"date":e=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());break;case"regexp":var i="";a.global&&(i+="g"),a.ignoreCase&&(i+="i"),a.multiline&&(i+="m"),e=new RegExp(a.source,i),e.lastIndex=a.lastIndex}if(d.stack.pop(),e){d.processed.push(a),d.clones.push(e),g=d.pending.pop();for(var j=0;j<g.length;j++)g[j](e||a)}else d.pending.pop();return e||a}function d(a,b,c,e,f){if(f!==!1&&(f=!0),a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof l&&(a=a._wrapped),b instanceof l&&(b=b._wrapped);var h=g.call(a);if(h!=g.call(b))return!1;switch(h){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0===a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var i=c.length;i--;)if(c[i]==a)return e[i]==b;var j=a.constructor,k=b.constructor;if(j!==k&&!(l.isFunction(j)&&j instanceof j&&l.isFunction(k)&&k instanceof k)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),e.push(b);var m=0,n=!0;if("[object Array]"==h){if(m=a.length,n=m==b.length)for(;m--&&(n=f?d(a[m],b[m],c,e,f):a[m]===b[m]););}else{for(var o in a)if(l.has(a,o)&&(m++,!(n=l.has(b,o)&&(f?d(a[o],b[o],c,e,f):a[o]===b[o]))))break;if(n){for(o in b)if(l.has(b,o)&&!m--)break;n=!m}}return c.pop(),e.pop(),n}function e(a,b){var c,d,e=this.__Class__;return l.isString(a)?d=e.prototype[a]:(b=a,d=e),this.__Class__=e.prototype.__Class__,c=d.apply(this,b||[]),this.__Class__=e,c}function f(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}var g=Object.prototype.toString,h=Array.prototype.slice,i=Object.prototype.hasOwnProperty,j={},k={},l=function(a){return k.expressionsCreated?0===arguments.length?k.staticExpression:k.createExpression(a):a};l.version="0.3.5",l.core=k,l.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[1]||{},h=2),"object"==typeof g||l.isFunction(g)||(g={});h<i;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(l.isPlainObject(c)||(b=l.isArray(c)))?(b?(b=!1,f=a&&l.isArray(a)?a:[]):f=a&&l.isPlainObject(a)?a:{},g[d]=l.extend(j,f,c)):g[d]=c);return g},l.each=function(a,b,c){if(null!=a){var d=a.length,e=-1,g="number"==typeof d;if(b=f(b,c),g)for(;++e<d&&b(a[e],e,a)!==!1;);else for(e in a)if(b(a[e],e,a)===!1)break}},l.eachRight=function(a,b,c){if(null!=a){var d=a.length,e=a.length,g="number"==typeof d;if(b=f(b,c),g)for(;--e>=0;)b(a[e],e,a);else for(e in a)b(a[e],e,a)}},l.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){l["is"+a]=function(b){return g.call(b)=="[object "+a+"]"}}),l.isArguments(arguments)||(l.isArguments=function(a){return!(!a||!i.call(a,"callee"))}),"function"!=typeof/./&&(l.isFunction=function(a){return!(!a||"function"!=typeof a)}),l.isArray=Array.isArray||function(a){return"[object Array]"==g.call(a)},l.extend(l,{noop:function(){},inherit:function(a,b,c){return(arguments.length<3&&l.isPlainObject(b)||1==arguments.length)&&(c=b,b=a,a=void 0),a?(b.prototype=m(a.prototype),b.prototype.constructor=b,l.extend(b.prototype,c),b.prototype.__Class__=a,b.prototype._super=e):c&&(b.prototype=c,b.prototype.constructor=b),b},type:function(a){return a instanceof Array?"array":"string"==typeof a||a instanceof String?"string":"number"==typeof a||a instanceof Number?"number":a instanceof Date?"date":"[object RegExp]"===g.call(a)?"regexp":null===a?"null":void 0===a?"undefined":l.isFunction(a)?"function":l.isBoolean(a)?"boolean":"object"},is:function(a,b){return arguments.length>1&&l.isFunction(b)?b.prototype.isPrototypeOf(a):l.type(a)==b},has:function(a,b){return!(!a||!i.call(a,b))},hasValue:function(a){return!(null==a||l.isNumber(a)&&isNaN(a))},toString:function(a){var b="";return l.hasValue(a)&&(b=a.toString()),b},unwrap:function(a){return k.expressionsCreated&&k.isExpression(a)?a.value():l.unwrapObservable?l.unwrapObservable(a):a},$unwrap:function(a,b,c){return b=f(b,c),a&&a.jquery?(b&&a.each(function(){b(this)}),a=a[0]):b&&b(a),a},toArray:function(a){if(l.isArguments(a))return h.call(a);if(l.isElements(a)){for(var b=Array(a.length),c=-1,d=a.length;++c<d;)b[c]=a[c];return b}return l.isArray(a)?a:[a]},toUnit:function(a,b){var c=b;return b=b||"px",l.isNaN(parseFloat(a))?a:l.isString(a)&&l.isNaN(parseInt(a.charAt(a.length-1),10))?c?a.replace(/[^0-9]+$/,b):a:a+b},clone:function(a,b){var d=!1;l.core.currentClone||(l.core.currentClone={stack:[],processed:[],clones:[],pending:[]},d=!0);var e=c(a,b,l.core.currentClone);return d&&(l.core.currentClone=null),e},isElements:function(a){var b=!1;if(a&&("undefined"!=typeof HTMLCollection&&(b=a instanceof window.HTMLCollection),"undefined"==typeof NodeList||b||(b=a instanceof NodeList),!b&&l.isString(a.item)))try{a.item(0),b=!0}catch(a){}return b},isElement:function(a){return!(!a||1!==a.nodeType)},isBoolean:function(a){return a===!0||a===!1||"[object Boolean]"==g.call(a)},isObject:function(a){return a===Object(a)},isPlainObject:function(a){var b;if(!a||"object"!=typeof a||"[object Object]"!==g.call(a)||a.nodeType||a.window==a)return!1;try{if(a.constructor&&!i.call(a,"constructor")&&!i.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(a){return!1}if(j.ownPropertiesAreLast)for(b in a)return i.call(a,b);for(b in a);return void 0===b||i.call(a,b)},isFinite:function(a){return isFinite(a)&&!l.isNaN(parseFloat(a))},isNaN:function(a){return l.isNumber(a)&&a!=+a},isNull:function(a){return null===a},isUndefined:function(a){return void 0===a},nothing:{},access:function(a,b,c){var d,e=0;for(c=arguments.length>2?c:l.nothing,b=b.split("."),d=b[0];d;){if(null==a)return c;a=a[d],d=b[++e]}return a},swap:function(a,b,c){var d=a.length;return b>=0&&c>=0&&b<d&&c<d&&(a[b]=a[c]+(a[c]=a[b],0)),a},move:function(a,b,c){return b!=c&&(b<=c&&c++,a.splice(c,0,a[b]),b>c&&b++,a.splice(b,1)),a},bind:function(a,b){var c,d=function(){},e=h.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,e.concat(h.call(arguments)));d.prototype=a.prototype;var f=new d,g=a.apply(f,e.concat(h.call(arguments)));return Object(g)===g?g:f}},toObject:function(a,b){for(var c,d={},e=arguments.length>1&&b,f=0,g=a.length;f<g;f++)c=a[f],l.isArray(c)?d[c[0]]=c[1]:l.isObject(c)?d[c.key]=c.value:d[c]=!e||b[f];return d},pairs:function(a){var b=[];for(var c in a)b.push({key:c,value:a[c]});return b},flatten:function(a,b){for(var c,d=l.core.flatten,e=[],f=a.length,g=-1;++g<f;)c=a[g],d(b,c,e);return e},equals:function(a,b,c){return a=l.unwrap(a),b=l.unwrap(b),d(a,b,[],[],c)}}),l.at=function(a){return{index:a,prototypeIndentification:"__blocks.at__"}},l.first=function(){return l.first},l.last=function(){return l.last};var m=Object.create||function(a){var b=function(){};return b.prototype=a,new b};for(var n in[j])break;j.ownPropertiesAreLast="0"!=n,k.flatten=function(a,b,c){if(l.isArray(b)||l.isArguments(b))if(a)c.push.apply(c,b);else for(var d=0;d<b.length;d++)k.flatten(a,b[d],c);else c.push(b)},function(){var b=function(){function a(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}return a}(),c=function(){var a=function(){function b(b){return function(c,d){return arguments.length>1?a.on(this,b,c,d):a.on(this,b,c),this}}var c={on:function(b,c,d){return arguments.length>2?a.on(this,b,c,d):a.on(this,b,c),this},once:function(b,c,d){a.once(this,b,c,d)},off:function(b,c){a.off(this,b,c)},trigger:function(b){a.trigger(this,b,l.toArray(arguments).slice(1,100))}};return c._trigger=c.trigger,{register:function(a,d){d=l.isArray(d)?d:[d];for(var e=0;e<d.length;e++){var f=d[e];c[f]?a[f]=c[f]:a[f]=b(f)}},on:function(a,b,c,d){b=l.toArray(b).join(" ").split(" ");var e,f=0,g=b.length;if(c)for(a._events||(a._events={});f<g;f++)e=b[f],a._events[e]||(a._events[e]=[]),a._events[e].push({callback:c,thisArg:d})},once:function(b,c,d,e){a.on(b,c,d,e),a.on(b,c,function(){a.off(b,c,d)})},off:function(a,b,c){l.isFunction(b)&&(c=b,b=void 0),void 0!==b||void 0!==c?l.each(a._events,function(d,e){void 0!==b&&void 0===c?a._events[b]=[]:l.each(d,function(b,d){if(b.callback==c)return a._events[e].splice(d,1),!1})}):a._events=void 0},trigger:function(a,b){var c,d,e,f=!0;return a&&a._events&&(c=a._events[b],c&&c.length>0&&(e=Array.prototype.slice.call(arguments,2),l.each(c,function(b){b&&(d=a,void 0!==b.thisArg&&(d=b.thisArg),b.callback.apply(d,e)===!1&&(f=!1))}))),f},has:function(a,b){return!!l.access(a,"_events."+b+".length")}}}();return a}();!function(){!function(){function a(){if("complete"===document.readyState)setTimeout(e);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",d,!1),window.addEventListener("load",d,!1);else{document.attachEvent("onreadystatechange",d),window.attachEvent("onload",d);var a=!1;try{a=null==window.frameElement&&document.documentElement}catch(a){}a&&a.doScroll&&!function b(){if(!l.isDomReady){try{a.doScroll("left")}catch(a){return setTimeout(b,50)}e()}}()}}function d(){(document.addEventListener||"load"==event.type||"complete"==document.readyState)&&e()}function e(){l.isDomReady||(l.isDomReady=!0,c.trigger(l.core,"domReady"),c.off(l.core,"domReady"))}l.isDomReady=!1,l.domReady=function(d,e){"undefined"==typeof document||"undefined"==typeof window||window.__mock__&&document.__mock__||(d=b(d,e),l.isDomReady||"complete"==document.readyState||window.jQuery&&window.jQuery.isReady?(l.isDomReady=!0,d()):(c.on(l.core,"domReady",d),a()))}}()}();var d=(Array.prototype.slice,/^\s+|\s+$/gm),e=function(){function a(a){var b={};return l.each(a,function(a){b[a]=!0}),b}return a}(),f="class",g=l.queries={},h=function(){function a(){return!1}function b(){return!0}function c(c){this.originalEvent=c,this.type=c.type,this.isDefaultPrevented=c.defaultPrevented||void 0===c.defaultPrevented&&c.returnValue===!1?b:a,this.timeStamp=c.timeStamp||+new Date}var d=/^(?:mouse|pointer|contextmenu)|click/,e=/^key/;return c.PropertiesToCopy={all:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),mouse:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),keyboard:"char charCode key keyCode".split(" ")},c.CopyProperties=function(a,b,d){l.each(c.PropertiesToCopy[d],function(c){b[c]=a[c]})},c.prototype={preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=b,a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=b,a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=b,a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},c.fix=function(a){var b=a.type,f=new c(a);return c.CopyProperties(a,f,"all"),f.target||(f.target=a.srcElement||document),3===f.target.nodeType&&(f.target=f.target.parentNode),f.metaKey=!!f.metaKey,d.test(b)?c.fixMouse(a,f):e.test(b)&&null==f.which&&(c.CopyProperties(a,f,"keyboard"),f.which=null!=a.charCode?a.charCode:a.keyCode),f},c.fixMouse=function(a,b){var d,e,f,g=a.button,h=a.fromElement;c.CopyProperties(a,b,"mouse"),null==b.pageX&&null!=a.clientX&&(e=b.target.ownerDocument||document,f=e.documentElement,d=e.body,b.pageX=a.clientX+(f&&f.scrollLeft||d&&d.scrollLeft||0)-(f&&f.clientLeft||d&&d.clientLeft||0),b.pageY=a.clientY+(f&&f.scrollTop||d&&d.scrollTop||0)-(f&&f.clientTop||d&&d.clientTop||0)),!b.relatedTarget&&h&&(b.relatedTarget=h===b.target?a.toElement:h),b.which||void 0===g||(b.which=1&g?1:2&g?3:4&g?2:0)},c}(),i=function(){function a(a,b,c){a.addEventListener&&"propertychange"!=b?a.addEventListener(b,function(a){c.call(this,h.fix(a))},!1):a.attachEvent&&a.attachEvent("on"+b,function(a){c.call(this,h.fix(a))})}return a}(),j=function(){function a(a,b){return a&&"string"==typeof a&&null!=b?(a=" "+a+" ",a.indexOf(" "+b+" ")):-1}return a}(),k=Object.prototype.hasOwnProperty,m=function(){function a(a){return b[a]}var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},c=function(){var a=[];for(var c in b)a.push(c);return new RegExp("("+a.join("|")+")","g")}(),d={forRegEx:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},forHTML:function(b){return l.isString(b)?b.replace(c,a):b},forHTMLAttributes:function(a){return l.isString(a)?a.replace(/"/g,"&quot;"):a}};return d}(),n="__blocks.VirtualElement__",o="data-id",p="data-query",q=function(){function a(a){var b=document.createDocumentFragment(),c=document.createElement("div"),d=1,e="<table>",f="</table>",g="<tbody>",h="</tbody>",i="<tr>",j="</tr>";for(a=a.toString(),a.indexOf("<option")!=-1&&a.indexOf("<select")==-1?(a="<select>"+a+"</select>",d=2):a.indexOf("<table")==-1&&(a.match(/<(tbody|thead|tfoot)/)?(d=2,a=e+a+f):a.indexOf("<tr")!=-1?(d=3,a=e+g+a+h+f):a.match(/<(td|th)/)&&(d=4,a=e+g+i+a+j+h+f)),c.innerHTML="A<div>"+a+"</div>";d--;)c=c.lastChild;for(;c.firstChild;)b.appendChild(c.firstChild);return b}return a}(),r=function(){function a(a){if(a)return parseFloat(a[1])}var b={};return"undefined"!=typeof document&&l.extend(b,{IE:document&&function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:void 0}(),Opera:window&&window.navigator&&window.opera&&window.opera.version&&parseInt(window.opera.version(),10)||void 0,Safari:window&&window.navigator&&a(window.navigator.userAgent.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),Firefox:window&&window.navigator&&a(window.navigator.userAgent.match(/Firefox\/([^ ]*)/))}),b}(),s=function(){var a=function(){function b(a){var b=a?y.Is(a)?a._state?a._state.attributes[o]:a._attributes[o]:1==a.nodeType?a.getAttribute(o):8==a.nodeType?/\s+(\d+):[^\/]/.exec(a.nodeValue):null:null;return l.isArray(b)?b[1]:b}function c(a,b){y.Is(a)?a.attr(o,b):1==a.nodeType&&a.setAttribute(o,b)}var d={},e=1;return{id:function(a){return b(a)},reset:function(){d={},e=1},collectGarbage:function(){l.each(d,function(b){b&&b.dom&&!document.body.contains(b.dom)&&a.clear(b.id,!0)})},createIfNotExists:function(a){var f,g,h=a&&a.__identity__==n;return f=h?d[a._getAttr(o)]:d[a&&b(a)],f||(g=e++,a&&(h&&a._each?(a._haveAttributes=!0,a._state?a._state.attributes[o]=g:a._attributes[o]=g):c(a,g)),f=a?d[g]={id:g,virtual:h?a:null,animating:0,observables:{},preprocess:h}:d[g]={id:g,observables:{}}),f},byId:function(a){return d[a]},data:function(a,c,e){var f=d[b(a)||a];if(f)return 1==arguments.length?f:(arguments.length>2&&(f[c]=e),f[c])},clear:function(a,c){var e=b(a)||a,f=d[e];!f||f.haveData&&!c||(l.each(f.observables,function(a){for(var b=0;b<a._elements.length;b++)a._elements[b].elementId==f.id&&(a._elements.splice(b,1),b--);if(a._expressions){for(b=0;b<a._expressions.length;b++)a._expressions[b].elementId==f.id&&(a._expressions.splice(b,1),b--);a._expressionKeys[f.id]=null}}),d[e]=void 0,y.Is(a)?a.removeAttr(o):1==a.nodeType&&a.removeAttribute(o))}}}();return a}(),t=function(){function a(a,c,d){b[c]?b[c](a,d,function(b,c){i(a,b,c)}):i(a,c,d)}var b={input:function(a,b,d){function e(a){clearTimeout(g),b(a)}function f(){g||(g=setTimeout(e,4))}var g;r.IE<10?(d("propertychange",function(a){"value"===a.originalEvent.propertyName&&e(a)}),8==r.IE&&(d("keyup",e),d("keydown",e)),r.IE>=8&&(c(a,e),d("dragend",f))):(d("input",e),r.Safari<7&&"textarea"==a.tagName.toLowerCase()?(d("keydown",f),d("paste",f),d("cut",f)):r.Opera<11?d("keydown",f):r.Firefox<4&&(d("DOMAutoComplete",e),d("dragdrop",e),d("drop",e)))}},c=function(){function a(a){var b=this.activeElement,c=b&&s.data(b,"selectionchange");c&&c(a)}var b=!1;return function(c,d){b||(i(c.ownerDocument,"selectionchange",a),b=!0),s.createIfNotExists(c).selectionChange=d}}();return a}(),u=function(){var a=l.dom={valueTagNames:{input:!0,textarea:!0,select:!0},valueTypes:{file:!0,hidden:!0,password:!0,text:!0,color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,time:!0,url:!0,week:!0},props:{for:!0,class:!0,value:!0,checked:!0,tabindex:!0,className:!0,htmlFor:!0},propFix:{for:"htmlFor",class:"className",tabindex:"tabIndex"},attrFix:{className:"class",htmlFor:"for"},addClass:function(a,b){a&&z("add",a,b)},removeClass:function(a,b){a&&z("remove",a,b)},html:function(b,c){if(b)if(c=c.toString(),8==b.nodeType)a.comment.html(b,c);else if(r.IE<10){for(;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(q(c))}else b.innerHTML=c},css:function(a,b,c){a&&b&&("display"==b?A.setVisibility(a,"none"!=c):a.style[b]=c)},on:function(a,b,c){a&&t(a,b,c)},off:function(){},removeAttr:function(b,c){b&&c&&a.attr(b,c,null)},attr:function(b,c,d){var f=a.props[c];if(c=a.propFix[c.toLowerCase()]||c,(!l.core.skipExecution||l.core.skipExecution.element!==b||l.core.skipExecution.attributeName!=c)&&b)return 8==b.nodeType?void a.comment.attr(b,c,d):("checked"==c&&(d=("checked"==d||"string"!=typeof d||"radio"!=b.getAttribute("type")||d==b.value||null==b.defaultValue||""===b.defaultValue)&&(l.isArray(d)?d.indexOf(b.value)!==-1:!!d)),1===arguments.length?f?b[c]:b.getAttribute(c):void(null!=d?"value"==c&&"select"==b.tagName.toLowerCase()?(d=e(l.toArray(d)),l.each(b.children,function(a){a.selected=!!d[a.value]})):f?b[c]=d:b.setAttribute(c,d):f?"value"==c&&"select"==b.tagName.toLowerCase()?b.selectedIndex=-1:b[c]&&(b[c]=""):b.removeAttribute(c)))},comment:{html:function(a,b){for(var c,d=a,e=d.parentNode,f=d.nextSibling,g=0;f&&(8!=f.nodeType||f.nodeValue.indexOf("/blocks")==-1);)g++,c=f.nextSibling,e.removeChild(f),f=c;return e.insertBefore(q(b),d.nextSibling),g},attr:function(a,b,c){if(a&&b==o&&c){var e=a,f=a._endElement;return e.nodeValue=" "+c+":"+e.nodeValue.replace(d,"")+" ",f.nodeValue=" "+c+":"+f.nodeValue.replace(d,"")+" ",this}return this}}};return l.dom}(),v={},w=function(){var a=function(){var a=[];return{startObserving:function(){a.push([])},stopObserving:function(){return a.pop()},currentObservables:function(){return a[a.length-1]},registerObservable:function(b){var c=a[a.length-1],d=!1;c&&(l.each(c,function(a){if(a===b)return d=!0,!1}),d||c.push(b))}}}();return a}(),x=function(){function a(){var b=this.element;this.element=null,this.clone=null;var c=l.clone(this,!0);return c.clone=this.clone=a,this.element=b,c}var b={Html:0,ValueOnly:2,Raw:3,NodeWise:4,Create:function(b,c,d){for(var e,f,g,h=-1,i=0,j=[];b.length>++h;)e=b.charAt(h),"{"==e&&"{"==b.charAt(h+1)?f=h+2:"}"==e&&"}"==b.charAt(h+1)&&(f&&(g=b.substring(f,h),c||(g=g.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")),e=b.substring(i,f-2),e&&j.push({value:e}),j.push({expression:g,attributeName:c}),i=h+2),f=0);return e=b.substring(i),e&&j.push({value:e}),j.text=b,j.attributeName=c,j.element=d,j.isExpression=!0,j.nodeLength=0,j.clone=a,g?j:null},GetValue:function(a,c,d,e){var f,g,h,i=e==b.NodeWise,j=i||e==b.Raw?[]:"",k=d.length,l=-1;if(e=e||b.Html,!a)return d.text;if(e!==b.ValueOnly&&(d.nodeLength=0),1==k)i?(g=d.nodeLength,h=b.Execute(a,c,d[0],d,e),d.nodeLength-g==2&&(j[d.nodeLength-2]=null),j[d.nodeLength-1]=h):j=b.Execute(a,c,d[0],d,e);else for(;++l<k;)g=d.nodeLength,f=d[l],f.value?(e!==b.ValueOnly&&0===d.nodeLength&&d.nodeLength++,h=f.value):(h=b.Execute(a,c,f,d,e),i&&d.nodeLength-g==2&&(j[d.nodeLength-2]=null)),i?j[d.nodeLength-1]=(j[d.nodeLength-1]||"")+h:e==b.Raw?j.push(h):j+=h;return d.lastResult=j,j},Execute:function(a,c,d,e,f){var g,h,i,j,k,n,o=d.expression,p=d.attributeName;n=v[o]=v[o]||new Function("c","with(c){with($this){ return "+o+"}}//# sourceURL="+encodeURI(e.text)),w.startObserving();try{k=n(a)}catch(a){l.debug.expressionFail(o,e.element)}return k=n(a),g=l.isObservable(k),j=g?k():k,j=null==j?"":j.toString(),j=p?m.forHTMLAttributes(j):m.forHTML(j),i=w.stopObserving(),f==b.Raw?{observables:i,result:j,value:k}:(f!=b.ValueOnly&&f!=b.NodeWise&&(g||i.length)?(p||(c=s.createIfNotExists()),c&&(c.haveData=!0,h={length:j.length,attr:p,context:a,elementId:c.id,expression:o,entire:e},l.each(i,function(a){a._expressionKeys[c.id+(p||"expression")+"["+o+"]"]||(a._expressionKeys[c.id+(p||"expression")+"["+o+"]"]=!0,a._expressions.push(h)),c.observables[a.__id__+(p||"expression")+"["+o+"]"]=a})),p||(e.nodeLength+=2,j="<!-- "+c.id+":blocks -->"+j)):p||f===b.ValueOnly||(f==b.NodeWise&&g?e.nodeLength+=2:0===e.nodeLength&&e.nodeLength++),j)}};return b}(),y=function(){function a(b){return a.prototype.isPrototypeOf(this)?(this.__identity__=n,this._tagName=b?b.toString().toLowerCase():null,this._attributes={},this._attributeExpressions=[],this._parent=null,this._children=[],this._isSelfClosing=!1,this._haveAttributes=!0,this._innerHTML=null,this._renderMode=a.RenderMode.All,this._haveStyle=!1,this._style={},this._states=null,this._state=null,void(l.isElement(b)&&(this._el=b))):new a(b)}function b(a,b){var d,e,f=' style="',g=!1;for(d in a)e=a[d],b&&k.call(b.style,d)||(e||0===e)&&(g=!0,d=d.replace(/[A-Z]/g,c),f+=d,f+=":",f+=e,f+=";");if(b)for(d in b.style)e=b.style[d],(e||0===e)&&(g=!0,d=d.replace(/[A-Z]/g,c),f+=d,f+=":",f+=e,f+=";");return f+='"',g?f:""}function c(a){return"-"+a.toLowerCase()}return l.VirtualElement=l.inherit(a,{tagName:function(a){return a?(this._tagName=a,this):this._tagName},html:function(a){return arguments.length>0?(a=null==a?"":a,this._state?this._state.html!==a&&(this._state.html=a,u.html(this._el,a)):(this._innerHTML=a,u.html(this._el,a)),this._children=[],this):this._innerHTML||""},text:function(a){return arguments.length>0?(null!=a&&(a=m.forHTML(a),this.html(a)),this):this.html()},parent:function(){return this._parent},children:function(a){return"number"==typeof a?this._children[a]:this._children},attr:function(a,b){var c,d=this;if("string"==typeof a){var f=this._tagName,g=this._attributes.type,h=b,i=s.data(this),j=this._getAttr("value");if(a=l.unwrapObservable(a),a=u.attrFix[a]||a,b=l.unwrapObservable(b),l.isObservable(h)&&"value"==a&&u.valueTagNames[f]&&(!g||u.valueTypes[g])?(i.subscribe="select"==f?"change":"input",i.valueObservable=h):!l.isObservable(h)||"checked"!=a||"checkbox"!=g&&"radio"!=g||(i.subscribe="click",i.valueObservable=h),1==arguments.length)return c=this._getAttr(a),void 0===c?null:c;"checked"!=a||null==b||this._fake?"disabled"==a&&(b=b?"disabled":null):b="radio"!=this._attributes.type||"string"!=typeof b||j==b||null==j||l.isArray(b)?l.isArray(b)?b.indexOf(j)!==-1?"checked":null:b?"checked":null:null,"textarea"!=f||"value"!=a||this._el?"value"==a&&"select"==f?(this._values=e(l.toArray(b)),u.attr(this._el,a,b)):(this._haveAttributes=!0,this._state?this._state.attributes[a]!==b&&(this._state.attributes[a]=b,u.attr(this._el,a,b)):(this._attributes[a]=b,u.attr(this._el,a,b))):this.html(b)}else l.isPlainObject(a)&&l.each(a,function(a,b){d.attr(b,a)});return this},removeAttr:function(a){return this._attributes[a]=null,u.removeAttr(this._el,a),this},css:function(b,c){var d=this;if("string"==typeof b){if(b=l.unwrap(b),c=l.unwrap(c),!b)return;if(b=b.toString().replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()}),1===arguments.length)return c=this._getCss(b),void 0===c?null:c;"display"==b&&(c="none"==c||!c&&""!==c?"none":""),this._haveStyle=!0,a.CssNumbers[b]||(c=l.toUnit(c)),this._state?this._state.style[b]!==c&&(this._state.style[b]=c,u.css(this._el,b,c)):(this._style[b]=c,u.css(this._el,b,c))}else l.isPlainObject(b)&&l.each(b,function(a,b){d.css(b,a)});return this},addChild:function(a,b){var c,d=this._template||this._children;return a&&(a._parent=this,this._childrenEach||this._each?a._each=!0:this._el&&(c=q(a.render(l.domQuery(this))),a._el=c.childNodes[0],"number"==typeof b?this._el.insertBefore(c,this._el.childNodes[b]):this._el.appendChild(c)),"number"==typeof b?d.splice(b,0,a):d.push(a)),this},addClass:function(a){return z("add",this,a),u.addClass(this._el,a),this},removeClass:function(a){return z("remove",this,a),u.removeClass(this._el,a),this},toggleClass:function(a,b){b===!1?this.removeClass(a):this.addClass(a)},hasClass:function(a){return j(this._attributes[f],a)!=-1},renderBeginTag:function(){var a;return a="<"+this._tagName,this._haveAttributes&&(a+=this._renderAttributes()),this._haveStyle&&(a+=b(this._style,this._state)),a+=this._isSelfClosing?" />":">"},renderEndTag:function(){return this._isSelfClosing?"":"</"+this._tagName+">"},render:function(b,c){var d="",e="",f=this._el;return void 0!==c&&(this._state={attributes:{},style:{},html:null,expressions:{},template:l.clone(this._template||this._children)},this._states||(this._states={}),this._states[c]=this._state),this._el=void 0,this._execute(b),this._el=f,this._renderMode!=a.RenderMode.None&&(this._renderMode!=a.RenderMode.ElementOnly&&(e=this._state&&null!==this._state.html?this._state.html:null!=this._innerHTML?this._innerHTML:this.renderChildren(b,c)),d+=this.renderBeginTag(),d+=e,d+=this.renderEndTag()),this._state=null,d},renderChildren:function(b,c){for(var d,e,f="",g=this._state&&this._state.template||this._template||this._children,h=g.length,i=-1;++i<h;)d=g[i],"string"==typeof d?f+=d:a.Is(d)?(d._each=d._each||this._each,f+=d.render(b,c)):b?(e=x.GetValue(b._context,null,d),this._state&&(this._state.expressions[i]=e),f+=e):f+=!this._each&&d.lastResult?d.lastResult:x.GetValue(null,null,d);return f},sync:function(b,c,d){c&&(this._state=this._states[c],this._el=d,this._each=!1,this._sync=!0),this._execute(b),this.renderBeginTag(),this._innerHTML||this._childrenEach||this._renderMode==a.RenderMode.None||this.syncChildren(b,c),this.renderEndTag(),c&&(this._state=null,this._el=void 0,this._each=!0,this._sync=!1)},syncChildren:function(b,c,d){for(var e,f,g,h,i,j,k=this._state&&this._state.template||this._template||this._children,m=k.length,n=this._state,o=8==this._el.nodeType?this._el:this._el.childNodes[d||0],p=-1;++p<m;)if(i=k[p],i.isExpression){if(b&&(h=x.GetValue(b._context,null,i,n?x.NodeWise:x.Html),!n||n&&n.expressions[p]!==h))if(n)j=n.expressions[p],n.expressions[p]=h,o?l.each(h,function(a,b){return null==a||8==o.nodeType||l.isArray(j)&&j[b]==a?void(o=o.nextSibling):(o.nodeValue=a,void(o=o.nextSibling))}):this._el.textContent=h.join();else for(g=q(h),f=c?i.nodeLength:1,this._el.insertBefore(g,o);f-- >0;)e=o,o=o.nextSibling,this._el.removeChild(e)}else"string"!=typeof i&&i._renderMode!=a.RenderMode.None?(i._each=i._each||this._each,i.sync(b,c,o),o=o.nextSibling):o=o.nextSibling},updateChildren:function(b,c,d,e){for(var f=this._state&&this._state.template||this._template,g=f[0],h=1===f.length&&a.Is(g),i=e.childNodes,j=d.getSyncIndex(),k=this._length(),m=this._state&&this._state.headers||this._headers,n=m?m.length:0,o=-1;++o<c;)d.dataIndex(l.observable.getIndex(b,o)),d.pushContext(b[o]),h?g.sync(d,j+o,i[o+n]):this.syncChildren(d,j+o,o*k+n),d.popContext();d.popContext()},clone:function(){var b=this._el,c=this._parent;this._parent=null,this._el=null,this.clone=null;var d=l.clone(this,!0);return d.clone=this.clone=a.prototype.clone,d._parent=this._parent=c,this._el=b,d},_length:function(){for(var b=this._template,c=-1,d=0;++c<b.length;)b[c]._renderMode!==a.RenderMode.None&&(d+=b[c].isExpression&&b[c].nodeLength?b[c].nodeLength:1);return d},_getAttr:function(a){var b=this._state;return b&&void 0!==b.attributes[a]?b.attributes[a]:this._attributes[a]},_getCss:function(a){var b=this._state;return b&&void 0!==b.style[a]?b.style[a]:this._style[a]},_execute:function(b){if(b&&(this._each&&(this._el=void 0),this._renderMode!=a.RenderMode.None)){var c,d=this._attributes[o];d&&!b._serverData||(s.createIfNotExists(this),b.applyContextToElement(this),d=this._attributes[o],c=s.byId(d)),this._attributeExpressions.length&&this._executeAttributeExpressions(b._context),b.executeQuery(this,this._attributes[p]),c&&!c.haveData&&s.clear(this)}},_renderAttributes:function(){var a,b,c=this._attributes,d=this._state,e="";"option"==this._tagName&&this._parent._values&&(d&&"undefined"!=typeof d.attributes.value?d.attributes.selected=this._parent._values[d.attributes.value]?"selected":null:c.selected=this._parent._values[c.value]?"selected":null);for(a in c)b=c[a],d&&k.call(d.attributes,a)||(""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+m.forHTMLAttributes(b)+'"'));if(d)for(a in d.attributes)b=d.attributes[a],""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+m.forHTMLAttributes(b)+'"');return e},_createAttributeExpressions:function(a){var b,c=this._attributeExpressions,d=this._attributes[o],e=this._each;l.each(this._attributes,function(f,g){f&&(b=!e&&a&&a[d+g]?x.Create(a[d+g],g):x.Create(f,g),b&&c.push(b))})},_setChildren:function(a){this._children=a,(this._template||this._each)&&(this._template=l.clone(a,!0)),this._state&&(this._state.template=l.clone(a,!0))},_executeAttributeExpressions:function(a){for(var b,c,d,e=!this._el,f=this._state&&this._state.attributes,g=s.byId(f?f[o]:this._attributes[o]),h=this._attributeExpressions,i=0;i<h.length;i++)c=h[i],d=x.GetValue(a,g,c),b=c.attributeName,(f&&f[b]!==d||!f)&&(e&&!this._state?this._attributes[b]=d:e||u.attr(this._el,b,d),this._state&&(this._state.attributes[b]=d))}}),a.Is=function(a){return a&&a.__identity__==n},a.RenderMode={All:0,ElementOnly:2,None:4},a.CssNumbers={columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},l.debug.addType("blocks.VirtualElement",a.Is),a}(),z=function(){function a(a,c,e){if(null!=e){e=l.isArray(e)?e:e.toString().split(" ");var g,h,i,k=0;if(y.Is(c))g=c._getAttr(f);else{if(c.classList)return void(b?c.classList[a].apply(c.classList,e):l.each(e,function(b){c.classList[a](b)}));g=c.className}for(g=g||"";k<e.length;k++)h=e[k],i=j(g,h),"add"==a?i<0&&(""!==g&&(h=" "+h),g+=h):i!=-1&&(g=(g.substring(0,i)+" "+g.substring(i+h.length+1,g.length)).replace(d,""));y.Is(c)?c._state?c._state.attributes[f]=g:c._attributes[f]=g:c.className=g}}var b=!0;if("undefined"!=typeof document){var c=document.createElement("div");c.classList&&(c.classList.add("a","b"),b="a b"==c.className)}return a}(),A=function(){function a(a,b){var c=s.data(a);if(c&&c.animating>0){for(var d,e=a.childNodes,f=0,g=0;b!=g;){if(!e[f])return Number.POSITIVE_INFINITY;d=e[f].className,f++,j(d,"b-hide")==-1&&g++}if(!e[f])return Number.POSITIVE_INFINITY;for(d=e[f].className;j(d,"b-hide")!=-1;){if(f++,!e[f])return Number.POSITIVE_INFINITY;d=e[f].className}return f}return b}function b(a,b){var d=!1,e=s.createIfNotExists(b),f=s.createIfNotExists(b.parentNode),g=e.animateCallback,h="remove"==a?"hide":"add"==a?"show":a,i="remove"==a?function(){s.clear(b,!0),b.parentNode&&b.parentNode.removeChild(b)}:"hide"==a?function(){b.style.display="none"}:l.noop,j=function(){e.animating-=1,f.animating-=1,e.animating||i()};if(1!=b.nodeType)return void i();if("show"==a&&(b.style.display=""),e.preprocess)return void i();if(g){d=!0,e.animating+=1,f.animating+=1;var k=l.context(b),m=k.$view||k.$root;g.call(m,b,j,h)}return d||c(h,b,i,j)}function c(a,b,c,e){function f(){z("remove",b,"b-"+a),z("remove",b,"b-"+a+"-end"),e(),b.removeEventListener("transitionend",f,!1),b.removeEventListener(g,f,!1)}if("undefined"==typeof window||void 0===window.ontransitionend)return void c();z("add",b,"b-"+a);
var g,h=window.getComputedStyle(b),i="";void 0===window.onanimationend&&void 0!==window.onwebkitanimationend?(i="-webkit-",g="webkitAnimationEnd"):g="animationend";var j=parseFloat(h["transition-duration"])||0,k=parseFloat(h["transition-delay"])||0,l=parseFloat(h[i+"animation-duration"])||0,m=parseFloat(h[i+"animation-delay"])||0;return j<=0&&k<=0&&l<=0&&m<=0||!d(b,a)?(z("remove",b,"b-"+a),void c()):(s.createIfNotExists(b).animating+=1,s.createIfNotExists(b.parentNode).animating+=1,setTimeout(function(){z("add",b,"b-"+a+"-end"),b.addEventListener("transitionend",f,!1),b.addEventListener(g,f,!1)},1),!0)}function d(a,b){var c,d,e,g=f[a.className+a.getAttribute("style")+a.tagName],h=!1;return g||g===!1?g:(z("remove",a,"b-"+b),d=l.extend({},window.getComputedStyle(a)),z("add",a,"b-"+b),z("add",a,"b-"+b+"-end"),e=window.getComputedStyle(a),c=e.transitionProperty.split(","),l.each(c,function(a){if(a=a.trim().replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()}),"all"==a){for(var b in e)e[b]!=d[b]&&(h=!0);return!1}if(e[a]!=d[a])return h=!0,!1}),z("remove",a,"b-"+b+"-end"),f[a.className+a.getAttribute("style")+a.tagName]=h,h)}var e={insert:function(c,d,e){d=a(c,d);var f,g,h=c.childNodes[d];l.each(e,function(a){if(f=11==a.nodeType?a.childNodes.length:0,g=a.childNodes?a.childNodes[0]:void 0,h?c.insertBefore(a,h):c.appendChild(a),f)for(;f;)b("add",g),g=g.nextSibling,f--;else b("add",a)})},remove:function(c,d,e){var f,g=0;for(d=a(c,d);g<e;g++)f=c.childNodes[d],f&&b("remove",f)&&d++},setVisibility:function(a,b){b?e.show(a):e.hide(a)},show:function(a){b("show",a)},hide:function(a){b("hide",a)}},f={};return e}(),B=function(){function a(b){return a.prototype.isPrototypeOf(this)?(this.__Class__(),void(8==b.nodeType?(this._commentText=b.nodeValue,this._el=b):this._commentText=b)):new a(b)}return l.VirtualComment=l.inherit(y,a,{renderBeginTag:function(){var a=this._getAttr(o),b="<!-- ";return a&&(b+=a+":"),b+=m.forHTML(this._commentText.replace(d,""))+" -->"},renderEndTag:function(){var a=this._getAttr(o),b="<!-- ";return a&&(b+=a+":"),b+="/blocks -->"},_executeAttributeExpressions:l.noop}),a.Is=function(b){return a.prototype.isPrototypeOf(b)},a}(),C=function(){var b=null;if(a.document&&a.document.body){var c=document.body.getAttribute("data-blocks-server-data");c&&(document.body.removeAttribute("data-blocks-server-data"),b=JSON.parse(c.replace("&quot;",'"')))}return b}(),D=function(){function a(e,f){for(var g,h,i,j,k,m,n,o,q,s=[];e;){if(m=e.nodeType,1==m){h=e.tagName.toLowerCase(),g=new y(e),g._tagName=h,g._parent=f,f&&(g._each=f._each||f._childrenEach),g._haveAttributes=!1,j=e.attributes,i={};for(var t=0;t<j.length;t++)k=j[t],"style"!==k.nodeName&&(k.specified||r.IE<8&&"value"==k.nodeName&&k.nodeValue)&&(i[k.nodeName.toLowerCase()]=r.IE<11?k.nodeValue:k.value,g._haveAttributes=!0);g._attributes=i,g._createAttributeExpressions(C),e.style.cssText&&(g._haveStyle=!0,g._style=b(e.style.cssText)),c(g),"script"==h||"style"==h||"code"==h||g.hasClass("bl-skip")?g._innerHTML=e.innerHTML:g._children=a(e.childNodes[0],g),s.push(g)}else if(3==m)q=e.data,s.push(x.Create(q,null,e)||q);else if(8==m)if(n=e.nodeValue,o=n.replace(d,""),0===o.indexOf("blocks"))g=new B(e),g._parent=f,g._attributes[p]=o.substring(6),q=a(e.nextSibling,g),g._children=q.elements,g._el._endElement=q.htmlElement,e=q.htmlElement||e,s.push(g);else{if(B.Is(f)&&0===o.indexOf("/blocks"))return{elements:s,htmlElement:e};if(B.Is(f))s.push("<!--"+n+"-->");else if(C){var u=parseInt(/[0-9]+/.exec(o),10);!l.isNaN(u)&&C[u]&&s.push(x.Create(C[u]))}else 0!==o.indexOf("/blocks")&&s.push("<!--"+n+"-->")}e=e.nextSibling}return s}function b(a){for(var b,c,e,f=a.split(";"),g={},h=0;h<f.length;h++)c=f[h],c&&(b=c.indexOf(":"),b!=-1&&(e=[c.substring(0,b),c.substring(b+1)],g[e[0].toLowerCase().replace(d,"")]=e[1].replace(d,"")));return g}function c(a){var b,c=a._tagName;return void 0!==e[c]?void(a._isSelfClosing=e[c]):(b=document.createElement("div"),b.appendChild(document.createElement(c)),void(e[c]=a._isSelfClosing=b.innerHTML.indexOf("</")===-1))}var e={};return a}(),E=function(){function a(a){return function(b){return 0===arguments.length?this[a]:(this[a]=b,this)}}return a}(),F=function(){function a(a,b){var c,e,f=0,g=0,h=0,i=0,j=!1,k=!1,l=0,m=[];a=a||"";for(var n=0;n<a.length;n++)f=a.charAt(n),j||k||("["==f?i++:"]"==f?i--:"{"==f?h++:"}"==f&&h--),0===h&&0===i&&("'"==f?j=!j:'"'==f&&(k=!k),j||k||("("==f?(0===g&&(e=a.substring(l,n).replace(d,""),l=n+1),g++):")"==f?(g--,0===g&&(c=a.substring(l,n).replace(d,""),c.length&&m.push(c),e&&(e=e.replace(/^("|')+|("|')+$/g,""),b(e,m)),m=[],e=void 0)):","==f&&1==g?(c=a.substring(l,n).replace(d,""),c.length&&m.push(c),l=n+1):"."==f&&0===g&&(l=n+1)))}return a}(),G=function(){function a(a){this._options=a||{}}function b(b,c){var d=a.QueryCache[b]=[];return F(b,function(a,b){var e=l.queries[a],f={name:a,params:b,query:a+"("+b.join(",")+")"};e?"attr"==a||"val"==a?d.unshift(f):d.push(f):l.debug.queryNotExists(f,c)}),d}a.QueryCache={},a.prototype={options:function(){return this._options},dataIndex:E("_dataIndex"),context:E("_context"),popContext:function(){this._context&&(this._context=this._context.$parentContext)},applyContextToElement:function(a){var b=s.createIfNotExists(a);b.domQuery=this,b.context=this._context,(this._hasChanged||a._each&&!a._parent._each)&&(a._parent&&!a._each&&(b=s.createIfNotExists(a._parent),b.childrenContext=this._context),this._hasChanged=!1,b.haveData=!0)},pushContext:function(a){var b,c=this._context,d=c?c.$parents.slice(0):[];return this._hasChanged=!0,c&&d.unshift(c.$this),b={$this:a,$root:c?c.$root:a,$parent:c?c.$this:null,$parents:c?d:[],$index:this._dataIndex||null,$parentContext:c||null,__props__:l.clone(c&&c.__props__)},b.$context=b,this._context=b,this.applyProperties(),b},getSyncIndex:function(){for(var a=this._context,b="";a&&a.$index;)b=a.$index.__value__+"_"+b,a=a.$parentContext;return b},contextBubble:function(a,b){var c=this._context;this._context=a,b(),this._context=c},addProperty:function(a,b){var c=this._context;c.__props__=c.__props__||{},c.__props__[a]=b,this.applyProperties()},applyProperties:function(){var a,b=this._context.__props__;for(a in b)this._context[a]=b[a]},executeElementQuery:function(a){var b=y.Is(a)?a._attributes[p]:1==a.nodeType?a.getAttribute(p):a.nodeValue.substring(a.nodeValue.indexOf("blocks")+6).replace(d,"");b&&this.executeQuery(a,b)},executeQuery:function(c,d){var e=a.QueryCache[d]||b(d,c);this.executeMethods(c,e)},executeMethods:function(a,b){for(var c,d,e,f,g,h,i,j=s.data(a),k=0,m=0;m<b.length;m++)if(h=this._context,c=l.queries[b[m].name],f=b[m].params,d=c.passDomQuery?[this]:[],!y.Is(a)||c.call||c.preprocess||!c.update&&!c.ready){w.startObserving();for(var n=0;n<f.length;n++){g=f[n],i=v[g]=v[g]||new Function("c","with(c){with($this){ return "+g+"}}"),e={};try{e.rawValue=i(h)}catch(c){l.debug.queryParameterFail(b[m],g,a)}if(e.rawValue=i(h),e.value=l.unwrapObservable(e.rawValue),c.passDetailValues?(e.parameterName=g,e.isObservable=l.isObservable(e.rawValue),e.containsObservable=w.currentObservables().length>k,k=w.currentObservables().length,d.push(e)):c.passRawValues?d.push(e.rawValue):d.push(e.value),c===l.queries.if||c===l.queries.ifnot){if(!e.value&&c===l.queries.if||e.value&&c===l.queries.ifnot){if(!f[2])break;this.executeQuery(a,f[2]);break}this.executeQuery(a,f[1]);break}}var o=d;if(c.passDomQuery&&(o=l.clone(d).slice(1)),l.debug.checkQuery(b[m].name,o,b[m],a),y.Is(a)){if(B.Is(a)&&!c.supportsComments){l.debug.throwMessage("data-query "+b[m].name+" does not support to be executed as on a comment.",l.debug.queries[b[m].name],"Error");continue}if(c.call)c.call===!0?a[b[m].name].apply(a,d):(d.unshift(c.prefix||b[m].name),a[c.call].apply(a,d));else if(c.preprocess&&c.preprocess.apply(a,d)===!1){this.subscribeObservables(b[m],j,h);break}}else if(c.call){var p=s.data(a).virtual;p._each&&(p=y("div"),p._el=a,p._fake=!0),c.call===!0?p[b[m].name].apply(p,d):(d.unshift(c.prefix||b[m].name),p[c.call].apply(p,d))}else j&&j.preprocess&&c.ready?c.ready.apply(a,d):c.update&&c.update.apply(a,d);this.subscribeObservables(b[m],j,h)}else j.haveData=!0,j.execute||(j.execute=[],j.executeHash={}),j.executeHash[b[m].query]||(j.execute.push(b[m]),j.executeHash[b[m].query]=!0)},subscribeObservables:function(a,b,c){var d=w.stopObserving();b&&(b.haveData=!0,l.each(d,function(d){b.observables[d.__id__+a.query]||(b.observables[d.__id__+a.query]=d,d._elements.push({elementId:b.id,element:b.dom||b.virtual._el,cache:[a],context:c}))}))},createElementObservableDependencies:function(a){for(var b,d,e,f=0;f<a.length;f++)if(b=a[f],e=(b.tagName||"").toLowerCase(),1===b.nodeType||8==b.nodeType){if(d=s.data(b)){if(this._context=d.context||this._context,d.dom=b,d.execute&&this.executeMethods(b,d.execute),d.subscribe){var g=d.updateOn||d.subscribe;t(b,g,c[g])}d.preprocess=!1,this._context=d.childrenContext||this._context}"script"!=e&&"code"!=e&&(" "+b.className+" ").indexOf("bl-skip")==-1&&this.createElementObservableDependencies(b.childNodes)}},createFragment:function(a){var b=q(a);return this.createElementObservableDependencies(b.childNodes),b},cloneContext:function(a){var b=l.clone(a);return b.$context=b,b}};var c={change:function(a){var b=a.target||a.srcElement;c.getSetValue(b,s.data(b).valueObservable)},click:function(a){c.change(a)},input:function(a){var b=a.target||a.srcElement;c.getSetValue(b,s.data(b).valueObservable)},keydown:function(a){var b=a.target||a.srcElement,d=b.value,e=s.data(b);e&&setTimeout(function(){d!=b.value&&c.getSetValue(b,s.data(b).valueObservable)})},getSetValue:function(a,b){var c=a.tagName.toLowerCase(),d=a.getAttribute("type");if(!l.isArray(b())||"checkbox"!=d&&"radio"!=d)if("checkbox"==d)b(a.checked);else if("select"==c&&null!==a.getAttribute("multiple")){var e=[],f=a.selectedOptions;f?l.each(f,function(a){e.push(a.getAttribute("value"))}):l.each(a.options,function(a){a.selected&&e.push(a.getAttribute("value"))}),b(e)}else l.core.skipExecution={element:a,attributeName:"value"},b(a.value),l.core.skipExecution=void 0;else{var g=b();a.checked?g.indexOf(a.value)==-1&&b.add(a.value):g.indexOf(a.value)!==-1&&b.splice(g.indexOf(a.value),1)}}};return a}();!function(){l.extend(g,{if:{},ifnot:{},template:{passDomQuery:!0,passDetailValues:!0,preprocess:function(a,b,c){var d,e=a._serverData,f=b.parameterName;if(b=b.rawValue,c&&(c=c.rawValue),b=l.$unwrap(b),l.isElement(b)?d=b.innerHTML:(d=document.getElementById(l.isString(b)?b:f),d=d?d.innerHTML:b),d&&(c&&l.queries.with.preprocess.call(this,a,c,"$template"),!e||!e.templates||!e.templates[s.id(this)]))if(this._el)this.html(d),this._each||(this._children=D(this._el.childNodes[0],this),this._innerHTML=null);else{var g=document.createElement("div");g.innerHTML=d;var h=D(g.childNodes[0],this);this._setChildren(h),this._innerHTML=null}}},define:{passDomQuery:!0,preprocess:function(a,b,c){if(this._renderMode!=y.RenderMode.None){var d=a.context(),e=a.cloneContext(d),f=this.renderEndTag;s.data(this).context=e,a.context(e),a.addProperty(b,c),this.renderEndTag=function(){return a.context(d),f.call(this)}}}},with:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){if(this._renderMode!=y.RenderMode.None){var d=this.renderEndTag;a.pushContext(b),c&&a.addProperty(c,b),this.renderEndTag=function(){return a.popContext(),d.call(this)}}}},each:{passDomQuery:!0,passRawValues:!0,supportsComments:!0,_getStaticHtml:function(a,b){var c,e,f,g=b._state&&b._state.template||b._template||b._children,h=b._state&&b._state.headers||b._headers,i=b._state&&b._state.footer||b._footers,j=-1,k="",l="";if(h)for(c=Math.max(h.length,i.length);++j<c;)h[j]&&(k+=h[j].render(a)),i[j]&&(l+=i[j].render(a));else for(b._state?(h=b._state.headers=[],i=b._state.footers=[]):(h=b._headers=[],i=b._footers=[]);++j<g.length;)f=g[j],f.isExpression||("string"!=typeof f?(f._each=!0,e=f._attributes["data-role"],"header"==e?(k+=f.render(a),h.push(f),g.splice(j--,1)):"footer"==e&&(l+=f.render(a),i.push(f),g.splice(j--,1))):""===f.replace(d,"").replace(/(\r\n|\n|\r)/gm,"")&&g.splice(j--,1));return{header:k,headersCount:h.length,footer:l,footersCount:i.length}},preprocess:function(a,b){var c,d,e,f,h=a.getSyncIndex(),i=this,j=0;if(i._sync)return void i.updateChildren(b,b.length,a,this._el);if(i._template=i._template||i._children,i._childrenEach=!0,a._serverData&&(d=a._serverData[s.id(this)],a._serverData[s.id(this)]=void 0,d)){var k=document.createElement("div");k.innerHTML=d,i._template=i._children=D(k.childNodes[0],i),i._state&&(i._state.template=l.clone(i._template,!0))}if(e=g.each._getStaticHtml(a,i),f=e.header,l.isObservable(b)&&(d=s.data(i),d.eachData={id:b.__id__,element:i,startOffset:e.headersCount,endOffset:e.footersCount}),c=l.unwrapObservable(b),l.isArray(c))for(j=0;j<c.length;j++)a.dataIndex(l.observable.getIndex(b,j)),a.pushContext(c[j]),f+=this.renderChildren(a,h+j),a.popContext(),a.dataIndex(void 0);else if(l.isObject(c))for(var m in c)a.dataIndex(l.observable.getIndex(b,j)),a.pushContext(c[m]),f+=i.renderChildren(a),a.popContext(),a.dataIndex(void 0),j++;this.html(f+e.footer)}},options:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){c=c||{};var d,e="$this",f=x.Create("{{"+(c.text||e)+"}}"),g=x.Create("{{"+(c.value||e)+"}}","value"),h=l.isString(c.caption)&&new y("option"),i=new y("option"),j=this._state&&this._state.template||this._template||this._children,k=0;if(this._sync)return void l.queries.each.preprocess.call(this,a,b);for(;k<j.length;k++)d=j[k],(!d._attributes||d._attributes&&!d._attributes["data-role"])&&j.splice(k--,1);i._attributeExpressions.push(g),i._children.push(f),i._parent=this,j.push(i),h&&(h._attributes["data-role"]="header",h._innerHTML=c.caption,h._parent=this,j.push(h)),l.queries.each.preprocess.call(this,a,b)},update:function(a,b){var c,d,e=s.data(this),f=b(),g=e.virtual._state,h=g&&g.headers||e.virtual._headers,i=e.valueObservable,j=(g&&g.template[0]||e.virtual._template[0])._attributeExpressions[0],k=l.isObservable(i)?i._getValue():this.value;if(l.isArray(f))for(var m=0;m<f.length;m++)if(a.dataIndex(l.observable.getIndex(b,m)),a.pushContext(f[m]),c=x.GetValue(a._context,null,j,x.ValueOnly),a.popContext(),0===m&&(d=c),c===k)return;h&&h[0]&&(d=h[0]._attributes.value||h[0]._innerHTML),l.isObservable(i)?i(d):u.attr(this,"value",d)}},render:{passDetailValues:!0,preprocess:function(a){if(!this._each&&!this._sync)throw new Error("render() is supported only() in each context");this._renderMode=a.value?y.RenderMode.All:y.RenderMode.None,a.containsObservable&&this._renderMode==y.RenderMode.None&&(this._renderMode=y.RenderMode.ElementOnly,this.css("display","none"),s.data(this,"renderCache",this))},update:function(a){var b=s.data(this);b.renderCache&&a.value&&(this.innerHTML=b.renderCache.renderChildren(l.domQuery(this)),l.domQuery(this).createElementObservableDependencies(this.childNodes),b.renderCache=null),this.style.display=a.value?"":"none"}},updateOn:{preprocess:function(a){s.data(this).updateOn=a}},animate:{preprocess:function(a){s.data(this).animateCallback=a}},setClass:{preprocess:function(a,b){arguments.length>1?this.toggleClass(a,!!b):this.addClass(a)},update:function(a,b){var c=s.data(this).virtual;c._each&&(c=y(),c._el=this),arguments.length>1?c.toggleClass(a,b):c.addClass(a)}},html:{call:!0},text:{call:!0},visible:{call:"css",prefix:"display"},attr:{passRawValues:!0,call:!0},val:{passRawValues:!0,call:"attr",prefix:"value"},checked:{passRawValues:!0,call:"attr"},disabled:{passRawValues:!0,call:"attr"},css:{call:!0},width:{call:"css"},height:{call:"css"},focused:{preprocess:l.noop,update:function(a){a&&this.focus()}},on:{ready:function(a,b){if(a&&b){var c,d=l.toArray(arguments).slice(2),e=this,f=l.context(this);b=l.toArray(b);var g=function(a){var e=l.clone(d);e.splice(0,0,a),f=l.context(this)||f,c=f.$template||f.$view||f.$root,l.each(b,function(a){a.apply(c,e)})};a=l.isArray(a)?a:a.toString().split(" "),l.each(a,function(a){i(e,a,g)})}}}}),l.each(["click","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","select","change","submit","reset","focus","blur","keydown","keypress","keyup"],function(a){l.queries[a]={passRawValues:!0,ready:function(){var b=l.toArray(arguments);b.splice(0,0,a),l.queries.on.ready.apply(this,b)}}})}();var H="__blocks.observable__",I=function(){function a(a){this.observable=a,this.chunkLengths={},this.dispose()}return a.prototype={dispose:function(){this.childNodesCount=void 0,this.startIndex=0,this.observableLength=void 0,this.startOffset=0,this.endOffset=0},setStartIndex:function(a){this.startIndex=a+this.startOffset},setChildNodesCount:function(a){void 0===this.childNodesCount&&(this.observableLength=this.observable._getValue().length),this.childNodesCount=a-(this.startOffset+this.endOffset)},chunkLength:function(a){var b,c=this.chunkLengths,d=s.id(a),e=c[d]||(this.childNodesCount||a.childNodes.length)/(this.observableLength||this.observable._getValue().length);return b=l.isNaN(e)||e===1/0?0:Math.round(e),c[d]=b,b},getAt:function(a,b){for(var c=this.chunkLength(a),d=a.childNodes,e=[],f=0;f<c;f++)e[f]=d[b*c+f+this.startIndex];return e},insertAt:function(a,b,c){A.insert(a,this.chunkLength(a)*b+this.startIndex,l.isArray(c)?c:[c])},remove:function(a,b){var c=this;this.each(function(d){for(var e=0;e<b;e++)c._removeAt(d,a)}),s.collectGarbage(),this.dispose(),this.observable._indexes.splice(a,b)},add:function(a,b){var c=this,d=this.observable;l.each(a,function(a,c){d._indexes.splice(b+c,0,l.observable(b+c))}),this.each(function(e,f){var g,h=l.domQuery(e),i=l.context(e),j="";if(h.contextBubble(i,function(){g=h.getSyncIndex();for(var c=0;c<a.length;c++)h.dataIndex(l.observable.getIndex(d,c+b,!0)),h.pushContext(a[c]),j+=f.renderChildren(h,g+(c+b)),h.popContext(),h.dataIndex(void 0)}),0===e.childNodes.length)u.html(e,j),h.createElementObservableDependencies(e.childNodes);else{var k=h.createFragment(j);c.insertAt(e,b,k)}}),this.dispose()},each:function(a){for(var b=0,c=this.observable._elements;b<c.length;b++){var d=c[b];d.element||(d.element=s.data(d.elementId).dom),this.setup(d.element,a)}},setup:function(a,b){if(a){var c,d,e,f,g=s.data(a).eachData;if(g&&g.id==this.observable.__id__)if(c=g.element,this.startOffset=g.startOffset,this.endOffset=g.endOffset,1==a.nodeType)this.setStartIndex(0),this.setChildNodesCount(a.childNodes.length),b(a,c,a);else{for(d=s.id(a),f=a.parentNode.firstChild,e=0;f!=a;)f=f.nextSibling,e++;for(this.setStartIndex(e+1);f&&(8!=f.nodeType||1!=f.nodeValue.indexOf(d+":/blocks"));)f=f.nextSibling,e++;this.setChildNodesCount(e-this.startIndex),b(a.parentNode,c,a)}}},_removeAt:function(a,b){var c=this.chunkLength(a);A.remove(a,c*b+this.startIndex,c)}},a}();!function(){function a(a){a._dependencyType&&(l.debug.pause(),a._getDependency=l.bind(b,a),l.debug.resume(),a.on("get",a._getDependency))}function b(){var a=this,b=a.__value__,d=1==a._dependencyType?b:b.get;c.off(a,"get",a._getDependency),a._getDependency=void 0,w.startObserving(),d.call(a.__context__),l.each(w.stopObserving(),function(b){var c=b._dependencies=b._dependencies||[],d=!1;l.each(c,function(b){if(a===b)return d=!0,!1}),d||c.push(a)})}function d(a){var b=a.__context__;return 1==a._dependencyType?a.__value__.call(b):2==a._dependencyType?a.__value__.get.call(b):a.__value__}var e=1;l.observable=function(b,f){var g=function(a){0===arguments.length&&c.trigger(g,"get",g);var b=d(g),e=g.update;return g._executed||(g._firstExecution(b),g._executed=!0),0===arguments.length?(w.registerObservable(g),b):(l.equals(a,b,!1)||c.trigger(g,"changing",a,b)===!1||(g.update=l.noop,g._dependencyType?2==g._dependencyType&&g.__value__.set.call(g.__context__,a):l.isArray(b)&&(l.isArray(a)||!a)&&g.reset?g.reset(a):l.isArray(b)||g.reset||(g.__value__=a),g.update=e,g.update(),c.trigger(g,"change",a,b)),g)};return b=l.unwrap(b),l.debug.pause(),l.extend(g,l.observable.fn.base),l.debug.resume(),g.__id__=e++,g.__value__=b,g.__context__=f||l.__viewInInitialize__||g,g._expressionKeys={},g._expressions=[],g._elementKeys={},g._elements=[],g._executed=!1,g._getValue=function(){return d(g)},l.isArray(b)?(l.debug.pause(),l.extend(g,l.observable.fn.array),l.debug.resume()):l.isFunction(b)?g._dependencyType=1:b&&!b.__Class__&&l.isFunction(b.get)&&l.isFunction(b.set)&&(g._dependencyType=2),g._dependencyType&&(l.debug.pause(),l.extend(g,l.observable.fn.dependency),l.debug.resume()),g._initialize(),a(g),g};var f={};l.extend(l.observable,{getIndex:function(a,b,c){if(!l.isObservable(a))return f[b]||(f[b]=l.observable(b)),f[b];var d,e=a._indexes;return e?e.length==a.__value__.length||c?d=e[b]:(d=l.observable(b),e.splice(b,0,d)):d=l.observable(b),d},fn:{base:{__identity__:H,_firstExecution:l.noop,_initialize:l.noop,update:function(){var b,c,d,e,f,g,h,i=this._elements;w.startObserving(),l.eachRight(this._expressions,function(a){e=a.element,d=a.context,e||(b=s.data(a.elementId),e=a.element=b.dom);try{h=v[a.expression](d),g=l.unwrap(h)}catch(a){g=""}g=null==g?"":g.toString(),f=a.length-g.length,a.length=g.length,e?(l.isObservable(h)&&h._expressions.indexOf(a)==-1&&h._expressions.push(a),a.attr?u.attr(e,a.attr,x.GetValue(d,null,a.entire)):e.nextSibling?(e=e.nextSibling,e.nodeValue=g+e.nodeValue.substring(a.length+f)):e.parentNode.appendChild(document.createTextNode(g))):(e=b.virtual,a.attr&&e.attr(a.attr,x.GetValue(d,null,a.entire)))});for(var j=0;j<i.length;j++)g=i[j],e=g.element,!e&&s.data(g.elementId)&&(e=g.element=s.data(g.elementId).dom,e||(e=s.data(g.elementId).virtual)),y.Is(e)||document.body.contains(e)?(c=l.domQuery(e),c.contextBubble(g.context,function(){c.executeMethods(e,g.cache)})):(i.splice(j,1),j-=1);return this._dependencies&&l.each(this._dependencies,function(b){a(b),b.update()}),this._indexes&&l.each(this._indexes,function(a,b){a(b)}),w.stopObserving(),this},on:function(a,b,d){return c.on(this,a,b,d||this.__context__),this},once:function(a,b,d){return c.once(this,a,b,d||this.__context__),this},off:function(a,b){return c.off(this,a,b),this},extend:function(a){var b,c=l.observable[a];return 0===arguments.length?(l.core.expressionsCreated&&l.core.applyExpressions(l.type(this()),this),this):c?(b=c.apply(this,l.toArray(arguments).slice(1)),l.isObservable(b)?b:this):void 0},clone:function(a){var b=this.__value__;return l.observable(a?l.clone(b):b,this.__context__)},toString:function(){var a=d(this);return w.registerObservable(this),null!=a&&l.isFunction(a.toString)?a.toString():String(a)},toJSON:function(){return this()}},array:{_initialize:function(){this._indexes=[],this._chunkManager=new I(this)},reset:function(a){if(0===arguments.length)return this.removeAll(),this;if(a=l.unwrap(a),l.isArray(a)||!a){var b=this.__value__,d=this._chunkManager,e=Math.max(a.length-b.length,0),f=Math.max(b.length-a.length,0),g=a.length-e;return c.trigger(this,"removing",{type:"removing",items:b,index:0}),c.trigger(this,"adding",{type:"adding",items:a,index:0}),d.each(function(b,c){var d=l.domQuery(b);d.contextBubble(l.context(b),function(){c.updateChildren(a,g,d,b)})}),e>0?d.add(a.slice(b.length),b.length):f>0&&d.remove(a.length,f),this.__value__=a,this.update(),c.trigger(this,"remove",{type:"remove",items:b,index:0}),c.trigger(this,"add",{type:"add",items:a,index:0}),this}},add:function(a,b){return this.splice(l.isNumber(b)?b:this.__value__.length,0,a),this},addMany:function(a,b){return this.splice.apply(this,[l.isNumber(b)?b:this.__value__.length,0].concat(l.toArray(a))),this},swap:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;l.swap(d,a,b);for(var g=0;g<e.length;g++)c=e[g].element,a>b?(f.insertAt(c,a,f.getAt(c,b)),f.insertAt(c,b,f.getAt(c,a))):(f.insertAt(c,b,f.getAt(c,a)),f.insertAt(c,a,f.getAt(c,b)));return this},move:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;l.move(d,a,b),b>a&&b++;for(var g=0;g<e.length;g++)c=e[g].element,f.insertAt(c,b,f.getAt(c,a));return this},remove:function(a,b){return this.removeAll(a,b,!0)},removeAt:function(a,b){return l.isNumber(b)||(b=1),this.splice(a,b),this},removeAll:function(a,b,d){var e,f,g=this.__value__,h=this._chunkManager;if(0===arguments.length)(c.has(this,"removing")||c.has(this,"remove"))&&(e=l.clone(g)),c.trigger(this,"removing",{type:"removing",items:e,index:0}),h.remove(0,g.length),this._indexes=[],e=g.splice(0,g.length),c.trigger(this,"remove",{type:"remove",items:e,index:0});else{var i,j=l.isFunction(a);for(f=0;f<g.length&&(i=g[f],!(i===a||j&&a.call(b,i,f,g))||(this.splice(f,1),f-=1,!d));f++);}return this.update(),this},concat:function(){var a=this();return a.concat.apply(a,l.toArray(arguments))},slice:function(a,b){return arguments.length>1?this().slice(a,b):this().slice(a)},join:function(a){return arguments.length>0?this().join(a):this().join()},pop:function(){var a=this,b=a();return a.splice(b.length-1,1)[0]},push:function(){return this.addMany(l.toArray(arguments)),this.__value__.length},reverse:function(){var a=this().reverse(),b=this._chunkManager;return this._indexes.reverse(),b.each(function(c){for(var d=1;d<a.length;d++)b.insertAt(c,0,b.getAt(c,d))}),this.update(),a},shift:function(){return this.splice(0,1)[0]},sort:function(a){for(var b,c,d=this.__value__,e=d.length,f=arguments.length>0,g=this._chunkManager,h=this._indexes,i=0;i<e;i++){var j=[d[i],i];g.each(function(a){j.push(g.getAt(a,i))}),d[i]=j}for(d.sort(function(b,c){return b=b[0],c=c[0],f?a.call(this,b,c):b<c?-1:b>c?1:0}),h.length>0&&(this._indexes=[]),i=0;i<e;i++)c=d[i],h.length>0&&this._indexes.push(h[c[1]]),b=2,g.each(function(a){g.insertAt(a,e,c[b]),b++}),d[i]=c[0];return this.update(),d},splice:function(a,b){var d,e=this.__value__,f=this._chunkManager,g=[],h=arguments;return a=a<0?e.length-a:a,b&&a<e.length&&a>=0&&(b=Math.min(e.length-a,b),g=e.slice(a,a+b),c.trigger(this,"removing",{type:"removing",items:g,index:a}),f.remove(a,b),g=e.splice(a,b),c.trigger(this,"remove",{type:"remove",items:g,index:a})),h.length>2&&(d=l.toArray(h),d.splice(0,2),c.trigger(this,"adding",{type:"adding",index:a,items:d}),f.add(d,a),e.splice.apply(e,[a,0].concat(d)),c.trigger(this,"add",{type:"add",index:a,items:d})),this.update(),g},unshift:function(){return this.addMany(l.toArray(arguments),0),this.__value__.length}},dependency:{_firstExecution:function(a){l.isArray(a)&&(this._indexes=[],this._chunkManager=new I(this),this._length=a.length)},update:function(){var a=this._getValue(),b=this._length,c=this._chunkManager,d=Math.max(a.length-b,0),e=Math.max(b-a.length,0),f=a.length-d;l.observable.fn.base.update.apply(this),l.isArray(a)&&(c.each(function(b,c){var d=l.domQuery(b);d.contextBubble(l.context(b),function(){c.updateChildren(a,f,d,b)})}),d>0?c.add(a.slice(b),b):e>0&&c.remove(b,e),this._length=a.length)}}}})}();var J=function(){function a(){return!0}var b={NOOP:0,ADD:1,REMOVE:2,EXISTS:3},d={waiting:{},operations:{FILTER:1,STEP:2,SKIP:3,TAKE:4,SORT:5},initExpressionExtender:function(a){var b=a.clone();return b.view=l.observable([]),b.view._connections={},b.view._observed=[],b.view._updateObservable=l.bind(d.updateObservable,b),b._operations=a._operations?l.clone(a._operations):[],b._getter=l.bind(d.getter,b),b.view._initialized=!1,b.view.on("get",b._getter),b.on("add",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),d.executeOperations(b))}),b.on("remove",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),d.executeOperations(b))}),b},getter:function(){c.off(this.view,"get",this._getter),this._getter=void 0,this.view._initialized=!0,d.executeOperationsPure(this)},updateObservable:function(){d.executeOperations(this)},executeOperationsPure:function(a){var b=[],e=a.view._observed,f=a.view._updateObservable;l.each(e,function(a){c.off(a,"change",f)}),e=a.view._observed=[],w.startObserving(),l.each(a._operations,function(c){if(c.type==d.operations.STEP){var e=a.view;a.view=l.observable([]),a.view._connections={},b.length&&d.executeOperationsChunk(a,b),c.step.call(a.__context__),a.view=e}else b.push(c)}),b.length&&d.executeOperationsChunk(a,b),l.each(w.stopObserving(),function(a){e.push(a),a.on("change",f)})},executeOperations:function(a){var b=a.__id__,c=d.waiting;c[b]||(c[b]=!0,setTimeout(function(){d.executeOperationsPure(a),c[b]=!1},0))},executeOperationsChunk:function(c,e){function f(a){return n?k[m[a]]:k[a]}var g,h=b.NOOP,i=c._getValue(),j=c.view,k=j._connections,m={},n=!1,o={},p=0,q=j.update,r=0,s=i.length;j.update=l.noop,l.each(e,function(b){switch(b.type){case d.operations.SKIP:r=b.skip,l.isFunction(r)&&(r=r.call(c.__context__)),r=l.unwrap(r);break;case d.operations.TAKE:s=b.take,l.isFunction(s)&&(s=s.call(c.__context__)),s=l.unwrap(s);break;case d.operations.SORT:i=l.isString(b.sort)?l.clone(i).sort(function(a,c){return a=l.unwrap(a[b.sort]),c=l.unwrap(c[b.sort]),a>c?1:a<c?-1:0}):l.isFunction(b.sort)?l.clone(i).sort(b.sort.bind(c.__context__)):l.clone(i).sort(),1==e.length&&e.push({type:d.operations.FILTER,filter:a}),n=!0}}),n&&l.each(c._getValue(),function(a,b){l.each(i,function(c,d){if(c==a)return m[d]=b,!1})}),l.each(i,function(a,q){var t;if(s<=0){for(;j().length-p>0;)j.removeAt(j().length-1),j._connections={};return!1}switch(l.each(e,function(e){var g=e.filter;switch(e.type=e.type||g&&d.operations.FILTER,e.type){case d.operations.FILTER:if(!g.call(c.__context__,a,q,i))return h=b.NOOP,void 0!==f(q)&&(h=b.REMOVE),!1;h=b.EXISTS,void 0===f(q)&&(h=b.ADD);break;case d.operations.SKIP:if(h=b.EXISTS,r-=1,r>=0)return h=void 0!==f(q)?b.REMOVE:b.NOOP,!1;r<0&&void 0===f(q)&&(h=b.ADD);break;case d.operations.TAKE:if(s<=0)return h=void 0===f(q)?b.NOOP:b.REMOVE,!1;s-=1,h=b.EXISTS,void 0===f(q)&&(h=b.ADD)}}),t=f(q),g=n?m[q]:q,h){case b.ADD:o[g]=p,j.splice(p,0,a),l.each(k,function(a,b){a>=p&&(k[b]=++a)}),p++;break;case b.REMOVE:j.removeAt(t),l.each(k,function(a,b){a>t&&(k[b]=--a)});break;case b.EXISTS:o[g]=p,t!=p&&(j.move(t,p),l.each(k,function(a,b){(n?b!=m[q]:b!=q)&&(k[b]=a>t?--a:++a)})),p++}}),j._connections=o,j.update=q,j.update()}};return d}();!function(){l.observable.filter=function(a){var b=J.initExpressionExtender(this),c=a;return l.isFunction(c)&&!l.isObservable(c)||(c=function(b){var c=l.unwrap(a),d=String(c).toLowerCase();return b=String(l.unwrap(b)).toLowerCase(),!c||b.indexOf(d)!=-1}),b._operations.push({type:J.operations.FILTER,filter:c}),b},l.observable.step=function(a){var b=J.initExpressionExtender(this);return b._operations.push({type:J.operations.STEP,step:a}),b},l.observable.skip=function(a){var b=J.initExpressionExtender(this);return b._operations.push({type:J.operations.SKIP,skip:a}),b},l.observable.take=function(a){var b=J.initExpressionExtender(this);return b._operations.push({type:J.operations.TAKE,take:a}),b},l.observable.sort=function(a){var b=J.initExpressionExtender(this);return b._operations.push({type:J.operations.SORT,sort:a}),b}}(),function(){l.query=function(a,b){l.domReady(function(){l.$unwrap(b,function(b){l.isElement(b)||(b=document.body);var c=new G,d=D(b)[0];c.pushContext(a),c._serverData=C,C?d.render(c):d.sync(c),c.createElementObservableDependencies([b])})})},l.executeQuery=function(a,b){var c=y.Is(a)?"preprocess":"update",d=Array.prototype.slice.call(arguments,2),e=l.queries[b];e.passDomQuery&&d.unshift(l.domQuery(a)),e[c].apply(a,d)},l.context=function(a,b){if(a=l.$unwrap(a)){var c=s.data(a);if(c){if(b&&c.childrenContext)return c.childrenContext;if(c.context)return c.context}return l.context(y.Is(a)?a._parent:a.parentNode,!0)}return null},l.dataItem=function(a){var b=l.context(a);return b?b.$this:null},l.isObservable=function(a){return!!a&&a.__identity__===H},l.unwrapObservable=function(a){return a&&a.__identity__===H?a():a},l.domQuery=function(a){if(a=l.$unwrap(a)){var b=s.data(a,"domQuery");return b?b:l.domQuery(y.Is(a)?a._parent:a.parentNode)}return null},l.executeExpression=function(a,b,c){c=c||{};var d,e=x.Create(l.unwrapObservable(a)),f=!1,g=[];return b=l.unwrapObservable(b),l.isObject(b)?b.$this||(f=!0,b.$this=b):b={$this:b},d=x.GetValue(b,null,e,c.raw?x.Raw:x.ValueOnly),f&&(b.$this=void 0),c.raw&&l.each(l.toArray(d),function(a,b){g[b]=l.isObject(a)?a:{observables:[],result:a,value:a}}),c.raw?g:d}}()}(),function(){var a=l.toString;
l.toString=function(b){return 0===arguments.length?"jsblocks - Better MV-ish Framework":a(b)}}();var o=a.blocks;return l.noConflict=function(b){return a.blocks===l&&(a.blocks=o),b&&a.blocks===l&&(a.blocks=o),l},l});
//# sourceMappingURL=blocks-query.min.js.map